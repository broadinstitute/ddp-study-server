ActivityType:
  title: ActivityType
  type: string
  enum:
    - FORMS
ActivityInstanceStatusType:
  title: ActivityInstanceStatusType
  type: string
  example: IN_PROGRESS
  enum:
    - COMPLETE
    - CREATED
    - IN_PROGRESS
DecimalNumber:
  type: object
  description: |
    A representation of a BigDecimal number. The represented number is equal to `value * 10 ^ scale`.
  required:
    - scale
    - value
  properties:
    scale:
      type: integer
      format: int64
    value:
      description: the unscaled value
      type: integer
      format: int64
FormType:
  title: FormType
  type: string
  enum:
    - CONSENT
    - GENERAL
    - PREQUALIFIER
JoinMailingListPayload:
  type: object
  title: JoinMailingListPayload
  required:
    - firstName
    - lastName
    - emailAddress
  properties:
    firstName:
      description: user's first name
      type: string
      example: John
      minLength: 0
    lastName:
      description: user's last name
      type: string
      example: Doe
      minLength: 0
    emailAddress:
      description: user's email address
      type: string
      format: email
      example: john.doe@example.com
    info:
      description: Strings providing context about which umbrella based mailing list the user is interested in. Usually list of diseases
      type: array
      minItems: 0
      example: ['Gauchers disease', 'Hirschsprungs disease']
      items:
        type: string
    umbrellaGuid:
      description: The umbrella id of the mailing list the user is interested in (one of umbrellaId OR studyGuid but not both is required)
      example: cmi
      type: string
      format: guid
    studyGuid:
      description: The studyGuid of the mailing list the user is interested in (one of umbrellaId OR studyGuid but not both is required)
      example: ANGIO
      type: string
      format: guid
    isoLanguageCode:
      description: preferred language code of join mailing list user. If language code is not set, defaults to study default language.
      type: string
      nullable: true
      format: ISO 639-1
      example: en

ListStyle:
  title: ListStyle
  type: string
  default: NONE
  enum:
    - NUMBER
    - BULLET
    - UPPER_ALPHA
    - NONE
Presentation:
  title: Presentation
  type: string
  default: DEFAULT
  enum:
    - DEFAULT
    - MERGE
  description: |
    a hint for presenting group blocks
    * `DEFAULT` - should use the default presentation behavior
    * `MERGE` - should present nested blocks together on the same screen or page, as if merging them
ValidationType:
  type: string
  enum:
    - COMPLETE
    - DATE_RANGE
    - AGE_RANGE
    - DAY_REQUIRED
    - LENGTH
    - MONTH_REQUIRED
    - NUM_OPTIONS_SELECTED
    - REGEX
    - REQUIRED
    - UNIQUE
    - YEAR_REQUIRED
    - UNIQUE_VALUE
Activity:
  type: object
  required:
    - activityType
    - formType
    - activityCode
    - guid
    - title
    - subtitle
    - readonly
    - statusCode
    - listStyleHint
    - sections
    - lastUpdatedText
    - lastUpdated
    - canDelete
    - isFollowup
    - isHidden
    - sectionIndex
  properties:
    activityType:
      $ref: '#/ActivityType'
    formType:
      $ref: '#/FormType'
    activityCode:
      type: string
      format: guid
      description: unique identifier of the activity
    guid:
      type: string
      format: guid
      description: unique identifier for this instance of the activity
    parentInstanceGuid:
      type: string
      nullable: true
      description: guid for the parent activity instance in case this is a child activity instance
    statusCode:
      $ref: "#/ActivityInstanceStatusType"
    title:
      type: string
      description: title of the activity to be displayed
    subtitle:
      type: string
      nullable: true
      description: |
        A string to display to the user as a subtitle for the activity. If the
        `ddp-Content-Style` header is set to `BASIC`, this field will contain
        unstructured text.
    readonly:
      type: boolean
      default: false
      description: false if the activity can be modified.
    readonlyHint:
      type: string
      nullable: true
      description: |
        A string to display when an activity is in a read-only state (the
        `readonly` flag is `true`). If the `ddp-Content-Style` header is set to
        `BASIC`, this field will contain unstructured text.
    listStyleHint:
      $ref: '#/ListStyle'
    introduction:
      $ref: '#/Section'
    sections:
      type: array
      items:
        $ref: '#/Section'
    closing:
      $ref: '#/Section'
    lastUpdatedText:
      type: string
      nullable: true
      description: |
        A human-readable string that shows when the activity definition was last
        updated. If the `ddp-Content-Style` header is set to `BASIC`, this field
        will contain unstructured text.
    lastUpdated:
      type: string
      format: YYYY-MM-DDThh:mm:ss.sssZ (ISO-8601)
      nullable: true
      description: The date time the activity definition (NOT the instance) was last updated
    canDelete:
      type: boolean
      description: whether the activity instance can be deleted
    isFollowup:
      type: boolean
      description: whether this activity is considered a "follow-up"
    isHidden:
      type: boolean
      description: |
        Whether the activity instance is hidden from the participant. When
        true, client should prefer to show some indicator to operator that
        activity is hidden from participant's view.
    sectionIndex:
      type: integer
      minimum: 0
      description: The section index of the activity form by the user
Activity.Summary:
  type: object
  title: Activity Summary
  required:
    - activityCode
    - activityType
    - activitySubtype
    - activityName
    - activityTitle
    - activitySubtitle
    - activityDescription
    - activitySummary
    - instanceGuid
    - statusCode
    - readonly
    - numQuestions
    - numQuestionsAnswered
    - canDelete
    - isFollowup
    - isHidden
  properties:
    activityCode:
      description: the source activity for this instance
      example: ABCDEFGH12
      type: string
      format: guid
    activityType:
      $ref: "#/ActivityType"
    activitySubtype:
      $ref: "#/FormType"
    activityName:
      type: string
      description: name of the activity
      example: Medical Survey
    activityTitle:
      type: string
      description: title of the activity, should be used when viewing/editing activity instance
      example: Please tell us about your disease
    activitySubtitle:
      type: string
      nullable: true
    activityDescription:
      type: string
      nullable: true
    activitySummary:
      type: string
      nullable: true
    createdAt:
      type: integer
      format: int64
      description: The creation timestamp of the activity instance, in milliseconds since `1970-01-01T00:00:00Z` (UNIX time)
    icon:
      description: a Base64 encoded png or jpg image
      example: YW55IGN...BwbGVhc3VyZQ==
      type: string
      format: base64
      nullable: true
    instanceGuid:
      example: 6B03213FD0
      type: string
      format: guid
    parentInstanceGuid:
      description: guid for the parent activity instance in case this is a child activity instance
      type: string
      format: guid
      nullable: true
    numQuestions:
      description: number of questions in this activity
      example: 4
      type: integer
      minimum: 0
    numQuestionsAnswered:
      description: number of questions that have been answered in this activity
      example: 1
      minimum: 0
      type: integer
    readonly:
      description: false if the activity can be modified
      example: false
      type: boolean
    statusCode:
      $ref: "#/ActivityInstanceStatusType"
    canDelete:
      type: boolean
      description: whether the activity instance can be deleted
    isFollowup:
      description: true if the activity is generally considered to be an activity that comes after the "main" activities
      type: boolean
      default: false
    isHidden:
      type: boolean
      default: false
      description: |
        Whether the activity instance is hidden from the participant. When
        true, client should prefer to show some indicator to operator that
        activity is hidden from participant's view.
    previousInstanceGuid:
      description: GUID of previous instance
      type: string
      format: guid
######
#
# Answers
###
Answer:
  type: object
  required:
    - answerGuid
  properties:
    answerGuid:
      type: string
      format: guid
Answer.String:
  allOf:
    - $ref: '#/Answer'
    - type: object
      required:
        - type
        - value
      properties:
        type:
          type: string
          default: STRING
        value:
          type: string
          nullable: true
Answer.Date:
  allOf:
    - $ref: '#/Answer'
    - type: object
      required:
        - type
        - value
      properties:
        type:
          type: string
          default: DATE
        value:
          $ref: '#/DateValue'
Answer.Composite:
  allOf:
    - $ref: '#/Answer'
    - type: object
      required:
        - type
        - value
      properties:
        type:
          type: string
          default: COMPOSITE
        value:
          type: array
          items:
            type: array
            items:
              anyOf:
                - $ref: '#/Answer.Date'
                - $ref: '#/Answer.Picklist'
                - $ref: '#/Answer.String'
Answer.Boolean:
  allOf:
    - $ref: '#/Answer'
    - type: object
      required:
        - type
        - value
      properties:
        type:
          type: string
          default: BOOLEAN
        value:
          type: boolean
Answer.File:
  allOf:
    - $ref: '#/Answer'
    - type: object
      required:
        - value
        - type
      properties:
        type:
          type: string
          default: FILE
        value:
          $ref: '#/FileInfo'
Answer.Integer:
  allOf:
    - $ref: '#/Answer'
    - type: object
      required:
        - type
      properties:
        type:
          type: string
          default: NUMERIC
        value:
          type: integer
          nullable: true
Answer.Decimal:
  allOf:
    - $ref: '#/Answer'
    - type: object
      required:
        - type
        - value
      properties:
        value:
          $ref: '#/DecimalNumber'
Answer.Picklist:
  allOf:
    - $ref: '#/Answer'
    - type: object
      required:
        - type
        - value
      properties:
        type:
          type: string
          default: PICKLIST
        value:
          type: array
          items:
            $ref: '#/SelectedOption'
Answer.ActivityInstance:
  allOf:
    - $ref: '#/Answer'
    - type: object
      required:
        - type
        - value
      properties:
        type:
          type: string
          default: ACTIVITY_INSTANCE_SELECT
        value:
          type: string
          format: guid
          nullable: true
          description: |
            GUID of selected activity instance.
SelectedOption:
  type: object
  required:
    - stableId
    - detail
  properties:
    stableId:
      type: string
      format: guid
    detail:
      type: string
      nullable: true
Answer.Matrix:
  allOf:
    - $ref: '#/Answer'
    - type: object
      required:
        - value
      properties:
        value:
          type: array
          items:
            $ref: '#/SelectedCell'
SelectedCell:
  type: object
  required:
    - rowStableId
    - optionStableId
  properties:
    rowStableId:
      type: string
      format: guid
    optionStableId:
      type: string
      format: guid
DateValue:
  type: object
  description: an object which represents a day, month, and year in UTC.
  properties:
    day:
      type: integer
      nullable: true
      minimum: 0
    month:
      type: integer
      nullable: true
      minimum: 0
    year:
      type: integer
      nullable: true
      minimum: 0
FileInfo:
  type: object
  nullable: true
  description: |
    Description of the file uploaded. This can be `null` if no uploaded file
    is associated with the answer.
  required:
    - fileName
    - fileSize
  properties:
    fileName:
      type: string
      description: Name of the file
    fileSize:
      type: integer
      description: Size of the file in bytes
      minimum: 0
AnswerSubmission:
  type: object
  discriminator:
    propertyName: type
    mapping:
      ACTIVITY_INSTANCE_SELECT: '#/AnswerSubmission.ActivityInstance'
      AGREEMENT: '#/AnswerSubmission.Boolean'
      BOOLEAN: '#/AnswerSubmission.Boolean'
      COMPOSITE: '#/AnswerSubmission.Composite'
      DATE: '#/AnswerSubmission.Date'
      FILE: '#/AnswerSubmission.File'
      NUMERIC: '#/AnswerSubmission.Integer'
      DECIMAL: '#/AnswerSubmission.Decimal'
      PICKLIST: '#/AnswerSubmission.Picklist'
      MATRIX: '#/AnswerSubmission.Matrix'
      TEXT: '#/AnswerSubmission.String'
  required:
    - stableId
  properties:
    stableId:
      type: string
      description: question identifier that the answer is for
    answerGuid:
      type: string
      format: guid
      nullable: true
      description: the existing answer guid if this is an update
    type:
      type: string
AnswerSubmission.Boolean:
  allOf:
    - $ref: '#/AnswerSubmission'
    - type: object
      required:
        - value
      properties:
        value:
          type: boolean
AnswerSubmission.Composite:
  allOf:
    - $ref: '#/AnswerSubmission'
    - type: object
      required:
        - value
      properties:
        value:
          type: array
          items:
            type: array
            items:
              anyOf:
                - $ref: '#/AnswerSubmission.Date'
                - $ref: '#/AnswerSubmission.Picklist'
                - $ref: '#/AnswerSubmission.String'
AnswerSubmission.Date:
  allOf:
    - $ref: '#/AnswerSubmission'
    - type: object
      required:
        - value
      properties:
        value:
          $ref: '#/DateValue'
AnswerSubmission.File:
  allOf:
    - $ref: '#/AnswerSubmission'
    - type: object
      required:
        - value
      properties:
        value:
          type: string
          nullable: true
          description: |
            File upload guid provided by server when upload URL was requested. If this
            answer is currently associated with a file upload, then submitting a `null`
            value will unassociate it and the uploaded file will subsequently get deleted.
AnswerSubmission.Integer:
  allOf:
    - $ref: '#/AnswerSubmission'
    - type: object
      required:
        - value
      properties:
        value:
          type: integer
          nullable: true
AnswerSubmission.Decimal:
  allOf:
    - $ref: '#/AnswerSubmission'
    - type: object
      required:
        - value
        - scale
      properties:
        value:
          type: integer
          format: int64
          nullable: true
        scale:
          type: integer
          description: the number of digits allowed to the right of the decimal point.
          minimum: 0
          default: 0
AnswerSubmission.Picklist:
  allOf:
    - $ref: '#/AnswerSubmission'
    - type: object
      required:
        - value
      properties:
        value:
          type: array
          items:
            $ref: '#/SelectedOption'
AnswerSubmission.Matrix:
  allOf:
    - $ref: '#/AnswerSubmission'
    - type: object
      required:
        - value
      properties:
        value:
          type: array
          items:
            $ref: '#/SelectedCell'
AnswerSubmission.String:
  allOf:
    - $ref: '#/AnswerSubmission'
    - type: object
      required:
        - value
      properties:
        value:
          type: string
AnswerSubmission.ActivityInstance:
  allOf:
    - $ref: '#/AnswerSubmission'
    - type: object
      required:
        - value
      properties:
        value:
          type: string
          format: guid
          nullable: true
          description: |
            GUID of instance of activity available for selection. If this
            answer is currently associated with an instance, then submitting a `null`
            value will unassociate it.
#####
#
# Blocks
#
#####
Block:
  type: object
  discriminator:
    propertyName: blockType
    mapping:
      ACTIVITY: '#/Block.Activity'
      COMPONENT: '#/Block.Component'
      CONDITIONAL: '#/Block.Conditional'
      CONTENT: '#/Block.Content'
      GROUP: '#/Block.Grouped'
      QUESTION: '#/Block.Question'
      TABULAR: '#/Block.Tabular'
  required:
    - blockType
    - blockGuid
    - shown
    - enabled
  properties:
    blockType:
      type: string
    blockGuid:
      type: string
      format: guid
    shown:
      type: boolean
    enabled:
      type: boolean
Block.Component:
  allOf:
    - $ref: '#/Block'
    - type: object
      required:
        - component
        - displayNumber
      properties:
        blockType:
          type: string
          default: COMPONENT
          enum:
            - COMPONENT
        component:
          $ref: '#/Component'
        displayNumber:
          type: integer
          minimum: 1
          nullable: true
          description: the number to label this block, `null` if it shouldn't be numbered
Block.Activity:
  allOf:
    - $ref: '#/Block'
    - type: object
      required:
        - renderHint
        - activityCode
        - allowMultiple
      properties:
        blockType:
          type: string
          default: ACTIVITY
          enum:
            - ACTIVITY
        activityCode:
          type: string
        addButtonText:
          type: string
          nullable: true
          description: |
            Suggested text for button that would allow creation of additional activity instances via [createActivity](#operation/createActivity).
            Value only relevant if `allowMultiple` is set to `true`.
        allowMultiple:
          type: boolean
          description: |
            Indicates whether this activity allows for multiple instances to be created. If value is true, client is expected
            to provide UI mechanism (e.g., button) that will call [createActivity](#operation/createActivity) and new activity instance
            can be retrieved via [getActivitySummary](#operation/getActivitySummary)
        renderHint:
          type: string
          description: |
            Give client an indication of how to display the the child activity instance. EMBEDDED suggests
            to display the body of the activity instance contents in web page, MODAL suggests to display in
            separate modal dialog.
          enum:
            - EMBEDDED
            - MODAL
        instances:
          description: |
            Summaries of instances of containing activity. Each item in the array is equivalent to summary that can be retrieved
            using [getActivitySummary](#operation/getActivitySummary).
            These summary objects contain metadata (`canDelete`, `readOnly`) that indicate what operations are available to operate on the instance.
            The full activity instance can be retrieved using [getActivity](#operation/getActivity) with the provided `instanceGuid` or
            deleted using [deleteActivity](#operation/deleteActivity). Note that these summary objects will not contain an `icon`
            (so the value will be `null` for the `icon` property).
          type: array
          items:
            $ref: '#/Activity.Summary'
Block.Conditional:
  allOf:
    - $ref: '#/Block'
    - type: object
      required:
        - control
        - nested
        - displayNumber
      properties:
        blockType:
          type: string
          default: CONDITIONAL
          enum:
            - CONDITIONAL
        control:
          $ref: '#/Question'
        nested:
          type: array
          items:
            anyOf:
              - $ref: '#/Block.Component'
              - $ref: '#/Block.Question'
              - $ref: '#/Block.Content'
        displayNumber:
          type: integer
          minimum: 1
          nullable: true
          description: the number to label this block, `null` if it shouldn't be numbered
Block.Grouped:
  allOf:
    - $ref: '#/Block'
    - type: object
      required:
        - listStyleHint
        - presentation
        - nested
        - title
      properties:
        blockType:
          type: string
          default: GROUP
          enum:
            - GROUP
        listStyleHint:
          $ref: '#/ListStyle'
        presentation:
          $ref: '#/Presentation'
        title:
          type: string
        nested:
          type: array
          items:
            anyOf:
              - $ref: '#/Block.Component'
              - $ref: '#/Block.Question'
              - $ref: '#/Block.Content'
Block.Question:
  allOf:
    - $ref: '#/Block'
    - type: object
      required:
        - question
        - displayNumber
      properties:
        blockType:
          type: string
          default: QUESTION
          enum:
            - QUESTION
        question:
          $ref: '#/Question'
        displayNumber:
          type: integer
          minimum: 1
          nullable: true
          description: the number to label this block, `null` if it shouldn't be numbered
Block.Content:
  allOf:
    - $ref: '#/Block'
    - type: object
      required:
        - body
      properties:
        blockType:
          type: string
          default: CONTENT
          enum:
            - CONTENT
        title:
          type: string
        body:
          type: string
Block.Tabular:
  allOf:
    - $ref: '#/Block'
    - type: object
      required:
        - columnsCount
        - headers
        - content
      properties:
        blockType:
          type: string
          default: TABULAR
          enum:
            - TABULAR
        columnsCount:
          type: integer
          minimum: 1
          description: The total number of the tabular component columns.
        headers:
          type: array
          items:
            $ref: '#/Block.Tabular.Header'
        content:
          type: array
          items:
            $ref: '#/Block.Tabular.ContentRow'

Block.Tabular.Header:
  type: object
  required:
    - label
    - columnSpan
  properties:
    label:
      type: string
    columnSpan:
      type: integer
      minimum: 1
      default: 1
      description: the number of columns this header should occupy in a tabular display

Block.Tabular.ContentRow:
  type: array
  items:
    $ref: '#/Question'

Block.Visibility:
  type: object
  required:
    - blockGuid
    - shown
    - enabled
  properties:
    blockGuid:
      type: string
      description: identifier for the block
    shown:
      type: boolean
      description: whether block is shown or not
    enabled:
      type: boolean
      description: whether block is enabled or not (used in cases when block inputs should be disabled but still visible)
#####
#
# Components
#
#####
Component:
  type: object
  discriminator:
    propertyName: componentType
    mapping:
      PHYSICIAN: '#/Component.Physician'
      INSTITUTION: '#/Component.Institution'
      MAILING_ADDRESS:  '#/Component.MailingAddress'
  required:
    - componentType
  properties:
    componentType:
      type: string
    parameters:
      type: object
Component.Physician:
  allOf:
    - $ref: '#/Component'
    - type: object
      required:
        - componentType
        - parameters
      properties:
        componentType:
          type: string
          enum:
            - PHYSICIAN
        parameters:
          type: object
          properties:
            titleText:
              type: string
            subtitleText:
              type: string
            allowMultiple:
              type: boolean
            addButtonText:
              type: string
            institutionType:
              type: string
              enum:
                - PHYSICIAN
            showFieldsInitially:
              type: boolean
            required:
              type: boolean
Component.Institution:
  allOf:
    - $ref: '#/Component'
    - type: object
      required:
        - componentType
        - parameters
      properties:
        componentType:
          type: string
          enum:
            - INSTITUTION
        parameters:
          type: object
          properties:
            titleText:
              type: string
            subtitleText:
              type: string
            allowMultiple:
              type: boolean
            addButtonText:
              type: string
            institutionType:
              type: string
              enum:
                - INITIAL_BIOPSY
                - INSTITUTION
            showFieldsInitially:
              type: boolean
            required:
              type: boolean
Component.MailingAddress:
  allOf:
    - $ref: '#/Component'
    - type: object
      required:
        - componentType
        - parameters
      properties:
        componentType:
          type: string
          enum:
            - MAILING_ADDRESS
        addressGuid:
          type: string
          description: 'guid of a snapshotted address: if it is not null then the address should be loaded by this guid, if it is null then load the default address'
        parameters:
          type: object
          properties:
            titleText:
              type: string
            subtitleText:
              type: string
            requireVerified:
              type: boolean
              description: when `true`, address should be [verified](#operation/verifyMailingAddress) as deliverable
            requirePhone:
              type: boolean
              description: |
                     when `true`, the activity may require that there be a saved mailing address with a non-empty value for `phone` in order to be [completed](#operation/putAnswers).
ConditionalRule:
  type: object
  title: ConditionalRule
  properties:
    operator:
      type: string
      enum:
        - HAS
    value:
      type: string
      description: the
    target:
      type: string
      description: the guid of the target block to show or hide
ConsentModel:
  type: object
  title: ConsentModel
  description: 'A set of elections, and their state, for an associated participant and activity'
  required:
    - activityCode
    - instanceGuid
    - consented
    - elections
  properties:
    activityCode:
      type: string
      example: MY_STUDY_CONSENT
      description: 'The identifier of the activity template for this set of elections'
    instanceGuid:
      type: string
      example: A883837A15
      description: 'The activity instance this set of elections is associated with. This may be `null` if one has not been created yet'
    consented:
      type: boolean
      description: '`true` if the participant has completed the associated activity instance, `false` if the activity instance has been created or is in progress, and `null` if there is no associated activity instance'
    elections:
      type: array
      items:
        $ref: '#/ElectionModel'
ElectionModel:
  type: object
  title: Election
  required:
    - stableId
    - selected
  properties:
    stableId:
      type: string
      description: identifier for the specified election
      example: 'BLOOD_SAMPLE'
    selected:
      type: boolean
      description: '`true` if the participant has consented to this election, `false` if they have not, and `null` if the participant has not yet responded'
      example: false
Error.Activity:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - MALFORMED_ACCEPT_LANGUAGE_HEADER
Error.ActivityNotFound:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - ACTIVITY_NOT_FOUND
ValidationFailure:
  type: object
  required:
    - message
  properties:
    stableIds:
      description: |
        ids of questions associated with the validation failure. If not specified, interpreted mean scope of failure is the full activity
        instance
      type: array
      items:
        type: string
    message:
      type: string
Error.Consent:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - ACTIVITY_NOT_FOUND
Error.ProfileGet:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - MISSING_PROFILE
Error.ProfileUpdate:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - BAD_PAYLOAD
            - MISSING_BODY
            - MISSING_PROFILE
            - INVALID_LANGUAGE_PREFERENCE
            - INVALID_SEX
            - INVALID_DATE
Error.ProfileAdd:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - BAD_PAYLOAD
            - DUPLICATE_PROFILE
            - INVALID_LANGUAGE_PREFERENCE
            - INVALID_SEX
            - INVALID_DATE
Error.ProviderNotFound:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - NOT_FOUND
Error.StudyNotFound:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - STUDY_NOT_FOUND
Error.UmbrellaNotFound:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - UMBRELLA_NOT_FOUND
Error:
  type: object
  required:
    - code
    - message
  properties:
    code:
      type: string
    message:
      type: string
Error.ActivityAnswersPatchBadPayload:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - BAD_PAYLOAD
            - FILE_ERROR
            - INVALID_REQUEST
            - NO_SUCH_ELEMENT
            - REQUIRED_PARAMETER_MISSING
            - UNEXPECTED_NUMBER_OF_ELEMENTS
Error.ActivityAnswersInternalServerError:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            # Indicates than the question has multiple answers
            - SERVER_ERROR
Error.ActivityAnswersPatchInvalid:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - ACTIVITY_INSTANCE_IS_READONLY
            - QUESTION_IS_READONLY
            - ANSWER_VALIDATION
            - MALFORMED_EMAIL
            - OPERATION_NOT_ALLOWED
        violations:
          type: array
          description: list of question validation types an answer has failed to satisfy
          items:
            type: object
            required:
              - stableId
              - rules
            properties:
              stableId:
                type: string
                description: identifier of question
              rules:
                type: array
                items:
                  type: object
                  properties:
                    ruleType:
                      $ref: '#/ValidationType'
                    message:
                      type: string
Error.ActivityAnswersPatchNotFound:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - ACTIVITY_NOT_FOUND
            - ANSWER_NOT_FOUND
            - QUESTION_NOT_FOUND
            - STUDY_NOT_FOUND
            - USER_NOT_FOUND
Error.ActivityAnswersPutInvalid:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - ACTIVITY_INSTANCE_IS_READONLY
            - ACTIVITY_VALIDATION
            - QUESTION_REQUIREMENTS_NOT_MET
Error.ActivityAnswersPutNotFound:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - ACTIVITY_NOT_FOUND
            - STUDY_NOT_FOUND
            - USER_NOT_FOUND
Error.ActivityDetailNotFound:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - ACTIVITY_NOT_FOUND
            - STUDY_NOT_FOUND
            - USER_NOT_FOUND
Error.BadPayload:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - BAD_PAYLOAD
Error.NotFound:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - NOT_FOUND
Error.OperationNotAllowed:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - OPERATION_NOT_ALLOWED
Error.RegisterNotFound:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - STUDY_NOT_FOUND
            - USER_NOT_FOUND
Error.RegisterNotValid:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - EXPIRED
            - NOT_SUPPORTED
Error.StudyExit:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - OPERATION_NOT_ALLOWED
            - NOT_SUPPORTED
Error.CreateActivityInstance:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - ACTIVITY_INSTANCE_IS_READONLY
            - TOO_MANY_INSTANCES
Error.UserStudyActivityNotFound:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - ACTIVITY_NOT_FOUND
            - STUDY_NOT_FOUND
            - USER_NOT_FOUND
Error.UserStudyActivityQuestionNotFound:
  allOf:
    - $ref: '#/Error'
    - type: object
      properties:
        code:
          type: string
          enum:
            - ACTIVITY_NOT_FOUND
            - QUESTION_NOT_FOUND
            - STUDY_NOT_FOUND
            - USER_NOT_FOUND
Image:
  type: object
  required:
    - height
    - width
    - 1x
  properties:
    height:
      type: integer
      minimum: 0
    width:
      type: integer
      minimum: 0
    1x:
      type: string
Participant:
  type: object
  required:
    - alias
    - userGuid
  properties:
    alias:
      type: string
      example: Alice
    userGuid:
      type: string
      example: Y9JJVE1MLN8AIZL8DO7D
    userProfile:
      $ref: '#/ProfileModel'
PicklistParentOption:
  allOf:
    - $ref: '#/PicklistOption'
    - type: object
      title: ParentPicklistOption
      properties:
        nestedOptionsLabel:
          type: string
        nestedOptions:
          type: array
          items:
            $ref: '#/PicklistOption'
PicklistOption:
  type: object
  required:
    - stableId
    - allowDetails
    - optionLabel
    - exclusive
    - groupId
  properties:
    stableId:
      type: string
    groupId:
      type: string
      nullable: true
    allowDetails:
      type: boolean
    optionLabel:
      type: string
    tooltip:
      type: string
      description: tooltip for the option, in plain text
    detailLabel:
      type: string
    exclusive:
      type: boolean
MatrixOption:
  type: object
  required:
    - stableId
    - optionLabel
    - exclusive
    - groupId
  properties:
    stableId:
      type: string
    groupId:
      type: string
    optionLabel:
      type: string
    tooltip:
      type: string
      description: tooltip for the option, in plain text
    exclusive:
      type: boolean
      description: if `exclusive` option selected, other options in the group will be cleared (applicable for MULTIPLE select mode)
MatrixRowQuestion:
  type: object
  required:
    - stableId
    - questionLabel
  properties:
    stableId:
      type: string
    questionLabel:
      type: string
    tooltip:
      type: string
      description: tooltip for the option, in plain text
PrequalifierModel:
  type: object
  required:
    - guid
    - title
    - status
    - typeName
    - isoLanguageCode
  properties:
    guid:
      type: string
      example: 6B03213FD0
    title:
      type: string
      example: Join the Basil Research Study
    status:
      type: string
      example: Started
    typeName:
      type: string
      example: Forms
    isoLanguageCode:
      type: string
      example: en
ProfileModel:
  type: object
  properties:
      birthYear:
        type: integer
        example: 1970
        deprecated: true
      birthMonth:
        type: integer
        example: 1
        deprecated: true
      birthDayInMonth:
        type: integer
        example: 1
        deprecated: true
      birthDate:
        type: string
        format: date
        example: 1999-09-19
      sex:
        type: string
        enum:
          - 'MALE'
          - 'FEMALE'
          - 'INTERSEX'
          - 'PREFER_NOT_TO_ANSWER'
        default: PREFER_NOT_TO_ANSWER
      preferredLanguage:
        type: string
        example: en
      firstName:
        type: string
        example: Foo
      lastName:
        type: string
        example: Barium
      skipLanguagePopup:
        type: boolean
        example: true

#####
#
# Questions
#
#####
Question:
  type: object
  discriminator:
    propertyName: questionType
    mapping:
      ACTIVITY_INSTANCE_SELECT: '#/Question.ActivityInstanceSelect'
      AGREEMENT: '#/Question.Agreement'
      BOOLEAN: '#/Question.Boolean'
      COMPOSITE: '#/Question.Composite'
      DATE: '#/Question.Date'
      FILE: '#/Question.File'
      NUMERIC: '#/Question.Integer'
      DECIMAL: '#/Question.Decimal'
      EQUATION: '#/Question.Equation'
      PICKLIST: '#/Question.Picklist'
      MATRIX: '#/Question.Matrix'
      TEXT: '#/Question.Text'
  required:
  - questionType
  - stableId
  - prompt
  - textPrompt
  properties:
    questionType:
      type: string
    stableId:
      type: string
    prompt:
      type: string
      description: 'the text that should be displayed for the question. This field should be treated as an HTML fragment.'
      example: 'What <b>color</b> is the sky?'
    textPrompt:
      type: string
      description: 'the text that should be displayed for the question with all embedded HTML tags flattened and stripped.'
      example: 'What color is the sky?'
    tooltip:
      type: string
      description: tooltip for the question, in plain text
    readonly:
      type: boolean
      description: if `true`, the client should not persist any changes to the question's answer. Any requests attempting to update this question's answer will result in an error.
      default: false
    additionalInfoHeader:
      type: string
      description: a plain text string for additional information to be presented before the user responds to a question
      example: Select all that apply
    additionalInfoFooter:
      type: string
      description: a plain text string for additional information to be presented after the user reads or responds to a question
      example: If you had radiation for other cancers, we will ask you about that later
    validations:
      type: array
      items:
        $ref: '#/Validation'
    postConditionals:
      type: array
      items:
        $ref: '#/ConditionalRule'
    validationFailures:
      type: array
      items:
        $ref: '#/ValidationFailure'
    columnSpan:
      type: integer
      minimum: 1
      description: The number of columns this question should occupy in a tabular display
Question.ActivityInstanceSelect:
  allOf:
    - $ref: '#/Question'
    - type: object
      required:
        - answers
        - activityCodes
      properties:
        questionType:
          type: string
          default: ACTIVITY_INSTANCE_SELECT
          enum:
            - ACTIVITY_INSTANCE_SELECT
        activityCodes:
          description: 'List of activity codes for instance lookup'
          type: array
          items:
            type: string
            format: guid
        answers:
          type: array
          items:
            $ref: '#/Answer.ActivityInstance'
Question.Agreement:
  allOf:
  - $ref: '#/Question'
  - type: object
    required:
      - answers
    properties:
      questionType:
        type: string
        default: AGREEMENT
        enum:
          - AGREEMENT
      answers:
        type: array
        items:
          $ref: '#/Answer.Boolean'
Question.Boolean:
  allOf:
  - $ref: '#/Question'
  - type: object
    required:
      - answers
      - trueContent
      - falseContent
      - renderMode
    properties:
      questionType:
        type: string
        default: BOOLEAN
        enum:
          - BOOLEAN
      renderMode:
        type: string
        default: RADIO_BUTTONS
        enum:
          - CHECKBOX
          - RADIO_BUTTONS
      trueContent:
        type: string
        example: 'Yes'
      falseContent:
        type: string
        example: 'NO'
      answers:
        type: array
        items:
          $ref: '#/Answer.Boolean'
Question.Composite:
  allOf:
  - $ref: '#/Question'
  - type: object
    required:
      - allowMultiple
      - addButtonText
      - additionalItemText
      - answers
      - children
      - childOrientation
    properties:
      questionType:
        type: string
        default: COMPOSITE
        enum:
          - COMPOSITE
      allowMultiple:
        type: boolean
        default: false
        description: 'true if the question should allow the addition of multiple entries'
      addButtonText:
        type: string
        description: 'The label to show for the button to add a subsequent entry. This can be ignored if `allowMultiple` is `false`'
      additionalItemText:
        type: string
        description: 'The label to show above entries beyond the initial one'
      children:
        type: array
        description: 'The child questions to present'
        items:
          anyOf:
            - $ref: '#/Question.Date'
            - $ref: '#/Question.Picklist'
            - $ref: '#/Question.Text'
      childOrientation:
        type: string
        nullable: true
        enum:
          - HORIZONTAL
          - VERTICAL
        description: optional indicator of how to layout child questions
      answers:
        type: array
        items:
          $ref: '#/Answer.Composite'
      tabularSeparator:
        type: string
        description: a symbol/word to display between composite children in a tabular block
Question.Date:
  allOf:
  - $ref: '#/Question'
  - type: object
    required:
      - answers
      - displayCalendar
      - fields
      - renderMode
      - useMonthNames
    properties:
      questionType:
        type: string
        default: DATE
        enum:
          - DATE
      placeholderText:
        type: string
        description: if present, this text string can be used as a placeholder hint
      renderMode:
        type: string
      displayCalendar:
        type: boolean
      useMonthNames:
        type: boolean
      fields:
        type: array
        items:
          type: string
          enum:
            - DAY
            - MONTH
            - YEAR
      firstSelectedYear:
        type: integer
      startYear:
        type: integer
      endYear:
        type: integer
      answers:
        type: array
        items:
          $ref: '#/Answer.Date'
Question.File:
  allOf:
    - $ref: '#/Question'
    - type: object
      required:
        - answers
        - maxFileSize
        - mimeTypes
      properties:
        questionType:
          type: string
          default: FILE
          enum:
            - FILE
        maxFileSize:
          type: integer
          format: int64
          description: a max size of uploaded file, in bytes
        mimeTypes:
          type: array
          items:
            type: string
          description: a list of allowed mime-types (if the list is empty then any type allowed)
          minItems: 0
        answers:
          type: array
          items:
            $ref: '#/Answer.File'
Question.Integer:
  allOf:
    - $ref: '#/Question'
    - type: object
      required:
        - answers
      properties:
        placeholderText:
          type: string
          nullable: true
          description: if present, this text string can be used as a placeholder hint
        answers:
          type: array
          items:
            $ref: '#/Answer.Integer'
Question.Decimal:
  allOf:
    - $ref: '#/Question'
    - type: object
      required:
        - answers
      properties:
        scale:
          type: integer
          description: the number of digits allowed to the right of the decimal point.
          minimum: 0
          default: 0
        answers:
          type: array
          items:
            $ref: '#/Answer.Decimal'
Question.Equation:
  allOf:
    - $ref: '#/Question'
    - type: object
      required:
        - answers
      properties:
        maximumDecimalPlaces:
          type: integer
          format: int64
          description: the number of digits allowed to the right of the decimal point.
          minimum: 0
          default: 0
        answers:
          type: array
          items:
            $ref: '#/Answer.Decimal'
Question.Picklist:
  allOf:
  - $ref: '#/Question'
  - type: object
    required:
      - selectMode
      - renderMode
      - picklistOptions
      - answers
    properties:
      questionType:
        type: string
        default: PICKLIST
        enum:
          - PICKLIST
      selectMode:
        type: string
        enum:
          - MULTIPLE
          - SINGLE
      renderMode:
        type: string
        enum:
          - LIST
          - DROPDOWN
          - CHECKBOX_LIST
          - AUTOCOMPLETE
          - REMOTE_AUTOCOMPLETE
      groups:
        type: array
        description: A list of groups used in the `picklistOptions` values. If there are no options which explicity request grouping, this will be an empty array.
        minItems: 0
        items:
          type: object
          required:
            - identifier
            - name
          properties:
            identifier:
              type: string
            name:
              type: string
      picklistLabel:
        type: string
      picklistOptions:
        type: array
        items:
          $ref: '#/PicklistParentOption'
      answers:
        type: array
        items:
          $ref: '#/Answer.Picklist'
Question.Matrix:
  allOf:
    - $ref: '#/Question'
    - type: object
      required:
        - selectMode
        - options
        - questions
        - answers
      properties:
        questionType:
          type: string
          default: MATRIX
          enum:
            - MATRIX
        selectMode:
          type: string
          description: |
            * `MULTIPLE` - Allows user to select as many options as needed (checkbox)
            * `SINGLE` - Only one selection is allowed inside group (radio button)
          enum:
            - MULTIPLE
            - SINGLE
        renderModal:
          type: boolean
          default: false
          description: When true, the matrix question should be presented inside a modal box.
        modal:
          type: string
          description: Button label that opens modal.
        modalTitle:
          type: string
          description: Modal title label.
        groups:
          type: array
          description: A list of groups used in the `matrixOptions` values. If there are no options which explicity request grouping, this will be an empty array.
          minItems: 0
          items:
            type: object
            required:
              - identifier
              - name
            properties:
              identifier:
                type: string
              name:
                type: string
        options:
          type: array
          items:
            $ref: '#/MatrixOption'
        questions:
          type: array
          items:
            $ref: '#/MatrixRowQuestion'
        answers:
          type: array
          items:
            $ref: '#/Answer.Matrix'
Question.Text:
  allOf:
  - $ref: '#/Question'
  - type: object
    required:
      - answers
      - inputType
    properties:
      questionType:
        type: string
        default: TEXT
        enum:
          - TEXT
      placeholderText:
        type: string
        nullable: true
      confirmPlaceholderText:
        type: string
        nullable: true
      inputType:
        type: string
        enum:
          - TEXT
          - ESSAY
          - SIGNATURE
          - EMAIL
      confirmEntry:
        type: boolean
      confirmPrompt:
        type: string
        nullable: true
      mismatchMessage:
        type: string
        nullable: true
      suggestionType:
        type: string
        default: NONE
        enum:
          - NONE
          - DRUG
          - CANCER
          - INCLUDED
          - INSTITUTION
      suggestions:
        description: 'If the suggestionType is INCLUDED, then this is the list of suggestions to use'
        type: array
        items:
          type: string
      answers:
        type: array
        items:
          $ref: '#/Answer.String'
Section:
  type: object
  required:
    - blocks
  properties:
    name:
      type: string
    icon:
      $ref: '#/Image'
    blocks:
      type: array
      items:
        $ref: '#/Block'
Study.Audit:
  type: object
  required:
    - auditTrailId
    - studyGuid
    - operatorGuid
    - operatorEmail
    - userGuid
    - userEmail
    - entityType
    - dateTime
    - description
  properties:
    auditTrailId:
      type: integer
      format: int64
    studyGuid:
      type: string
      format: guid
    operatorGuid:
      type: string
      format: guid
    operatorEmail:
      type: string
      format: email
    userGuid:
      type: string
      format: guid
    userEmail:
      type: string
      format: email
    entityType:
      type: string
      enum:
        - USER
        - ACTIVITY
        - INSTANCE
        - ANSWER
    dateTime:
      type: string
      format: date-time
    description:
      type: string
Study.Summary:
  type: object
  required:
    - studyGuid
    - name
    - participantCount
  properties:
    studyGuid:
      type: string
      format: guid
    name:
      type: string
    participantCount:
      type: integer
      minimum: 0
      description: The total number of consented participants in a study. This is a subset of the registered users.
    registeredCount:
      type: integer
      minimum: 0
      description: The total number of registered users in a study.
    restricted:
      type: boolean
      default: false
      description: |
        `true` if the study requires an IRB password for access.
    studyEmail:
      type: string
      format: email
Study.Detail:
  allOf:
    - $ref: '#/Study.Summary'
    - type: object
      properties:
        summary:
          type: string
        shouldDisplayLanguageChangePopup:
          type: boolean
#####
#
# Question Validation Types
#
##
Validation:
  type: object
  discriminator:
    propertyName: rule
    mapping:
      AGE_RANGE: '#/Validation.AgeRange'
      COMPLETE: '#/Validation.Complete'
      COMPARISON: '#/Validation.Comparison'
      DATE_RANGE: '#/Validation.DateRange'
      DAY_REQUIRED: '#/Validation.DayRequired'
      INT_RANGE: '#/Validation.IntRange'
      DECIMAL_RANGE: '#/Validation.DecimalRange'
      LENGTH: '#/Validation.Length'
      MONTH_REQUIRED: '#/Validation.MonthRequired'
      NUM_OPTIONS_SELECTED: '#/Validation.OptionsSelected'
      REGEX: '#/Validation.RegularExpression'
      REQUIRED: '#/Validation.Required'
      UNIQUE: '#/Validation.Unique'
      YEAR_REQUIRED: '#/Validation.YearRequired'
      UNIQUE_VALUE: '#/Validation.UniqueValue'
  required:
    - rule
    - message
  properties:
    rule:
      $ref: '#/ValidationType'
    message:
      type: string
    allowSave:
      description: Indicates whether the validation rule failing should allow saving corresponding data; if rule evaluates to false and allowSave value is true, client should send data to server anyways. Note data will be eventually validated, just not during initial PATCH.
      type: boolean
      default: false
Validation.Required:
  allOf:
    - $ref: '#/Validation'
    - type: object
      properties:
        rule:
          type: string
          default: REQUIRED
          enum:
            - REQUIRED
Validation.Complete:
  allOf:
    - $ref: '#/Validation'
    - type: object
      properties:
        rule:
          type: string
          default: COMPLETE
          enum:
            - COMPLETE
Validation.Length:
  allOf:
    - $ref: '#/Validation'
    - type: object
      deprecated: true
      required:
        - minLength
        - maxLength
      properties:
        rule:
          type: string
          default: LENGTH
          enum:
            - LENGTH
        minLength:
          type: integer
          minimum: 0
        maxLength:
          type: integer
          minimum: 0
Validation.RegularExpression:
  allOf:
    - $ref: '#/Validation'
    - type: object
      deprecated: true
      required:
        - regexPattern
      properties:
        rule:
          type: string
          default: REGEX
          enum:
            - REGEX
        regexPattern:
          type: string
Validation.OptionsSelected:
  allOf:
    - $ref: '#/Validation'
    - type: object
      deprecated: true
      properties:
        rule:
          type: string
          default: NUM_OPTIONS_SELECTED
          enum:
            - NUM_OPTIONS_SELECTED
        minSelections:
          type: integer
          minimum: 0
        maxSelections:
          type: integer
          minimum: 0
Validation.DayRequired:
  allOf:
    - $ref: '#/Validation'
    - type: object
      deprecated: true
      properties:
        rule:
          type: string
          default: DAY_REQUIRED
          enum:
            - DAY_REQUIRED
Validation.MonthRequired:
  allOf:
    - $ref: '#/Validation'
    - type: object
      deprecated: true
      properties:
        rule:
          type: string
          default: MONTH_REQUIRED
          enum:
            - MONTH_REQUIRED
Validation.YearRequired:
  allOf:
    - $ref: '#/Validation'
    - type: object
      deprecated: true
      properties:
        rule:
          type: string
          default: YEAR_REQUIRED
          enum:
            - YEAR_REQUIRED
Validation.DateRange:
  allOf:
    - $ref: '#/Validation'
    - type: object
      required:
        - startDate
        - endDate
      properties:
        rule:
          type: string
          default: DATE_RANGE
          enum:
            - DATE_RANGE
        startDate:
          type: string
          description: the minimum date required to be considered valid. This value is inclusive. The date format is a full, extended ISO-8601 Calendar date in the format `YYYY-MM-DD` in the UTC time zone.
          nullable: true
          format: date
        endDate:
          type: string
          description: the maximum date required to be considered valid. This value is inclusive. The date format is a full, extended ISO-8601 Calendar date in the format `YYYY-MM-DD` in the UTC time zone.
          nullable: true
          format: date
Validation.AgeRange:
  allOf:
    - $ref: '#/Validation'
    - type: object
      properties:
        rule:
          type: string
          default: AGE_RANGE
          enum:
            - AGE_RANGE
        minAge:
          type: integer
          description: after calculating the number of years since the value of the associated date, minAge defines the minimum acceptable age inclusive.
          nullable: true
        maxAge:
          type: integer
          description: after calculating the number of years since the value of the associated date, maxAge defines the maximum acceptable age inclusive.
          nullable: true
Validation.IntRange:
  allOf:
    - $ref: '#/Validation'
    - type: object
      properties:
        rule:
          type: string
          default: INT_RANGE
          enum:
            - INT_RANGE
        min:
          type: integer
          nullable: true
          description: the minimum acceptable number, inclusive
        max:
          type: integer
          nullable: true
          description: the maximum acceptable number, inclusive
Validation.DecimalRange:
  allOf:
    - $ref: '#/Validation'
    - type: object
      properties:
        rule:
          type: string
          default: DECIMAL_RANGE
          enum:
            - DECIMAL_RANGE
        min:
          allOf:
            - $ref: '#/DecimalNumber'
            - description: the minimum acceptable number, inclusive
              nullable: true
        max:
          allOf:
            - $ref: '#/DecimalNumber'
            - description: the maximum acceptable number, inclusive
              nullable: true
Validation.Unique:
  allOf:
    - $ref: '#/Validation'
    - type: object
      properties:
        rule:
          type: string
          default: UNIQUE
          enum:
            - UNIQUE
Validation.UniqueValue:
  allOf:
    - $ref: '#/Validation'
    - type: object
      description: check for uniqueness in same question answers among all participants of the study
      properties:
        rule:
          type: string
          default: UNIQUE_VALUE
          enum:
            - UNIQUE_VALUE
Validation.Comparison:
  allOf:
    - $ref: '#/Validation'
    - type: object
      required:
        - reference_question_stable_id
        - comparison_validation_type
      description: compares the value of the given answer with the answer to the referenced question
      properties:
        rule:
          type: string
          default: COMPARISON
          enum:
            - COMPARISON
        reference_question_stable_id:
          type: string
          format: guid
        comparison_validation_type:
          type: string
          enum:
            - LESS_OR_EQUAL
            - GREATER_OR_EQUAL
            - LESS
            - GREATER
            - EQUAL
            - NOT_EQUAL
AnnouncementModel:
  type: object
  required:
    - guid
    - permanent
    - message
  properties:
    guid:
      type: string
      format: uuid
      description: an identifier for this message
      example: c8716864-3cd8-4a4b-8736-d2eec9756ad9
    permanent:
      type: boolean
      description: if true, then message is permanent and should not be able to be dismissed by user
    message:
      type: string
Drug:
  type: object
  required:
    - name
    - description
  properties:
    name:
      type: string
      example: ABARELIX (PLENAXIS)
    description:
      type: string
      nullable: true
Suggestion.Drug:
  required:
    - drug
    - matches
  type: object
  properties:
    drug:
      $ref: '#/Drug'
    matches:
      type: array
      description: Contains a list of substring matches for the given `Drug`. The substrings are based within the drug's `name` property.
      minItems: 0
      items:
        $ref: '#/Suggestion.Match'
Cancer:
  type: object
  required:
    - name
    - description
  properties:
    name:
      type: string
      description: a short name for the cancer
      example: Sarcoma
    description:
      type: string
      description: a longer name for the cancer
      nullable: true
Suggestion.Cancer:
  required:
    - cancer
    - matches
  type: object
  properties:
    cancer:
      $ref: '#/Cancer'
    matches:
      type: array
      description: Contains a list of substring matches for the given `Cancer` name. The substrings are based within the cancer `name` property.
      minItems: 0
      items:
        $ref: '#/Suggestion.Match'
Suggestion.Institution:
  type: object
  required:
    - name
    - city
    - state
  properties:
    name:
      type: string
      example: Brigham And Women's Hospital
    city:
      type: string
      example: Boston
    state:
      type: string
      example: Massachusetts
Suggestion.Match:
  type: object
  required:
    - offset
    - length
  properties:
    offset:
      type: integer
      minimum: 0
    length:
      type: integer
      minimum: 0

BaseMailAddress:
  type: object
  properties:
    name:
      type: string
      description: the participant's full name
    street1:
      type: string
      description: the participant's delivery address
    street2:
      type: string
      description: the participant's delivery address
    city:
      type: string
    state:
      type: string
    country:
      type: string
    zip:
      type: string
    phone:
      type: string
MailingAddress:
  allOf:
    - $ref: '#/BaseMailAddress'
    - type: object
      description: a participant's mailing address, to be used for delivery.
      properties:
        guid:
          type: string
          description: the server-generated unique identifier for the mailing address
        description:
          type: string
          description: the user-entered description for this address
        plusCode:
          type: string
          description: the server-generated PlusCode for the participant's location
        isDefault:
          type: boolean
          description: is this the participant's default address?
        validationStatus:
          type: integer
          description: >
            ### Address Validation States
              * **0** - *INVALID_ADDRESS*
                * The address failed to be validated by EasyPost, and there were no suggestions made. This address may not be able to be used as a delivery address.
              * **1** - *SUGGESTED_ADDRESS*
                * The address contains changes from EasyPost to improve deliverability.
              * **2** - *VALID_ADDRESS*
                * The originally entered address was successfully validated by EasyPost.
          enum:
            - 0
            - 1
            - 2
AddressWarning:
  type: object
  required:
    - code
    - message
  properties:
    code:
      type: string
      description: machine readable description of the problem
      enum:
        - W.ZIP.UNSUPPORTED
    message:
      type: string
      description: human readable description of the problem
      example: Zip code is not supported
AddressVerifyError:
  type: object
  description: error from verifying address with EasyPost
  required:
    - code
    - message
    - errors
  properties:
    code:
      type: string
      description: machine readable description of the problem
      example: ADDRESS.VERIFY.FAILURE
    message:
      type: string
      description: human readable description of the problem
      example: Unable to verify address.
    errors:
      type: array
      description: errors for specific fields of the address
      items:
        $ref: '#/AddressFieldError'
AddressFieldError:
  type: object
  required:
    - code
    - message
    - field
  properties:
    code:
      type: string
      description: machine readable description of field error
      example: E.HOUSE_NUMBER.MISSING
    message:
      type: string
      description: human readable description of field error
      example: House number is missing
    field:
      type: string
      description: the address field, where `address` means the general address instead of a single field
      example: street1

#####
#
# Invitations
#
#####
Invitation:
  type: object
  required:
    - invitationType
    - invitationId
    - createdAt
    - voidedAt
    - verifiedAt
    - acceptedAt
  properties:
    invitationType:
      description: the type of invitation
      type: string
      enum:
        - AGE_UP
        - RECRUITMENT
      example: RECRUITMENT
    invitationId:
      description: the id of the invitation
      type: string
    createdAt:
      description: timestamp of when invitation was created.
      type: string
      example: 2020-05-13T17:58:33.887Z
      format: YYYY-MM-DDThh:mm:ss.sssZ (ISO-8601)
    voidedAt:
      description: timestamp of when invitation was voided, making the invitation invalid.
      type: string
      nullable: true
      example: null
    verifiedAt:
      description: timestamp of when invitation was verified, indicating user has acknowledged receiving the invitation.
      type: string
      nullable: true
      example: 2020-05-13T18:58:33.887Z
      format: YYYY-MM-DDThh:mm:ss.sssZ (ISO-8601)
    acceptedAt:
      description: timestamp of when invitation was accepted.
      type: string
      nullable: true
      example: 2020-05-13T19:58:33.887Z
      format: YYYY-MM-DDThh:mm:ss.sssZ (ISO-8601)

MedicalProvider:
  type: object
  required:
    - medicalProviderGuid
  properties:
    medicalProviderGuid:
      type: string
      readOnly: true
      format: guid
    institutionName:
      type: string
    physicianName:
      type: string
    city:
      type: string
    state:
      type: string
ParticipantStatusTrackingInfo:
  type: object
  required:
    - medicalRecord
    - tissueRecord
    - kits
  properties:
    medicalRecord:
      $ref: '#/ParticipantStatusTrackingInfo.Record'
    tissueRecord:
      $ref: '#/ParticipantStatusTrackingInfo.Record'
    kits:
      type: array
      description: Contains a list of kits sent to the participant
      minItems: 0
      items:
        $ref: '#/ParticipantStatusTrackingInfo.Kit'
    workflows:
      type: array
      minItems: 0
      items:
        $ref: '#/ParticipantStatusTrackingInfo.Workflow'
ParticipantStatusTrackingInfo.Workflow:
  type: object
  properties:
    workflow:
      type: string
      description: The name of the workflow
    status:
      type: string
      description: The current state in the workflow
    date:
      type: string
      format: YYYY-MM-DDThh:mm:ss.sssZ (ISO-8601)
      description: Last changed
      example: 2021-04-18T14:09:37.123Z
    data:
      type: object
      description: Additional participant data, actual key-value pairs might vary depending on study
ParticipantStatusTrackingInfo.Record:
  type: object
  required:
    - status
  properties:
    status:
      type: string
      enum:
        - INELIGIBLE
        - PENDING
        - SENT
        - RECEIVED
        - UNKNOWN
    requestedAt:
      type: integer
    receivedBackAt:
      type: integer
ParticipantStatusTrackingInfo.Kit:
  type: object
  required:
    - sentAt
  properties:
    kitType:
      type: string
    status:
      type: string
      enum:
        - INELIGIBLE
        - PENDING
        - SENT
        - RECEIVED
        - UNKNOWN
    sentAt:
      type: integer
    receivedBackAt:
      type: integer
    trackingId:
      type: string
    shipper:
      type: string

StudyPasswordPolicy:
  type: object
  required:
    - minimumLength
    - minimumCharacterClasses
    - characterClasses
    - maximumRepeatedCharacters
  properties:
    minimumLength:
      type: integer
      minimum: 1
      maximum: 128
      example: 8
      description: Minimum number of characters in password
    minimumCharacterClasses:
      type: integer
      minimum: 0
      example: 3
      description: Must have a character from at least this number of character classes
    characterClasses:
      type: array
      items:
        type: string
        enum:
          - UPPER
          - LOWER
          - NUMBER
          - SPECIAL
      minItems: 0
      example: [UPPER, LOWER, NUMBER]
      description: Set of character classes to look for in password
    maximumRepeatedCharacters:
      type: integer
      nullable: true
      example: 2
      description: If non-null, no more than the specified number of identical characters are allowed consecutively. This value is inclusive (e.g. if the value is 2, then `aa` is allowed while `aaa` is not allowed).

#####
#
# Workflows
#
#####
WorkflowNextSuggestion:
  type: object
  discriminator:
    propertyName: next
    mapping:
      ACTIVITY: '#/WorkflowNextSuggestion.Activity'
      DASHBOARD: '#/WorkflowNextSuggestion.Static'
      MAILING_LIST: '#/WorkflowNextSuggestion.Static'
      PARTICIPANT_LIST: '#/WorkflowNextSuggestion.Static'
      THANK_YOU: '#/WorkflowNextSuggestion.Static'
      UNKNOWN: '#/WorkflowNextSuggestion.Static'
      STUDY_REDIRECT: '#/WorkflowNextSuggestion.StudyRedirect'
  required:
    - next
  properties:
    next:
      type: string
      description: |
        * `ACTIVITY` - Should show an activity next.
        * `DASHBOARD` - Indicates end of workflow and should direct to a dashboard if available.
        * `MAILING_LIST` - Indicates end of workflow and should prompt user to join the study mailing list.
        * `THANK_YOU` - Indicates end of workflow and a thank you message should be shown.
        * `PARTICIPANT_LIST` - Indicates the list of governed users.
        * `UNKNOWN` - No suggestions available.
        * `STUDY_REDIRECT` - Indicates end of current study workflow and should direct to suggested study .
WorkflowNextSuggestion.Activity:
  allOf:
  - $ref: '#/WorkflowNextSuggestion'
  - type: object
    required:
      - activityCode
      - instanceGuid
      - allowUnauthenticated
    properties:
      activityCode:
        type: string
        description: the identifier of the next activity
      instanceGuid:
        type: string
        description: the identifier of the next activity instance for user
      allowUnauthenticated:
        type: boolean
        description: Whether the next activity allows access to temporary users. If `false`, user will need to authenticate in order to access activity.
WorkflowNextSuggestion.StudyRedirect:
  allOf:
    - $ref: '#/WorkflowNextSuggestion'
    - type: object
      required:
        - studyName
        - redirectUrl
      properties:
        studyName:
          type: string
          description: the study name
        studyGuid:
          type: string
          description: the study guid
        redirectUrl:
          type: string
          description: the study url to redirect
WorkflowNextSuggestion.Static:
  allOf:
  - $ref: '#/WorkflowNextSuggestion'
  - type: object
    properties:
      next:
        type: string
        enum:
          - DASHBOARD
          - MAILING_LIST
          - PARTICIPANT_LIST
          - THANK_YOU
          - UNKNOWN
Statistics.Configuration:
  type: object
  properties:
    type:
      type: string
      description: |
        * `PARTICIPANTS` - Number of participants enrolled. Divided by types (self, governed).
        * `DISTRIBUTION` - Shows answers distribution for the specific picklist question. Contains also picklist option details with i18n applied.
        * `MAILING_LIST` - Number of subscriptions.
        * `SPECIFIC_ANSWER` - Shows how many specific answers were given for the specific question. Supported question types: picklist, boolean.
        * `KITS` - Number of kit requests divided by types.
      enum:
        - PARTICIPANTS
        - DISTRIBUTION
        - MAILING_LIST
        - SPECIFIC_ANSWER
        - KITS
    questionStableId:
      type: string
      description: Question stableId if applicable.
    answerValue:
      type: string
      description: Answer stableId which is counted for SPECIFIC_ANSWER
Statistics.Figure.Item.Data:
  type: object
  properties:
    count:
      type: string
    optionDetails:
      $ref: '#/PicklistParentOption'
Statistics.Figure.Item:
  type: object
  properties:
    name:
      type: string
      description: Statistics item title
    data:
      $ref: '#/Statistics.Figure.Item.Data'
Statistics.Figure:
  type: object
  properties:
    configuration:
      $ref: '#/Statistics.Configuration'
    statistics:
      type: array
      items:
        $ref: '#/Statistics.Figure.Item'
Statistics:
  type: array
  items:
    $ref: '#/Statistics.Figure'

EnrollmentStatusType:
  description: Participant's enrollment status
  type: string
  enum:
    - REGISTERED
    - ENROLLED
    - EXITED_BEFORE_ENROLLMENT
    - EXITED_AFTER_ENROLLMENT
    - CONSENT_SUSPENDED
    - COMPLETED
ParticipantsLookupResultItem:
  type: object
  required:
    - guid
    - hruid
    - legacyAltPid
    - legacyShortId
    - status
    - firstName
    - lastName
    - email
    - invitationId
    - proxy
  properties:
    guid:
      description: Participant's guid
      type: string
    hruid:
      description: Participant's hruid
      type: string
    legacyAltPid:
      description: Participant's legacy altpid, if available
      type: string
      nullable: true
    legacyShortId:
      description: Participant's legacy short id, if available
      type: string
      nullable: true
    status:
      $ref: '#/EnrollmentStatusType'
    firstName:
      description: Participant's first name, if available
      type: string
      nullable: true
    lastName:
      description: Participant's last name, if available
      type: string
      nullable: true
    email:
      description: Participant's email, if available
      type: string
      format: email
      nullable: true
    invitationId:
      description: Participant's invitation code, if available
      type: string
      nullable: true
    proxy:
      $ref: '#/ParticipantsLookupProxyItem'
ParticipantsLookupProxyItem:
  description: The proxy if the participant is a govnerned user
  type: object
  nullable: true
  required:
    - guid
    - hruid
    - firstName
    - lastName
    - email
  properties:
    guid:
      description: The proxy's guid
      type: string
    hruid:
      description: The proxy's hruid
    firstName:
      description: The proxy's first name, if available
      type: string
      nullable: true
    lastName:
      description: The proxy's last name, if available
      type: string
      nullable: true
    email:
      description: The proxy's email
      type: string
      format: email
Suggestion.ActivityInstance:
  type: object
  required:
    - guid
    - name
  properties:
    guid:
      description: Activity Instance GUID
      type: string
      format: guid
      example: TY51BW3M6S
    name:
      description: Activity Instance Name, rendered, as could be seen on the dashboard
      type: string
      example: "Medical Record Release Form #2"
DateRange:
  type: object
  required:
    - from
    - to
  properties:
    from:
      type: string
      description: the lower constraint of the range. This value is inclusive. The date format is a full, extended ISO-8601 Calendar date and time in the format `YYYY-MM-DDTHH:MM:SSZ` in the UTC time zone.
      nullable: true
      format: date-time
    to:
      type: string
      description: the upper constraint of the range. This value is inclusive. The date format is a full, extended ISO-8601 Calendar date and time in the format `YYYY-MM-DDTHH:MM:SSZ` in the UTC time zone.
      nullable: true
      format: date-time
Pagination:
  type: object
  required:
    - from
    - count
  properties:
    from:
      type: integer
      description: the serial number of the first entry to be fetched of the dataset that relevant to search query
      default: 0
      nullable: true
      format: int64
    count:
      type: integer
      description: the number of entries to be fetched
      default: 50
      nullable: true
      format: int64
Sorting:
  type: object
  properties:
    column:
      description: the column name that will be used for sorting
      nullable: true
      type: string
      enum:
        - auditTrailId
        - studyGuid
        - operatorGuid
        - operatorEmail
        - userGuid
        - userEmail
        - entityType
        - dateTime
        - description
    direction:
      description: the sorting direction
      nullable: true
      type: string
      enum:
        - ASCENDING
        - DESCENDING
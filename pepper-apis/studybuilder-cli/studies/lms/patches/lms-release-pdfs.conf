{
  "pdfs": [
    {
      "name": "lmsproject-release",
      "filename": "lmsproject-release",
      "displayName": "LMS self release pdf",
      "versions": [
        {
          "tag": "v1",
          "start": null,
          "end": null,
          "sources": [
            {
              "type": "PARTICIPANT"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "MEDICAL_RELEASE",
              "versionTag": "v1"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "CONSENT",
              "versionTag": "v1"
            }
          ],
          "files": [
            {
              "filepath": "pdfs/release_self_firstPage.pdf",
              "type": "CUSTOM",
              "language": "en",
              "substitutions": []
            },
            {
              "filepath": "pdfs/release_self_physician.pdf",
              "type": "PHYSICIAN",
              "language": "en",
              "fields": {
                "name": "physician_name",
                "institution": "physician_institution",
                "city": "physician_city",
                "state": "physician_state"
              }
            },
            {
              "filepath": "pdfs/release_self_agreement.pdf",
              "type": "CUSTOM",
              "language": "en",
              "substitutions": [
                {
                  "type": "TEXT",
                  "field": "signature",
                  "activityCode": "MEDICAL_RELEASE",
                  "questionStableId": "RELEASE_SIGNATURE"
                },
                {
                  "type": "ACTIVITY_DATE",
                  "field": "date",
                  "activityCode": "MEDICAL_RELEASE"
                }
              ]
            }
          ]
        }
      ]
    },

    {
      "name": "lmsproject-release-pediatric",
      "filename": "lmsproject-release-pediatric",
      "displayName": "LMS pediatric release pdf",
      "versions": [
        {
          "tag": "v1",
          "start": null,
          "end": null,
          "sources": [
            {
              "type": "PARTICIPANT"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "MEDICAL_RELEASE",
              "versionTag": "v1"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "PARENTAL_CONSENT",
              "versionTag": "v1"
            }
          ],
          "files": [
            {
              "filepath": "pdfs/release_pediatric_firstPage.pdf",
              "type": "CUSTOM",
              "language": "en",
              "substitutions": []
            },
            {
              "filepath": "pdfs/release_pediatric_physician.pdf",
              "type": "PHYSICIAN",
              "language": "en",
              "fields": {
                "name": "physician_name",
                "institution": "physician_institution",
                "city": "physician_city",
                "state": "physician_state"
              }
            },
            {
              "filepath": "pdfs/release_pediatric_agreement.pdf",
              "type": "CUSTOM",
              "language": "en",
              "substitutions": [
                {
                  "type": "TEXT",
                  "field": "signature",
                  "activityCode": "MEDICAL_RELEASE",
                  "questionStableId": "RELEASE_SIGNATURE"
                },
                {
                  "type": "ACTIVITY_DATE",
                  "field": "date",
                  "activityCode": "MEDICAL_RELEASE"
                }
              ]
            }
          ]
        }
      ]
    },

    {
      "name": "lmsproject-release-pediatric-assent",
      "filename": "lmsproject-release-pediatric-assent",
      "displayName": "LMS pediatric release pdf",
      "versions": [
        {
          "tag": "v1",
          "start": null,
          "end": null,
          "sources": [
            {
              "type": "PARTICIPANT"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "MEDICAL_RELEASE",
              "versionTag": "v1"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "CONSENT_ASSENT",
              "versionTag": "v1"
            }
          ],
          "files": [
            {
              "filepath": "pdfs/release_pediatric_firstPage.pdf",
              "type": "CUSTOM",
              "language": "en",
              "substitutions": []
            },
            {
              "filepath": "pdfs/release_pediatric_physician.pdf",
              "type": "PHYSICIAN",
              "language": "en",
              "fields": {
                "name": "physician_name",
                "institution": "physician_institution",
                "city": "physician_city",
                "state": "physician_state"
              }
            },
            {
              "filepath": "pdfs/release_pediatric_agreement.pdf",
              "type": "CUSTOM",
              "language": "en",
              "substitutions": [
                {
                  "type": "TEXT",
                  "field": "signature",
                  "activityCode": "MEDICAL_RELEASE",
                  "questionStableId": "RELEASE_SIGNATURE"
                },
                {
                  "type": "ACTIVITY_DATE",
                  "field": "date",
                  "activityCode": "MEDICAL_RELEASE"
                }
              ]
            }
          ]
        }
      ]
    }
  ],

  "events": [
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.medicalReleaseCompleted},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": [{"pdfName": "lmsproject-release", "generateIfMissing": true}]
      },
      "preconditionExpr": """!user.studies["cmi-lms"].isGovernedParticipant()""",
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.medicalReleaseCompletedParental},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": [{"pdfName": "lmsproject-release-pediatric", "generateIfMissing": true}]
      },
      "preconditionExpr": """user.studies["cmi-lms"].isGovernedParticipant()""",
      "dispatchToHousekeeping": true,
      "order": 2
    }
  ]
}

{
  "tenant": {
    "domain": ${auth0.domain},
    "mgmtClientId": ${auth0.mgmtClientId},
    "mgmtSecret": ${auth0.mgmtSecret}
  },

  "umbrella": {
    "name": "CMI",
    "guid": "cmi"
  },

  "study": {
    "name": "leiomyosarcoma",
    "guid": "cmi-lms",
    "studyEmail": "info@lmsproject.org",
    "baseWebUrl": ${baseWebUrl},
    "irbPassword": ${irbPassword}
    "plusCodePrecision": "MEDIUM",
    "shareParticipantLocation": false
  },

  "clients": [
    {
      "id": ${auth0.clientId},
      "secret": ${auth0.clientSecret},
      "passwordRedirectUrl": ${passwordRedirectUrl}
    },
    {
      "id": ${auth0.adminClientId},
      "secret": ${auth0.adminClientSecret},
      "passwordRedirectUrl": null
    }
  ],

  "adminUser": {
    "guid": "CMIPEPPERADMINUSER"
  }

  "supportedLanguages": [
    {
      "language": "en",
      "name": "English",
      "isDefault": true
    }
  ],

  "statistics": [],

  "studyDetails": [],

  "sendgrid": {
    "apiKey": ${sendgridApiKey},
    "fromName": ${sendgridFromName},
    "fromEmail": ${sendgridFromEmail},
    "defaultSalutation": ${sendgridDefaultSalutation}
  },

  "kits": [
    {
      "type": "SALIVA",
      "quantity": 1,
      "rules": [
        {
          "type": "PEX",
          "expression": """
            (user.studies["cmi-lms"].forms["MEDICAL_RELEASE"].hasInstance() && user.studies["cmi-lms"].forms["MEDICAL_RELEASE"].isStatus("COMPLETE"))
            || (user.studies["cmi-lms"].forms["MINOR_RELEASE"].hasInstance() && user.studies["cmi-lms"].forms["MINOR_RELEASE"].isStatus("COMPLETE"))
          """
        },
        {
          "type": "COUNTRY",
          "country": "us"     # United States
        },
        {
          "type": "COUNTRY",
          "country": "ca"     # Canada
        },
        {
          "type": "COUNTRY",
          "country": "pr"     # Puerto Rico
        },
        {
          "type": "COUNTRY",
          "country": "gu"     # Guam
        },
        {
          "type": "COUNTRY",
          "country": "vi"     # U.S. Virgin Islands
        },
        {
          "type": "COUNTRY",
          "country": "mp"     # Northern Mariana Islands
        },
        {
          "type": "COUNTRY",
          "country": "as"     # American Samoa
        }
      ]
    },
    {
      "type": "BLOOD",
      "quantity": 1,
      "rules": [
        {
          "type": "PEX",
          "expression": """
            (user.studies["cmi-lms"].forms["MEDICAL_RELEASE"].hasInstance() && user.studies["cmi-lms"].forms["MEDICAL_RELEASE"].isStatus("COMPLETE"))
            || (user.studies["cmi-lms"].forms["MINOR_RELEASE"].hasInstance() && user.studies["cmi-lms"].forms["MINOR_RELEASE"].isStatus("COMPLETE"))
          """
        },
        {
          "type": "COUNTRY",
          "country": "us"     # United States
        },
        {
          "type": "COUNTRY",
          "country": "ca"     # Canada
        },
        {
          "type": "COUNTRY",
          "country": "pr"     # Puerto Rico
        },
        {
          "type": "COUNTRY",
          "country": "gu"     # Guam
        },
        {
          "type": "COUNTRY",
          "country": "vi"     # U.S. Virgin Islands
        },
        {
          "type": "COUNTRY",
          "country": "mp"     # Northern Mariana Islands
        },
        {
          "type": "COUNTRY",
          "country": "as"     # American Samoa
        }
      ]
    }
  ],

  "activityTimestamp": "2015-01-01T00:00:00Z",

  "activityStatusIcons": [],

  "pdfs": [],

  include required("study-activities.conf")
  include required("study-workflows.conf")
  include required("study-events.conf")
  include required("study-emails.conf")

  "governance": {
    "shouldCreateGovernedUserExpr": """
      user.studies["cmi-lms"].forms["PREQUAL"].questions["WHO_ENROLLING"].answers.hasOption("CHILD_DIAGNOSED")
      && (user.studies["cmi-lms"].forms["PARENTAL_CONSENT"].hasInstance() || user.studies["cmi-lms"].forms["CONSENT_ASSENT"].hasInstance())
    """,
    "ageOfMajorityRules": [
      # AoM for U.S.
      {
        "condition": """
          user.studies["cmi-lms"].forms["PREQUAL"].questions["WHO_ENROLLING"].answers.hasOption("CHILD_DIAGNOSED")
          && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("US")
          && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_STATE"].answers.hasOption("AL")
        """,
        "age": 19,
        "prepMonths": 4
      },
      {
        "condition": """
          user.studies["cmi-lms"].forms["PREQUAL"].questions["WHO_ENROLLING"].answers.hasOption("CHILD_DIAGNOSED")
          && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("US")
          && !user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_STATE"].answers.hasOption("AL")
        """,
        "age": 18,
        "prepMonths": 4
      },

      # Aom for Puerto Rico
      {
        "condition": """
          user.studies["cmi-lms"].forms["PREQUAL"].questions["WHO_ENROLLING"].answers.hasOption("CHILD_DIAGNOSED")
          && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("PR")
        """,
        "age": 21,
        "prepMonths": 4
      },

      # Aom for other U.S. Territories
      {
        "condition": """
          user.studies["cmi-lms"].forms["PREQUAL"].questions["WHO_ENROLLING"].answers.hasOption("CHILD_DIAGNOSED")
          && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasAnyOption("GU", "VI", "MP", "AS")
        """,
        "age": 18,
        "prepMonths": 4
      },

      # AoM for Canada
      {
        "condition": """
          user.studies["cmi-lms"].forms["PREQUAL"].questions["WHO_ENROLLING"].answers.hasOption("CHILD_DIAGNOSED")
          && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("CA")
          && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_PROVINCE"].answers.hasAnyOption("BC", "NB", "NL", "NT", "NS", "NU", "YT")
        """,
        "age": 19,
        "prepMonths": 4
      },
      {
        "condition": """
          user.studies["cmi-lms"].forms["PREQUAL"].questions["WHO_ENROLLING"].answers.hasOption("CHILD_DIAGNOSED")
          && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("CA")
          && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_PROVINCE"].answers.hasAnyOption("AB", "MB", "ON", "PE", "QC", "SK")
        """,
        "age": 18,
        "prepMonths": 4
      }
    ]
  },

}

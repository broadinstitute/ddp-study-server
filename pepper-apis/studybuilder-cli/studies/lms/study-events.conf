{
  "events": [
    # populate profile events
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_FIRSTNAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_LASTNAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_LAST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_DOB"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_BIRTH_DATE"
            }
          }
        ]
      },
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PARENTAL_CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "PARENTAL_CONSENT_CHILD_FIRSTNAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "PARENTAL_CONSENT_CHILD_LASTNAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_LAST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "PARENTAL_CONSENT_CHILD_DOB"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_BIRTH_DATE"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "PARENTAL_CONSENT_FIRSTNAME"
            },
            "target": {
              "type": "OPERATOR_PROFILE_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "PARENTAL_CONSENT_LASTNAME"
            },
            "target": {
              "type": "OPERATOR_PROFILE_LAST_NAME"
            }
          }
        ]
      },
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ASSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_ASSENT_CHILD_FIRSTNAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_ASSENT_CHILD_LASTNAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_LAST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_ASSENT_CHILD_DOB"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_BIRTH_DATE"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_ASSENT_FIRSTNAME"
            },
            "target": {
              "type": "OPERATOR_PROFILE_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_ASSENT_LASTNAME"
            },
            "target": {
              "type": "OPERATOR_PROFILE_LAST_NAME"
            }
          }
        ]
      },
      "dispatchToHousekeeping": false,
      "order": 1
    },
    # activity instance creation events

    ## MEDICAL_RELEASE TO GERMLINE_CONSENT_ADDENDUM/GERMLINE_CONSENT_ADDENDUM_PEDIATRIC
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM"
      },
      "preconditionExpr": """user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_COUNTRY"].answers.hasOption("US")""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MINOR_RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM_PEDIATRIC"
      },
      "preconditionExpr": """user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("US")""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    }
    ## PREQUAL TO CONSENT
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PREQUAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT"
      },
      "preconditionExpr": """user.studies["cmi-lms"].forms["PREQUAL"].questions["WHO_ENROLLING"].answers.hasOption("DIAGNOSED")
        && (
          ( user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_COUNTRY"].answers.hasOption("US")
            && (
              ( user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_STATE"].answers.hasOption("AL")
                && user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_CURRENT_AGE"].answers.value() >= 19
              ) || (
                !user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_STATE"].answers.hasOption("AL")
                && user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_CURRENT_AGE"].answers.value() >= 18
              )
            )
          ) || (
            user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_COUNTRY"].answers.hasOption("CA")
            && (
              ( user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_PROVINCE"].answers.hasAnyOption("BC", "NB", "NL", "NT", "NS", "NU", "YT")
                && user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_CURRENT_AGE"].answers.value() >= 19
              ) || (
                user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_PROVINCE"].answers.hasAnyOption("AB", "MB", "ON", "PE", "QC", "SK")
                && user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_CURRENT_AGE"].answers.value() >= 18
              )
            )
          ) || (
            user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_COUNTRY"].answers.hasOption("PR")
            && user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_CURRENT_AGE"].answers.value() >= 21
          ) || (
            user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_COUNTRY"].answers.hasAnyOption("GU", "VI", "MP", "AS")
            && user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_CURRENT_AGE"].answers.value() >= 18
          )
        )
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PREQUAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "PARENTAL_CONSENT"
      },
      "preconditionExpr": """user.studies["cmi-lms"].forms["PREQUAL"].questions["WHO_ENROLLING"].answers.hasOption("CHILD_DIAGNOSED")
        && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_CURRENT_AGE"].answers.value() < 7)""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PREQUAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_ASSENT"
      },
      "preconditionExpr": """user.studies["cmi-lms"].forms["PREQUAL"].questions["WHO_ENROLLING"].answers.hasOption("CHILD_DIAGNOSED")
        && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_CURRENT_AGE"].answers.value() >= 7
        && (
          ( user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("US")
            && (
              ( user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_STATE"].answers.hasOption("AL")
                && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_CURRENT_AGE"].answers.value() < 19
              ) || (
                !user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_STATE"].answers.hasOption("AL")
                && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_CURRENT_AGE"].answers.value() < 18
              )
            )
          ) || (
            user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("CA")
            && (
              ( user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_PROVINCE"].answers.hasAnyOption("BC", "NB", "NL", "NT", "NS", "NU", "YT")
                && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_CURRENT_AGE"].answers.value() < 19
              ) || (
                user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_PROVINCE"].answers.hasAnyOption("AB", "MB", "ON", "PE", "QC", "SK")
                && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_CURRENT_AGE"].answers.value() < 18
              )
            )
          ) || (
            user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("PR")
            && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_CURRENT_AGE"].answers.value() < 21
          ) || (
            user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasAnyOption("GU", "VI", "MP", "AS")
            && user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_CURRENT_AGE"].answers.value() < 18
          )
        )
        """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 3
    },
    ## CONSENT TO RELEASE
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_ADDENDUM"
      },
      "preconditionExpr": """
                    !(
                        user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_COUNTRY"].answers.hasOption("CA")
                        || user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_STATE"].answers.hasOption("NY")
                        || user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_COUNTRY"].answers.hasOption("CA")
                        || user.studies["cmi-lms"].forms["PREQUAL"].questions["SELF_STATE"].answers.hasOption("NY")
                    )
                    &&
                    user.studies["cmi-lms"].forms["CONSENT"].questions["CONSENT_TISSUE"].answers.hasTrue()
      """
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 3
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ASSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC"
      },
      "preconditionExpr": """
                    !(
                        user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("CA")
                        || user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_STATE"].answers.hasOption("NY")
                    )
                    &&
                    user.studies["cmi-lms"].forms["CONSENT_ASSENT"].questions["CONSENT_ASSENT_TISSUE"].answers.hasTrue()
      """
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 3
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PARENTAL_CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC"
      },
      "preconditionExpr": """
                    !(
                        user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("CA")
                        || user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_STATE"].answers.hasOption("NY")
                        || user.studies["cmi-lms"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("CA")
                    )
                    &&
                    user.studies["cmi-lms"].forms["PARENTAL_CONSENT"].questions["PARENTAL_CONSENT_TISSUE"].answers.hasTrue()
      """
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 3
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "MEDICAL_RELEASE"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_YOUR_CANCER"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_YOU"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PARENTAL_CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "MINOR_RELEASE"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PARENTAL_CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_CHILD_CANCER"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PARENTAL_CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_YOU"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ASSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "MINOR_RELEASE"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ASSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_CHILD_CANCER"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ASSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_YOU"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },

    # email events
    {
      "trigger": {
        "type": "USER_REGISTERED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.welcome},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": null,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "USER_REGISTERED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.welcomePediatric},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": null,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentReminder1wk},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-lms"].forms["CONSENT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PARENTAL_CONSENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentReminderPediatric1wk},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-lms"].forms["PARENTAL_CONSENT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ASSENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentReminderPediatric1wk},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-lms"].forms["CONSENT_ASSENT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentCompleted},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": null,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ASSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentCompletedParental},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": null,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PARENTAL_CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentCompletedParental},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": null,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentAddendumReminder},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-lms"].forms["CONSENT_ADDENDUM"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentAddendumReminderParental},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-lms"].forms["CONSENT_ADDENDUM_PEDIATRIC"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentAddendumCompleted},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": null,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentAddendumCompletedParental},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": null,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.medicalReleaseReminder},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr":  """user.studies["cmi-lms"].forms["MEDICAL_RELEASE"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.medicalReleaseCompleted},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
     "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MINOR_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.medicalReleaseReminderParental},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr":  """user.studies["cmi-lms"].forms["MINOR_RELEASE"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MINOR_RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.medicalReleaseCompletedParental},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.germlineReminder},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr":  """user.studies["cmi-lms"].forms["GERMLINE_CONSENT_ADDENDUM"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.germlineCompleted},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
     "dispatchToHousekeeping": true,
     "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.germlineReminderParental},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr":  """user.studies["cmi-lms"].forms["GERMLINE_CONSENT_ADDENDUM_PEDIATRIC"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.germlineCompletedParental},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    # enrollment events
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "USER_ENROLLED"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MINOR_RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "USER_ENROLLED"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },

    ## collecting child's contact email
    {
      "trigger": {
        "type": "REACHED_AOM_PREP"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CHILD_CONTACT"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CHILD_CONTACT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.reconsentChildContact},
        "linkedActivityCode": "CHILD_CONTACT",
        "language": "en",
        "pdfAttachments": []
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },

    ## child-contact reminder emails
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CHILD_CONTACT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.reconsentChildContact1wkReminder},
        "linkedActivityCode": "CHILD_CONTACT",
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-lms"].forms["CHILD_CONTACT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CHILD_CONTACT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.reconsentChildContact2wkReminder},
        "linkedActivityCode": "CHILD_CONTACT",
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-lms"].forms["CHILD_CONTACT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.two},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CHILD_CONTACT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.reconsentChildContact4wkReminder},
        "linkedActivityCode": "CHILD_CONTACT",
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-lms"].forms["CHILD_CONTACT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.four}
      "dispatchToHousekeeping": true,
      "order": 1
    },

    ## verifying child's contact email
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CHILD_CONTACT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "CREATE_INVITATION",
        "markExistingAsVoided": true,
        "contactEmailQuestionStableId": "CHILD_CONTACT_EMAIL"
      },
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "INVITATION_CREATED"
      },
      "action": {
        "type": "INVITATION_EMAIL",
        "emailTemplate": ${emails.reconsentEmailVerification},
        "language": "en",
        "pdfAttachments": []
      },
      # Invitation is created after participant reached age-of-majority,
      # so skip verify email since we'll send out the next-steps emails.
      "cancelExpr": """user.studies["cmi-lms"].hasAgedUp()""",
      "dispatchToHousekeeping": true,
      "order": 1
    },

    ## events at age-up
    {
      "trigger": {
        "type": "CONSENT_SUSPENDED"
      },
      "action": {
        "type": "MARK_ACTIVITIES_READ_ONLY",
        "activityCodes": [
          "PARENTAL_CONSENT",
          "CONSENT_ASSENT",
          "MEDICAL_RELEASE",
          "MINOR_RELEASE",
          "ABOUT_YOU",
          "ABOUT_YOUR_CANCER",
          "ABOUT_CHILD_CANCER"
        ]
      },
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "REACHED_AOM"
      },
      "action": {
        "type": "INVITATION_EMAIL",
        "emailTemplate": ${emails.reconsentNextSteps},
        "language": "en",
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },

    ## reconsent/next steps reminder emails
    {
      "trigger": {
        "type": "REACHED_AOM"
      },
      "action": {
        "type": "INVITATION_EMAIL",
        "emailTemplate": ${emails.reconsentNextSteps1wkReminder},
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """(user.studies["cmi-lms"].forms["CONSENT"].hasInstance()
        && user.studies["cmi-lms"].forms["CONSENT"].isStatus("COMPLETE"))""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "REACHED_AOM"
      },
      "action": {
        "type": "INVITATION_EMAIL",
        "emailTemplate": ${emails.reconsentNextSteps2wkReminder},
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """(user.studies["cmi-lms"].forms["CONSENT"].hasInstance()
        && user.studies["cmi-lms"].forms["CONSENT"].isStatus("COMPLETE"))""",
      "delaySeconds": ${delay.weeks.two},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "REACHED_AOM"
      },
      "action": {
        "type": "INVITATION_EMAIL",
        "emailTemplate": ${emails.reconsentNextSteps4wkReminder},
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """(user.studies["cmi-lms"].forms["CONSENT"].hasInstance()
        && user.studies["cmi-lms"].forms["CONSENT"].isStatus("COMPLETE"))""",
      "delaySeconds": ${delay.weeks.four},
      "dispatchToHousekeeping": true,
      "order": 1
    },

    ## after child registration
    {
      "trigger": {
        "type": "GOVERNED_USER_REGISTERED"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT"
      },
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "GOVERNED_USER_REGISTERED"
      },
      "action": {
        "type": "HIDE_ACTIVITIES",
        "activityCodes": ["CHILD_CONTACT"]
      },
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
      "trigger": {
        "type": "GOVERNED_USER_REGISTERED"
      },
      "action": {
        "type": "ANNOUNCEMENT",
        "permanent": true,
        "createForProxies": true,
        "msgTemplate": { include required("snippets/former-proxy-announcement-msg.conf") }
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 3
    },
    {
      "trigger": {
        "type": "GOVERNED_USER_REGISTERED"
      },
      "action": {
        "type": "REVOKE_PROXIES"
      },
      "dispatchToHousekeeping": false,
      # Order here is important. Since announcement `createForProxies` only create for active proxies,
      # we should queue up announcement before inactivating proxy.
      "order": 4
    },
    {
      "label": "CREATE_FH_ON_CONSENT_COMPLETE",
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "FAMILY_HISTORY_SELF"
      }
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 4
    },
  ]
}
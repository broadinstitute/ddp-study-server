####################################
#### USE THIS PATCH ONLY FOR EVENTS -
#### "dispatchToHousekeeping": true,
####################################
#### Others you could add to
####       STUDY-EVENTS.CONF
####################################

{
  "events": [
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.enConsentAddendum},
        "language": "en",
        "pdfAttachments": [{ "pdfName": "osproject-consent-addendum", "generateIfMissing": true }]
      },
      "dispatchToHousekeeping": true,
      "preconditionExpr": """
        user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM"].questions["SOMATIC_CONSENT_TUMOR"].answers.hasTrue()
      """,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.enConsentAddendum},
        "language": "en",
        "pdfAttachments": [{ "pdfName": "osproject-consent-addendum-disagree", "generateIfMissing": true }]
      },
      "dispatchToHousekeeping": true,
      "preconditionExpr": """
        user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM"].questions["SOMATIC_CONSENT_TUMOR"].answers.hasFalse()
      """,
      "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.enParentalConsentAddendum},
        "language": "en",
        "pdfAttachments": [{ "pdfName": "osproject-consent-addendum-pediatric", "generateIfMissing": true }]
      },
      "dispatchToHousekeeping": true,
      "preconditionExpr": """
        user.profile.age() < 7
        && user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM_PEDIATRIC"].questions["SOMATIC_CONSENT_TUMOR_PEDIATRIC"].answers.hasTrue()
      """,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.enParentalConsentAddendum},
        "language": "en",
        "pdfAttachments": [{ "pdfName": "osproject-consent-addendum-pediatric-disagree", "generateIfMissing": true }]
      },
      "dispatchToHousekeeping": true,
      "preconditionExpr": """
        user.profile.age() < 7
        && user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM_PEDIATRIC"].questions["SOMATIC_CONSENT_TUMOR_PEDIATRIC"].answers.hasFalse()
      """,
      "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.enParentalConsentAddendum},
        "language": "en",
        "pdfAttachments": [{ "pdfName": "osproject-consent-assent-addendum-pediatric", "generateIfMissing": true }]
      },
      "dispatchToHousekeeping": true,
      "preconditionExpr": """
        user.profile.age() >= 7
        && user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM_PEDIATRIC"].questions["SOMATIC_CONSENT_TUMOR_PEDIATRIC"].answers.hasTrue()
      """,
      "order": 3
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.enParentalConsentAddendum},
        "language": "en",
        "pdfAttachments": [{ "pdfName": "osproject-consent-assent-addendum-pediatric-disagree", "generateIfMissing": true }]
      },
      "dispatchToHousekeeping": true,
      "preconditionExpr": """
        user.profile.age() >= 7
        && user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM_PEDIATRIC"].questions["SOMATIC_CONSENT_TUMOR_PEDIATRIC"].answers.hasFalse()
      """,
      "order": 4
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.ParentalConsentAddendumReceived},
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM_PEDIATRIC"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.ParentalConsentAddendumReceived},
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM_PEDIATRIC"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.two},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.ConsentAddendumReceived},
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ADDENDUM",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.ConsentAddendumReceived},
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.two},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.GermlineAddendumReceived},
        "language": "en",
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.GermlineAddendumComplete},
        "language": "en",
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.ParentalGermlineAddendumReceived},
        "language": "en",
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.ParentalGermlineAddendumRequired},
        "language": "en",
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.GermlineAddendumRequired},
        "language": "en",
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "GERMLINE_CONSENT_ADDENDUM_PEDIATRIC",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.ParentalGermlineAddendumComplete},
        "language": "en",
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "FAMILY_HISTORY_SELF",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.familyHistoryReminder},
        "language": "en",
        "pdfAttachments": []
      },
      "preconditionExpr":"!user.studies[\"CMI-OSTEO\"].isGovernedParticipant()",
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "FAMILY_HISTORY_SELF",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.familyHistoryReminderParental},
        "language": "en",
        "pdfAttachments": []
      },
      "preconditionExpr":"user.studies[\"CMI-OSTEO\"].isGovernedParticipant()",
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "REACHED_AOM"
      },
      "action": {
        "type": "INVITATION_EMAIL",
        "emailTemplate": ${emails.reconsentEmailVerification},
        "language": "en",
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    ## consent email
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.selfConsentCompleted},
        "linkedActivityCode": "RELEASE_SELF",
        "language": "en",
        "pdfAttachments": [
          { "pdfName": "osproject-consent", "generateIfMissing": true }
        ]
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    ## medical release email
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "RELEASE_SELF",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.selfReleaseCompleted},
        "language": "en",
        "pdfAttachments": []
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUTYOU",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.aboutChildReminder},
        "linkedActivityCode": "ABOUTYOU",
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["CMI-OSTEO"].forms["ABOUTYOU"].isStatus("COMPLETE")""",
      "preconditionExpr":"""user.studies["CMI-OSTEO"].isGovernedParticipant()""",
      "delaySeconds": ${delay.weeks.two},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUTYOU",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.aboutYouReminder},
        "linkedActivityCode": "ABOUTYOU",
        "language": "en",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["CMI-OSTEO"].forms["ABOUTYOU"].isStatus("COMPLETE")""",
      "preconditionExpr":"""!user.studies["CMI-OSTEO"].isGovernedParticipant()""",
      "delaySeconds": ${delay.weeks.two},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "FAMILY_HISTORY_SELF",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.familyHistoryReminder},
        "language": "en",
        "pdfAttachments": []
      },
      "preconditionExpr":"!user.studies[\"CMI-OSTEO\"].isGovernedParticipant()",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "FAMILY_HISTORY_SELF",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.familyHistoryReminder},
        "language": "en",
        "pdfAttachments": []
      },
      "preconditionExpr":"!user.studies[\"CMI-OSTEO\"].isGovernedParticipant()",
      "delaySeconds": ${delay.weeks.two},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "FAMILY_HISTORY_SELF",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.familyHistoryReminderParental},
        "language": "en",
        "pdfAttachments": []
      },
      "preconditionExpr":"user.studies[\"CMI-OSTEO\"].isGovernedParticipant()",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "FAMILY_HISTORY_SELF",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.familyHistoryReminderParental},
        "language": "en",
        "pdfAttachments": []
      },
      "preconditionExpr":"user.studies[\"CMI-OSTEO\"].isGovernedParticipant()",
      "delaySeconds": ${delay.weeks.two},
      "dispatchToHousekeeping": true,
      "order": 1
    }
  ]
}

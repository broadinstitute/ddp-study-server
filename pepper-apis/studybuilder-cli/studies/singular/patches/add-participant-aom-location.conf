{
  description = "Adds Country & State/Province questions to the ADD_PARTICIPANT child & dependent flows (PEPPER-16)"
  versionTag = "v1"
  study = "singular"
  content = [
    {
      activity = "ADD_PARTICIPANT_DEPENDENT"
      insert-after = "ENROLLING_DEPENDENT_AGE"
      questions = [
        {
          blockType = "QUESTION"
          shownExpr = null

          question {
            include required("../../snippets/picklist-question-country-required-eligible-first.conf")

            stableId = "ADD_PARTICIPANT_COUNTRY_DEPENDENT"
            hideNumber = true

            promptTemplate {
              templateType = "HTML"
              templateText = """
                <h3 class="activity-question-title">$add_participant_dependent_country_prompt</h3>
                <p class="activity-question-footnote">$add_participant_dependent_country_footnote</p>
              """,
              variables = [
                {
                  name = "add_participant_dependent_country_prompt"
                  translations = [
                    { language = "en", text = ${i18n.en.add_participant.dependent.country.prompt} }
                  ]
                },
                {
                  name = "add_participant_dependent_country_footnote"
                  translations = [
                    { language = "en", text = ${i18n.en.add_participant.dependent.country.footnote} }
                  ]
                }
              ]
            }

            picklistLabelTemplate {
              templateType = "TEXT"
              templateText = "$add_participant_dependent_country_label"
              variables = [
                {
                  name = "add_participant_dependent_country_label"
                  translations = [
                    { language = "en", text = ${i18n.en.add_participant.dependent.country.label} }
                  ]
                }
              ]
            }

            validations = [
              {
                ruleType = "REQUIRED"
                hintTemplate {
                  templateType = "TEXT"
                  templateText = "$add_participant_dependent_country_required_hint"
                  variables = [
                    {
                      name = "add_participant_dependent_country_required_hint"
                      translations = [
                        { language = "en", text = ${i18n.en.add_participant.dependent.country.required_hint} }
                      ]
                    }
                  ]
                }
              }
            ]
          }
        }

        // State for US
        {
          blockType = "QUESTION"
          shownExpr = """
            user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ADD_PARTICIPANT_COUNTRY_DEPENDENT"].answers.hasOption("US")
          """
          question {
            include required("../../snippets/picklist-question-state-required.conf")

            stableId = "ADD_PARTICIPANT_STATE_DEPENDENT"
            hideNumber = true

            picklistLabelTemplate {
              templateType = "TEXT"
              templateText = "$add_participant_dependent_state_label"
              variables = [
                {
                  name = "add_participant_dependent_state_label"
                  translations = [
                      { language = "en", text = ${i18n.en.add_participant.dependent.state.label} }
                  ]
                }
              ]
            }
            
            validations = [
              {
                ruleType = "REQUIRED"
                hintTemplate {
                  templateType = "TEXT"
                  templateText = "$add_participant_dependent_state_required_hint"
                  variables = [
                    {
                      name = "add_participant_dependent_state_required_hint"
                      translations = [
                        { language = "en", text = ${i18n.en.add_participant.dependent.state.required_hint} }
                      ]
                    }
                  ]
                }
              }
            ]
          }
        }

        // Province for Canada
        {
          blockType = "QUESTION"
          shownExpr = """
            user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ADD_PARTICIPANT_COUNTRY_DEPENDENT"].answers.hasOption("CA")
          """
  
          question {
            include required("../../snippets/picklist-question-province-required.conf")

            stableId = "ADD_PARTICIPANT_PROVINCE_DEPENDENT"
            hideNumber = true

            picklistLabelTemplate {
              templateType = "TEXT",
              templateText = "$add_participant_dependent_province_label",
              variables = [
                {
                  name = "add_participant_dependent_province_label",
                  translations = [
                    { language = "en", text = ${i18n.en.add_participant.dependent.province.label} }
                  ]
                }
              ]
            }

            validations = [
              {
                ruleType = "REQUIRED"

                hintTemplate {
                  templateType = "TEXT"
                  templateText = "$add_participant_dependent_province_required_hint"
                  variables = [
                    {
                      name = "add_participant_dependent_province_required_hint"
                      translations = [
                        { language = "en", text = ${i18n.en.add_participant.dependent.province.required_hint} }
                      ]
                    }
                  ]
                }
              }
            ]
          }
        }
      ]
    },

    {
      activity = "ADD_PARTICIPANT_PARENTAL"
      insert-after = "ENROLLING_CHILD_AGE"

      questions = [
        {
          blockType = "QUESTION"
          shownExpr = null
          question {
            include required("../../snippets/picklist-question-country-required-eligible-first.conf")

            stableId = "ADD_PARTICIPANT_COUNTRY_DEPENDENT"
            hideNumber = true
            promptTemplate {
              templateType = "HTML"
              templateText = """
                <h3 class="activity-question-title">$add_participant_dependent_country_prompt</h3>
                <p class="activity-question-footnote">$add_participant_dependent_country_footnote</p>
              """

              variables = [
                {
                  name = "add_participant_dependent_country_prompt"
                  translations = [
                    { language = "en", text = ${i18n.en.add_participant.dependent.country.prompt} }
                  ]
                },
                {
                  name = "add_participant_dependent_country_footnote"
                  translations = [
                    { language = "en", text = ${i18n.en.add_participant.dependent.country.footnote} }
                  ]
                }
              ]
            }

            picklistLabelTemplate {
              templateType = "TEXT"
              templateText = "$add_participant_dependent_country_label"
              variables = [
                {
                  name = "add_participant_dependent_country_label"
                  translations = [
                    { language = "en", text = ${i18n.en.add_participant.dependent.country.label} }
                  ]
                }
              ]
            },
            validations = [
              {
                ruleType = "REQUIRED"

                hintTemplate = {
                  templateType = "TEXT"
                  templateText = "$add_participant_dependent_country_required_hint"
                  variables = [
                    {
                      name = "add_participant_dependent_country_required_hint"
                      translations = [
                        { language = "en", text = ${i18n.en.add_participant.dependent.country.required_hint} }
                      ]
                    }
                  ]
                }
              }
            ]
          }
        },

        // State for US
        {
          blockType = "QUESTION"
          shownExpr = """
            user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ADD_PARTICIPANT_COUNTRY_DEPENDENT"].answers.hasOption("US")
          """

          question {
            include required("../../snippets/picklist-question-state-required.conf")

            stableId = "ADD_PARTICIPANT_STATE_DEPENDENT"
            hideNumber = true

            picklistLabelTemplate {
              templateType = "TEXT"
              templateText = "$add_participant_dependent_state_label"
              variables = [
                {
                  name = "add_participant_dependent_state_label"
                  translations = [
                    { language = "en", text = ${i18n.en.add_participant.dependent.state.label} }
                  ]
                }
              ]
            }

            validations = [
              {
                ruleType = "REQUIRED"
                hintTemplate = {
                  templateType = "TEXT"
                  templateText = "$add_participant_dependent_state_required_hint"
                  variables = [
                    {
                      name = "add_participant_dependent_state_required_hint"
                      translations = [
                        { language = "en", text = ${i18n.en.add_participant.dependent.state.required_hint} }
                      ]
                    }
                  ]
                }
              }
            ]
          }
        },

        // Province for Canada
        {
          blockType = "QUESTION"
          shownExpr = """
            user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ADD_PARTICIPANT_COUNTRY_DEPENDENT"].answers.hasOption("CA")
          """

          question {
            include required("../../snippets/picklist-question-province-required.conf")

            stableId = "ADD_PARTICIPANT_PROVINCE_DEPENDENT"
            hideNumber = true

            picklistLabelTemplate {
              templateType = "TEXT"
              templateText = "$add_participant_dependent_province_label"

              variables = [
                {
                  name = "add_participant_dependent_province_label"
                  translations = [
                    { language = "en", text = ${i18n.en.add_participant.dependent.province.label} }
                  ]
                }
              ]
            }

            validations = [
              {
                ruleType = "REQUIRED"
                hintTemplate {
                  templateType = "TEXT"
                  templateText = "$add_participant_dependent_province_required_hint"
                  variables = [
                    {
                      name = "add_participant_dependent_province_required_hint"
                      translations = [
                        { language = "en", text = ${i18n.en.add_participant.dependent.province.required_hint} }
                      ]
                    }
                  ]
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
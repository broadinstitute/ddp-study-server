{
  "events": [
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT_SELF",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_SELF"
      },
      "preconditionExpr": null,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT_PARENTAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_DEPENDENT"
      },
      "preconditionExpr": ${_pex.age_of_majority.child},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT_PARENTAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_PARENTAL"
      },
      "preconditionExpr": "!("${_pex.age_of_majority.child}")",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 3
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT_DEPENDENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_DEPENDENT"
      },
      "preconditionExpr": ${_pex.age_of_majority.dependent},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 4
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT_DEPENDENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_PARENTAL"
      },
      "preconditionExpr": "!("${_pex.age_of_majority.dependent}")",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 5
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_SELF",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "ABOUT_PATIENT"
       },
       "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()
          && user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].questions["ENROLLING_MYSELF_DIAGNOSED"].answers.hasOption("MYSELF")""",
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 1
      },
      {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_SELF",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING_SELF"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "ABOUT_PATIENT_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()
        && user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].questions["ENROLLING_MYSELF_DIAGNOSED"].answers.hasOption("MYSELF")""",
       "dispatchToHousekeeping": false,
       "order": 2
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_DEPENDENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING_DEPENDENT"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "ABOUT_PATIENT_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """
        (
          user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()
          && user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD")
        ) || (
          user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()
          && user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT")
        )
        """,
       "dispatchToHousekeeping": false,
       "order": 10
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_SELF",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_SELF_FIRST_NAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_SELF_LAST_NAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_LAST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_SELF_DATE_OF_BIRTH"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_BIRTH_DATE"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_SELF_FIRST_NAME"
            },
            "target": {
              "type": "OPERATOR_PROFILE_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_SELF_LAST_NAME"
            },
            "target": {
              "type": "OPERATOR_PROFILE_LAST_NAME"
            }
          }
        ]
      },
      "preconditionExpr": null,
      "cancelExpr": null,
      "maxOccurrencesPerUser": null,
      "delaySeconds": null,
      "dispatchToHousekeeping": false,
      "order": 3
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_SELF",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "ABOUT_HEALTHY"
       },
       "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()
       && !user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].questions["ENROLLING_MYSELF_DIAGNOSED"].answers.hasOption("MYSELF")""",
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 4
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_DEPENDENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "ABOUT_HEALTHY"
       },
       "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()
       && !user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT")""",
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 4
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_DEPENDENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "ABOUT_HEALTHY"
       },
       "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()
       && !user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD")""",
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 4
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "ABOUT_HEALTHY",
         "statusType": "CREATED"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING_SELF"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "ABOUT_HEALTHY_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """
          !user.studies["singular"].forms["ABOUT_HEALTHY"].instances[latest].hasPreviousInstance() &&
          user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()
          && !user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].questions["ENROLLING_MYSELF_DIAGNOSED"].answers.hasOption("MYSELF")""",
       "dispatchToHousekeeping": false,
       "order": 5
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "ABOUT_HEALTHY",
         "statusType": "CREATED"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING_DEPENDENT"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "ABOUT_HEALTHY_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """
          !user.studies["singular"].forms["ABOUT_HEALTHY"].instances[latest].hasPreviousInstance()
          && user.studies["singular"].forms["CONSENT_DEPENDENT"].hasInstance()
          && ((
            user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()
            && !user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT")
          ) || (
            user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()
            && !user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD")
          ))
       """,
       "dispatchToHousekeeping": false,
       "order": 5
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_PARENTAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_ASSENT"
      },
      "preconditionExpr": """
        (user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance() &&
        user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ADD_PARTICIPANT_INCAPACITATED"].answers.hasFalse()) ||
        (user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance() &&
        user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ADD_PARTICIPANT_INCAPACITATED_DEPENDENT"].answers.hasFalse())""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ASSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_PATIENT"
      },
      "preconditionExpr": """
        (user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance() &&
        user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD")) ||
        (user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance() &&
        user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT"))
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_DEPENDENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_PATIENT"
      },
      "preconditionExpr": """
        (user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance() &&
        user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT"))
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_DEPENDENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_PATIENT"
      },
      "preconditionExpr": """
        (user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance() &&
        user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD"))
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_PARENTAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_PATIENT"
      },
      "preconditionExpr": """
        !(user.studies["singular"].forms["CONSENT_ASSENT"].hasInstance()) &&
        (user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance() &&
        user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD")) ||
        (user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance() &&
        user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT"))
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
     "trigger": {
       "type": "ACTIVITY_STATUS",
       "activityCode": "CONSENT_PARENTAL",
       "statusType": "COMPLETE"
     },
     "action": {
       "type": "COPY_ANSWER",
       "copyConfigPairs": [
         {
           "source": {
             "type": "ANSWER",
             "questionStableId": "WHO_ENROLLING_PARENTAL"
           },
           "target": {
             "type": "ANSWER",
             "questionStableId": "ABOUT_PATIENT_WHO_ENROLLING_HIDDEN"
           }
         }
       ]
     },
     "preconditionExpr": """
        (
          !(user.studies["singular"].forms["CONSENT_ASSENT"].hasInstance()) &&
          user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance() &&
          user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD")
        ) || (
          !(user.studies["singular"].forms["CONSENT_ASSENT"].hasInstance()) &&
          user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance() &&
          user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT")
        )
     """,
     "dispatchToHousekeeping": false,
     "order": 3
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_PARENTAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_PARENTAL_CHILD_FIRST_NAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_PARENTAL_CHILD_LAST_NAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_LAST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_PARENTAL_CHILD_DATE_OF_BIRTH"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_BIRTH_DATE"
            }
          }
        ]
      },
      "preconditionExpr": null,
      "cancelExpr": null,
      "maxOccurrencesPerUser": null,
      "delaySeconds": null,
      "dispatchToHousekeeping": false,
      "order": 4
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_PARENTAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_PARENTAL_FIRST_NAME"
            },
            "target": {
              "type": "OPERATOR_PROFILE_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_PARENTAL_LAST_NAME"
            },
            "target": {
              "type": "OPERATOR_PROFILE_LAST_NAME"
            }
          }
        ]
      },
      "preconditionExpr": """!operator.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")"""
      "cancelExpr": null,
      "maxOccurrencesPerUser": null,
      "delaySeconds": null,
      "dispatchToHousekeeping": false,
      "order": 5
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_DEPENDENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_DEPENDENT_FIRST_NAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_DEPENDENT_LAST_NAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_LAST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_DEPENDENT_DATE_OF_BIRTH"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_BIRTH_DATE"
            }
          }
        ]
      },
      "preconditionExpr": null,
      "cancelExpr": null,
      "maxOccurrencesPerUser": null,
      "delaySeconds": null,
      "dispatchToHousekeeping": false,
      "order": 4
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_PARENTAL",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "ABOUT_HEALTHY"
       },
       "preconditionExpr": """
          !(user.studies["singular"].forms["CONSENT_ASSENT"].hasInstance()) &&
          !(user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance() &&
            user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD")) &&
          !(user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance() &&
            user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT"))
       """,
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 5
    },
    {
     "trigger": {
       "type": "ACTIVITY_STATUS",
       "activityCode": "CONSENT_ASSENT",
       "statusType": "COMPLETE"
     },
     "action": {
       "type": "COPY_ANSWER",
       "copyConfigPairs": [
         {
           "source": {
             "type": "ANSWER",
             "questionStableId": "WHO_ENROLLING_PARENTAL"
           },
           "target": {
             "type": "ANSWER",
             "questionStableId": "ABOUT_PATIENT_WHO_ENROLLING_HIDDEN"
           }
         }
       ]
     },
     "preconditionExpr": """
        ((
          user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()
          && user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD")
        ) || (
          user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance() &&
          user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT")
        ))
        && user.studies["singular"].forms["CONSENT_PARENTAL"].hasInstance()
     """,
     "dispatchToHousekeeping": false,
     "order": 2
    },
    {
     "trigger": {
       "type": "ACTIVITY_STATUS",
       "activityCode": "CONSENT_ASSENT",
       "statusType": "COMPLETE"
     },
     "action": {
       "type": "COPY_ANSWER",
       "copyConfigPairs": [
         {
           "source": {
             "type": "ANSWER",
             "questionStableId": "WHO_ENROLLING_DEPENDENT"
           },
           "target": {
             "type": "ANSWER",
             "questionStableId": "ABOUT_PATIENT_WHO_ENROLLING_HIDDEN"
           }
         }
       ]
     },
     "preconditionExpr": """
        ((
          user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()
          && user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD")
        ) || (
          user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()
          && user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT")
        ))
        && user.studies["singular"].forms["CONSENT_DEPENDENT"].hasInstance()
     """,
     "dispatchToHousekeeping": false,
     "order": 3
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_ASSENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "ABOUT_HEALTHY"
       },
       "preconditionExpr": """
          (user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance() &&
            !user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD")) ||
          (user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance() &&
            !user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT")),
       """,
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 3
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "ABOUT_HEALTHY",
         "statusType": "CREATED"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING_PARENTAL"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "ABOUT_HEALTHY_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """
          !user.studies["singular"].forms["ABOUT_HEALTHY"].instances[latest].hasPreviousInstance()
          && user.studies["singular"].forms["CONSENT_PARENTAL"].hasInstance()
          && ((
            user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()
            && !(user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("MY_CHILD"))
          ) || (
            user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()
            && !(user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_DIAGNOSED"].answers.hasOption("MY_DEPENDENT"))
          ))
        """,
       "dispatchToHousekeeping": false,
       "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_SELF_FIRST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_PATIENT_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_SELF_LAST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_PATIENT_LAST_NAME"
            }
          }
        ]
      },
      "preconditionExpr": """user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_DEPENDENT_FIRST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_PATIENT_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_DEPENDENT_LAST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_PATIENT_LAST_NAME"
            }
          }
        ]
      },
      "preconditionExpr": """
        !user.studies["singular"].forms["ABOUT_PATIENT"].instances[latest].hasPreviousInstance() &&
        user.studies["singular"].forms["CONSENT_DEPENDENT"].hasInstance()
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_PARENTAL_CHILD_FIRST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_PATIENT_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_PARENTAL_CHILD_LAST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_PATIENT_LAST_NAME"
            }
          }
        ]
      },
      "preconditionExpr": """
        !user.studies["singular"].forms["ABOUT_PATIENT"].instances[latest].hasPreviousInstance() &&
        user.studies["singular"].forms["CONSENT_PARENTAL"].hasInstance()
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 3
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "ABOUT_PATIENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "MEDICAL_RECORD_RELEASE"
       },
      "preconditionExpr": """!user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")"""
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 1
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "ABOUT_PATIENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "ABOUT_PATIENT_FIRST_NAME"
             },
             "target": {
               "type": "PARTICIPANT_PROFILE_FIRST_NAME"
             }
           },
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "ABOUT_PATIENT_LAST_NAME"
             },
             "target": {
               "type": "PARTICIPANT_PROFILE_LAST_NAME"
             }
           }
         ]
       },
       "preconditionExpr": """!user.studies["singular"].forms["ABOUT_PATIENT"].instances[latest].hasPreviousInstance()""",
       "dispatchToHousekeeping": false,
       "order": 2
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "ABOUT_PATIENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING_SELF"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "MRR_WHO_ENROLLING_COPY"
             }
           }
         ]
       },
       "preconditionExpr": """!user.studies["singular"].forms["ABOUT_PATIENT"].instances[latest].hasPreviousInstance() &&
          user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()
        """,
       "dispatchToHousekeeping": false,
       "order": 3
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "ABOUT_PATIENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING_PARENTAL"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "MRR_WHO_ENROLLING_COPY"
             }
           }
         ]
       },
       "preconditionExpr": """
          !user.studies["singular"].forms["ABOUT_PATIENT"].instances[latest].hasPreviousInstance()
          && user.studies["singular"].forms["CONSENT_PARENTAL"].hasInstance()
       """,
       "dispatchToHousekeeping": false,
       "order": 4
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "ABOUT_PATIENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING_DEPENDENT"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "MRR_WHO_ENROLLING_COPY"
             }
           }
         ]
       },
       "preconditionExpr": """
          !user.studies["singular"].forms["ABOUT_PATIENT"].instances[latest].hasPreviousInstance() &&
          user.studies["singular"].forms["CONSENT_DEPENDENT"].hasInstance()
       """,
       "dispatchToHousekeeping": false,
       "order": 5
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_SELF_DATE_OF_BIRTH"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "MRR_DATE_OF_BIRTH"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_SELF_DATE_OF_BIRTH"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "MRR_DOB"
            }
          }
        ]
      },
      "preconditionExpr": """user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_PARENTAL_CHILD_DATE_OF_BIRTH"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "MRR_DATE_OF_BIRTH"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_PARENTAL_CHILD_DATE_OF_BIRTH"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "MRR_DOB"
            }
          }
        ]
      },
      "preconditionExpr": """
        !user.studies["singular"].forms["MEDICAL_RECORD_RELEASE"].instances[latest].hasPreviousInstance() &&
        user.studies["singular"].forms["CONSENT_PARENTAL"].hasInstance()
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 3
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_DEPENDENT_DATE_OF_BIRTH"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "MRR_DATE_OF_BIRTH"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_DEPENDENT_DATE_OF_BIRTH"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "MRR_DOB"
            }
          }
        ]
      },
      "preconditionExpr": """
        !user.studies["singular"].forms["MEDICAL_RECORD_RELEASE"].instances[latest].hasPreviousInstance() &&
        user.studies["singular"].forms["CONSENT_DEPENDENT"].hasInstance()
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 3
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "MRR_DOB"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_BIRTH_DATE"
            }
          }
        ]
      },
      "preconditionExpr": true,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "MEDICAL_RECORD_FILE_UPLOAD",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "PATIENT_SURVEY"
       },
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "preconditionExpr": """!user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")"""
       "order": 1
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "PATIENT_SURVEY",
         "statusType": "CREATED"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING_SELF"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "PATIENT_SURVEY_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """
          !user.studies["singular"].forms["PATIENT_SURVEY"].instances[latest].hasPreviousInstance() &&
          user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()
        """,
       "dispatchToHousekeeping": false,
       "order": 1
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "PATIENT_SURVEY",
         "statusType": "CREATED"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING_PARENTAL"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "PATIENT_SURVEY_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """
          !user.studies["singular"].forms["PATIENT_SURVEY"].instances[latest].hasPreviousInstance() &&
          user.studies["singular"].forms["CONSENT_PARENTAL"].hasInstance()
        """,
       "dispatchToHousekeeping": false,
       "order": 2
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "PATIENT_SURVEY",
         "statusType": "CREATED"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING_DEPENDENT"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "PATIENT_SURVEY_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """
          !user.studies["singular"].forms["PATIENT_SURVEY"].instances[latest].hasPreviousInstance() &&
          user.studies["singular"].forms["CONSENT_DEPENDENT"].hasInstance()
        """,
       "dispatchToHousekeeping": false,
       "order": 3
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_HEALTHY",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_SELF_FIRST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_HEALTHY_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_SELF_LAST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_HEALTHY_LAST_NAME"
            }
          }
        ]
      },
      "preconditionExpr": """
        !user.studies["singular"].forms["ABOUT_HEALTHY"].instances[latest].hasPreviousInstance() &&
        user.studies["singular"].forms["CONSENT_SELF"].hasInstance()
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_HEALTHY",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_PARENTAL_CHILD_FIRST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_HEALTHY_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_PARENTAL_CHILD_LAST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_HEALTHY_LAST_NAME"
            }
          }
        ]
      },
      "preconditionExpr": """
        !user.studies["singular"].forms["ABOUT_HEALTHY"].instances[latest].hasPreviousInstance() &&
        user.studies["singular"].forms["CONSENT_PARENTAL"].hasInstance()
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_HEALTHY",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_DEPENDENT_FIRST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_HEALTHY_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "CONSENT_DEPENDENT_LAST_NAME"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_HEALTHY_LAST_NAME"
            }
          }
        ]
      },
      "preconditionExpr": """
        !user.studies["singular"].forms["ABOUT_HEALTHY"].instances[latest].hasPreviousInstance() &&
        user.studies["singular"].forms["CONSENT_DEPENDENT"].hasInstance()
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    # when CONSENT_SELF COMPLETE
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_SELF",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "USER_ENROLLED"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    # when CONSENT_ASSENT COMPLETE
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_PARENTAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "USER_ENROLLED"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    # when CONSENT_DEPENDENT COMPLETE
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_DEPENDENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "USER_ENROLLED"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    # reconsent flow
    ## When preparing for age-up, collect child contact email
    {
      "trigger": {
        "type": "REACHED_AOM_PREP"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CHILD_CONTACT"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    ## When child-contact created, send email to proxy
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CHILD_CONTACT",
        "statusType": "CREATED"
      }
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_child_age_of_majority_en}, "language": "en", "isDynamic": true }
        ],
        "linkedActivityCode": "CHILD_CONTACT",
        "pdfAttachments": []
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    ## Queue up 1 week reminder for child-contact
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CHILD_CONTACT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_child_age_of_majority_reminder_en}, "language": "en", "isDynamic": true }
        ],
        "linkedActivityCode": "CHILD_CONTACT",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 2
    },
    ## When child-contact completed, create the age-up invitation
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CHILD_CONTACT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "CREATE_INVITATION",
        "markExistingAsVoided": true,
        "contactEmailQuestionStableId": "CHILD_CONTACT_EMAIL"
      },
      "dispatchToHousekeeping": false,
      "order": 1
    },
    ## When age-up invitation created, send verification email to child
    {
      "trigger": {
        "type": "INVITATION_CREATED"
      },
      "action": {
        "type": "INVITATION_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_child_age_of_majority_email_verification_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      # If invitation is created after child participant reached AOM,
      # then skip verification email since we'll send out the next-steps emails.
      # "cancelExpr": """user.studies["singular"].hasAgedUp()""",
      "dispatchToHousekeeping": true,
      "order": 1
    },
    ## When a child REACHED_AOM we hide CHILD_CONTACT activity if it is not COMPLETED
    {
      "trigger": {
        "type": "REACHED_AOM"
      },
      "action": {
        "type": "HIDE_ACTIVITIES",
        "activityCodes": ["CHILD_CONTACT"]
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    ## When consent status is suspended on age-up, make parental activities read-only
    {
      "trigger": {
        "type": "CONSENT_SUSPENDED"
      },
      "action": {
        "type": "MARK_ACTIVITIES_READ_ONLY",
        "activityCodes": ["ABOUT_PATIENT", "ABOUT_HEALTHY","MEDICAL_RECORD_RELEASE", "MEDICAL_RECORD_FILE_UPLOAD", "PATIENT_SURVEY"]
      },
      "dispatchToHousekeeping": false,
      "order": 1
    },
    ## When age-up occurs, send invitation to child
    {
      "trigger": {
        "type": "REACHED_AOM"
      },
      "action": {
        "type": "INVITATION_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_child_age_of_majority_signup_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    ## Queue up 2 week reminder for next steps email
    {
      "trigger": {
        "type": "REACHED_AOM"
      },
      "action": {
        "type": "INVITATION_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_child_age_of_majority_signup_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["singular"].forms["CONSENT_SELF"].hasInstance()""",
      "delaySeconds": ${delay.weeks.two},
      "dispatchToHousekeeping": true,
      "order": 2
    },
    ## Queue up 4 week reminder for next steps email
    {
      "trigger": {
        "type": "REACHED_AOM"
      },
      "action": {
        "type": "INVITATION_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_child_age_of_majority_signup_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["singular"].forms["CONSENT_SELF"].hasInstance()""",
      "delaySeconds": ${delay.weeks.four},
      "dispatchToHousekeeping": true,
      "order": 3
    },
    ## When child registers, create the self consent
    {
      "trigger": {
        "type": "GOVERNED_USER_REGISTERED"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_SELF"
      },
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "GOVERNED_USER_REGISTERED"
      },
      "action": {
        "type": "ANNOUNCEMENT",
        "permanent": true,
        "createForProxies": true,
        "msgTemplate": { include required("snippets/former-proxy-announcement-msg.conf") }
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
      "trigger": {
        "type": "GOVERNED_USER_REGISTERED"
      },
      "action": {
        "type": "REVOKE_PROXIES"
      },
      "dispatchToHousekeeping": false,
      # Order here is important. Since announcement `createForProxies` only create for active proxies,
      # we should queue up announcement before inactivating proxy.
      "order": 3
    },
    ## Queue up 1 week reminder for next steps email
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_SELF",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_child_age_of_majority_form_reminder_en}, "language": "en", "isDynamic": true }
        ],
        "linkedActivityCode": "CONSENT_SELF",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()
        || user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.one},
      "dispatchToHousekeeping": true,
      "order": 1
    },
    ## Queue up 2 weeks reminder for next steps email
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_SELF",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_child_age_of_majority_form_reminder_en}, "language": "en", "isDynamic": true }
        ],
        "linkedActivityCode": "CONSENT_SELF",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()
        || user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.two},
      "dispatchToHousekeeping": true,
      "order": 2
    },
    ## Queue up 4 weeks reminder for next steps email
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_SELF",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_child_age_of_majority_form_reminder_en}, "language": "en", "isDynamic": true }
        ],
        "linkedActivityCode": "CONSENT_SELF",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()
        || user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.four},
      "dispatchToHousekeeping": true,
      "order": 3
    },


    ## Emails

    ## Welcome email

    {
      "trigger": {
        "type": "USER_REGISTERED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.welcome_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    ## CONSENT_PARENTAL reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_PARENTAL",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_reminder_child_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "CONSENT_PARENTAL",
        "pdfAttachments": []
      },
      "cancelExpr": """
        user.studies["singular"].forms["CONSENT_PARENTAL"].isStatus("COMPLETE")
      """,
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## CONSENT_PARENTAL reminder #2 (6 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_PARENTAL",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_reminder_child_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "CONSENT_PARENTAL",
        "pdfAttachments": []
      },
      "cancelExpr": """
        user.studies["singular"].forms["CONSENT_PARENTAL"].isStatus("COMPLETE")
      """,
      "delaySeconds": ${delay.weeks.six},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## CONSENT_SELF reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_SELF",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_reminder_self_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "CONSENT_SELF",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()
        || user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")
      """,
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## CONSENT_SELF reminder #2 (6 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_SELF",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_reminder_self_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "CONSENT_SELF",
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()
        || user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")
      """,
      "delaySeconds": ${delay.weeks.six},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## CONSENT_DEPENDENT, reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_DEPENDENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_reminder_dependent_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "CONSENT_DEPENDENT",
        "pdfAttachments": []
      },
      "cancelExpr": """
        user.studies["singular"].forms["CONSENT_DEPENDENT"].isStatus("COMPLETE")
      """,
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## CONSENT_DEPENDENT, reminder #2 (6 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_DEPENDENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.consent_reminder_dependent_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "CONSENT_DEPENDENT",
        "pdfAttachments": []
      },
      "cancelExpr": """
        user.studies["singular"].forms["CONSENT_DEPENDENT"].isStatus("COMPLETE")
      """,
      "delaySeconds": ${delay.weeks.six},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## ABOUT_ME reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.about_me_reminder_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "ABOUT_PATIENT",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["ABOUT_PATIENT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## ABOUT_ME reminder #2 (6 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.about_me_reminder_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "ABOUT_PATIENT",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["ABOUT_PATIENT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.six},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## ABOUT_MY_CHILD reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.about_my_child_reminder_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "ABOUT_PATIENT",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["ABOUT_PATIENT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## ABOUT_MY_CHILD reminder #2 (6 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.about_my_child_reminder_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "ABOUT_PATIENT",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["ABOUT_PATIENT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.six},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## ABOUT_MY_DEPENDENT, reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.about_dependent_reminder_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "ABOUT_PATIENT",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["ABOUT_PATIENT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## ABOUT_MY_DEPENDENT reminder #2 (6 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.about_dependent_reminder_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "ABOUT_PATIENT",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["ABOUT_PATIENT"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.six},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## MEDICAL_RECORD_RELEASE_SELF reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.medical_release_reminder_self_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "MEDICAL_RECORD_RELEASE",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["MEDICAL_RECORD_RELEASE"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## MEDICAL_RECORD_RELEASE_SELF reminder #2 (6 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.medical_release_reminder_self_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "MEDICAL_RECORD_RELEASE",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["MEDICAL_RECORD_RELEASE"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.six},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## MEDICAL_RECORD_RELEASE_MY_CHILD reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.parental_medical_release_reminder_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "MEDICAL_RECORD_RELEASE",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["MEDICAL_RECORD_RELEASE"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## MEDICAL_RECORD_RELEASE_MY_CHILD reminder #2 (6 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.parental_medical_release_reminder_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "MEDICAL_RECORD_RELEASE",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["MEDICAL_RECORD_RELEASE"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.six},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## MEDICAL_RECORD_RELEASE_DEPENDENT reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.medical_release_reminder_dependent_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "MEDICAL_RECORD_RELEASE",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["MEDICAL_RECORD_RELEASE"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## MEDICAL_RECORD_RELEASE_DEPENDENT reminder #2 (6 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.medical_release_reminder_dependent_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "MEDICAL_RECORD_RELEASE",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["MEDICAL_RECORD_RELEASE"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.six},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## PATIENT_SURVEY_SELF reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PATIENT_SURVEY",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.patient_survey_reminder_self_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "PATIENT_SURVEY",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["PATIENT_SURVEY"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## PATIENT_SURVEY_MY_CHILD reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PATIENT_SURVEY",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.patient_survey_reminder_child_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "PATIENT_SURVEY",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["PATIENT_SURVEY"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## PATIENT_SURVEY_DEPENDENT reminder #1 (3 weeks)
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PATIENT_SURVEY",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.patient_survey_reminder_dependent_en}, "language": "en", "isDynamic": true },
        ],
        "linkedActivityCode": "PATIENT_SURVEY",
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()""",
      "cancelExpr": """user.studies["singular"].forms["PATIENT_SURVEY"].isStatus("COMPLETE")""",
      "delaySeconds": ${delay.weeks.three},
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## "Thank You" email SELF
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PATIENT_SURVEY",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.completion_thank_you_self_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## "Thank You" email SELF HEALTHY
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_HEALTHY",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.completion_thank_you_self_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "preconditionExpr":"""user.studies["singular"].forms["ADD_PARTICIPANT_SELF"].hasInstance()"""
      "cancelExpr": null,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 2,
    },

    ## "Thank You" email MY_CHILD
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PATIENT_SURVEY",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.completion_thank_you_child_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "preconditionExpr":"""user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()"""
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },

    ## "Thank You" email MY_CHILD HEALTHY
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_HEALTHY",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.completion_thank_you_child_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "preconditionExpr":"""user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()"""
      "cancelExpr": null,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },

    ## "Thank You" email DEPENDENT
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PATIENT_SURVEY",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.completion_thank_you_dependent_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "preconditionExpr":"""user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()"""
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },

    ## "Thank You" email DEPENDENT HEALTHY
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_HEALTHY",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.completion_thank_you_dependent_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "preconditionExpr":"""user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()"""
      "cancelExpr": null,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## When DSM notifications received SELF
    {
      "trigger": {
        "type": "DSM_NOTIFICATION",
        "dsmEvent": "SALIVA_RECEIVED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.sample_received_self_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "preconditionExpr": """user.studies["singular"].forms["CONSENT_SELF"].hasInstance()"""
      "dispatchToHousekeeping": true,
      "order": 2,
    },
    ## When DSM notifications received MY_CHILD
    {
      "trigger": {
        "type": "DSM_NOTIFICATION",
        "dsmEvent": "SALIVA_RECEIVED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.sample_received_child_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "preconditionExpr":"""user.studies["singular"].isGovernedParticipant() && user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].hasInstance()"""
      "dispatchToHousekeeping": true,
      "order": 3,
    },
    ## When DSM notifications received DEPENDENT
    {
      "trigger": {
        "type": "DSM_NOTIFICATION",
        "dsmEvent": "SALIVA_RECEIVED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          { "emailTemplate": ${emails.sample_received_dependent_en}, "language": "en", "isDynamic": true },
        ],
        "pdfAttachments": []
      },
      "preconditionExpr":"""user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].hasInstance()"""
      "dispatchToHousekeeping": true,
      "order": 4
    },

    //Activity Instance Copy
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyFromPreviousInstance": true,
        "copyConfigPairs": []
      },
      "order": 1,
      "dispatchToHousekeeping": false,
      "preconditionExpr": """!user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")"""
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyFromPreviousInstance": true,
        "copyConfigPairs": []
      },
      "order": 1,
      "dispatchToHousekeeping": false,
      "preconditionExpr": """!user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")"""
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PATIENT_SURVEY",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyFromPreviousInstance": true,
        "copyConfigPairs": []
      },
      "order": 1,
      "dispatchToHousekeeping": false,
      "preconditionExpr": """!user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")"""
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_HEALTHY",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyFromPreviousInstance": true,
        "copyConfigPairs": []
      },
      "order": 1,
      "dispatchToHousekeeping": false
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_FILE_UPLOAD",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyFromPreviousInstance": true,
        "copyConfigPairs": []
      },
      "order": 1,
      "dispatchToHousekeeping": false,
      "preconditionExpr": """!user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")"""
    },

    # ANNOUNCEMENT: pop-up message to the dashboard when a user completes the myself enrollment process.
    # Thank you for enrolling!
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT_SELF",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ANNOUNCEMENT",
        "msgTemplate": {
          "templateType": "HTML",
          "templateText": """<p class="infobox-text_small">$singular_announcement_enroll_self_p1</p>""",
          "variables": [
            {
              "name": "singular_announcement_enroll_self_p1",
              "translations": [
                { "language": "en", "text": ${i18n.en.banners.enroll_self} }
              ]
            }
          ]
        }
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },

    # ANNOUNCEMENT: pop-up message to the dashboard when a user completes the my child enrollment process.
    # Thank you for enrolling your child!
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT_PARENTAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ANNOUNCEMENT",
        "msgTemplate": {
          "templateType": "HTML",
          "templateText": """<p class="infobox-text_small">$singular_announcement_enroll_child_p1</p>""",
          "variables": [
            {
              "name": "singular_announcement_enroll_child_p1",
              "translations": [
                { "language": "en", "text": ${i18n.en.banners.enroll_child} }
              ]
            }
          ]
        }
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_AGE"].answers.value() < 18)"""
      "maxOccurrencesPerUser": null,
      "dispatchToHousekeeping": false,
      "order": 4
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT_PARENTAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ANNOUNCEMENT",
        "msgTemplate": {
          "templateType": "HTML",
          "templateText": """<p class="infobox-text_small">$singular_announcement_enroll_depend_p1</p>""",
          "variables": [
            {
              "name": "singular_announcement_enroll_depend_p1",
              "translations": [
                { "language": "en", "text": ${i18n.en.banners.enroll_dependent} }
              ]
            }
          ]
        }
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_PARENTAL"].questions["ENROLLING_CHILD_AGE"].answers.value() >= 18)"""
      "maxOccurrencesPerUser": null,
      "dispatchToHousekeeping": false,
      "order": 5
    },
    # ANNOUNCEMENT: pop-up message to the dashboard when a user completes the my dependent enrollment process.
    # Thank you for enrolling your dependent!
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT_DEPENDENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ANNOUNCEMENT",
        "msgTemplate": {
          "templateType": "HTML",
          "templateText": """<p class="infobox-text_small">$singular_announcement_enroll_depend_p1</p>""",
          "variables": [
            {
              "name": "singular_announcement_enroll_depend_p1",
              "translations": [
                { "language": "en", "text": ${i18n.en.banners.enroll_dependent} }
              ]
            }
          ]
        }
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_AGE"].answers.value() >= 18)"""
      "maxOccurrencesPerUser": null,
      "dispatchToHousekeeping": false,
      "order": 6
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT_DEPENDENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ANNOUNCEMENT",
        "msgTemplate": {
          "templateType": "HTML",
          "templateText": """<p class="infobox-text_small">$singular_announcement_enroll_child_p1</p>""",
          "variables": [
            {
              "name": "singular_announcement_enroll_child_p1",
              "translations": [
                { "language": "en", "text": ${i18n.en.banners.enroll_child} }
              ]
            }
          ]
        }
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT_DEPENDENT"].questions["ENROLLING_DEPENDENT_AGE"].answers.value() < 18)"""
      "maxOccurrencesPerUser": null,
      "dispatchToHousekeeping": false,
      "order": 7
    },

    #Events to support AOM
    ## after submitting new consent
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_SELF",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "HIDE_ACTIVITIES",
        "activityCodes": ["CONSENT_PARENTAL", "CONSENT_ASSENT", "ABOUT_HEALTHY", "MEDICAL_RECORD_RELEASE", "CHILD_CONTACT", "MEDICAL_RECORD_FILE_UPLOAD", "PATIENT_SURVEY"]
      },
      "preconditionExpr": """user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")""",
      "dispatchToHousekeeping": false,
      "order": 6
    },

    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_SELF",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_PATIENT"
      },
      "preconditionExpr": """user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")
                              && user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")"""
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 7
    },

    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "WHO_ENROLLING_SELF"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "ABOUT_PATIENT_WHO_ENROLLING_HIDDEN"
            }
          },
        ]
      },
      "preconditionExpr": """user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")
                              && user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")"""
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 6
    }

    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUT_PATIENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "MEDICAL_RECORD_RELEASE"
      },
      "maxOccurrencesPerUser": 2,
      "dispatchToHousekeeping": false,
      "order": 2
      "preconditionExpr": """user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")
                              && user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")"""
    },

    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "WHO_ENROLLING_SELF"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "MRR_WHO_ENROLLING_COPY"
            }
          },
        ]
      },
      "preconditionExpr": """user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")
                              && user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")"""
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 6
    },

    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "MEDICAL_RECORD_FILE_UPLOAD"
      },
      "dispatchToHousekeeping": false,
      "order": 1
    },

    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_RECORD_FILE_UPLOAD",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "PATIENT_SURVEY"
      },
      "maxOccurrencesPerUser": 2,
      "dispatchToHousekeeping": false,
      "order": 2
      "preconditionExpr": """user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")
                              && user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")"""
    },

    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PATIENT_SURVEY",
        "statusType": "CREATED"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "WHO_ENROLLING_SELF"
            },
            "target": {
              "type": "ANSWER",
              "questionStableId": "PATIENT_SURVEY_WHO_ENROLLING_HIDDEN"
            }
          }
        ]
      },
      "preconditionExpr": """user.studies["singular"].forms["CHILD_CONTACT"].isStatus("COMPLETE")
                              && user.studies["singular"].forms["CONSENT_SELF"].isStatus("COMPLETE")"""
      "dispatchToHousekeeping": false,
      "order": 4
    }

  ]
}

{
  "tenant": {
    "domain": ${auth0.domain},
    "mgmtClientId": ${auth0.mgmtClientId},
    "mgmtSecret": ${auth0.mgmtSecret}
  },

  "umbrella": {
    "name": "RGP",
    "guid": "rgp"
  },

  "study": {
    "name": "rgpproject",
    "guid": ${id.study},
    "studyEmail": "raregenomes@broadinstitute.org",
    "baseWebUrl": ${baseWebUrl},
    "irbPassword": ${irbPassword},
    "plusCodePrecision": MEDIUM,
    "shareParticipantLocation": false
  },

  "client": {
    "id": ${auth0.clientId},
    "secret": ${auth0.clientSecret},
    "passwordRedirectUrl": ${passwordRedirectUrl}
  },

  "adminUser": {
    "guid": "PEPPERRGPADMINUSER"
  },

  "studyDetails": [],

  "supportedLanguages": [
    {
      "language": "en",
      "name": "English",
      "isDefault": true
    },
    // Look DDP-5506: disabled until Spanish translations are in place
    //{
    //  "language": "es",
    //  "name": "Espa√±ol",
    //  "isDefault": false
    //}
  ],

  "settings": {
    "shouldDisplayLanguageChangePopup": true
  },

  "sendgrid": {
    "apiKey": ${sendgridApiKey},
    "fromName": ${sendgridFromName},
    "fromEmail": ${sendgridFromEmail},
    "defaultSalutation": ${sendgridDefaultSalutation}
  },

  "sendgridEmails": [],

  "kits": [],

  "activityTimestamp": "2017-05-25T17:36:00Z",
  "activities": [
    {
      "filepath": "prequal.conf",
      "mappings": [],
      "validations": []
    },
    {
      "filepath": "enrollment.conf",
      "mappings": [],
      "validations": [],
      "nestedActivities": [
        "mother.conf",
        "father.conf",
        "sibling.conf",
        "child.conf",
        "relative.conf"
      ]
    }
  ]

  "activityStatusIcons": [],

  "pdfs": [],

  "workflowTransitions": [
    # Main study workflow
    {
      "from": {
        "type": "START"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "PREQUAL",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY"
        "activityCode": "PREQUAL",
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "ENROLLMENT",
          "expression": """user.studies["RGP"].forms["PREQUAL"].hasInstance() &&
                           user.studies["RGP"].forms["PREQUAL"].questions["GENERAL_INFO"].answers.hasOption("ENGLISH") &&
                           user.studies["RGP"].forms["PREQUAL"].questions["GENERAL_INFO"].answers.hasOption("RESIDENT") &&
                           user.studies["RGP"].forms["PREQUAL"].questions["GENERAL_INFO"].answers.hasOption("RARE_CONDITION") &&
                           user.studies["RGP"].forms["PREQUAL"].questions["GENERAL_INFO"].answers.hasOption("UNDER_CARE")"""
        },
        {
          "type": "MAILING_LIST",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY"
        "activityCode": "ENROLLMENT"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "ENROLLMENT",
          "expression": """user.studies["RGP"].forms["ENROLLMENT"].hasInstance() &&
                         !user.studies["RGP"].forms["ENROLLMENT"].isStatus("COMPLETE")"""
        },
        {
          "type": "DASHBOARD",
          "expression": "true"
        }
      ]
    }

    # Return user workflow
    {
      "from": {
        "type": "RETURN_USER"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "ENROLLMENT",
          "expression": """!user.studies["RGP"].forms["ENROLLMENT"].hasInstance() ||
                           !user.studies["RGP"].forms["ENROLLMENT"].isStatus("COMPLETE")"""
        },
        {
          "type": "DASHBOARD",
          "expression": """user.studies["RGP"].forms["ENROLLMENT"].isStatus("COMPLETE")"""
        }
      ]
    },

  ],

  "events": [
    # activity instance creation events
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PREQUAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ENROLLMENT"
      },
      "preconditionExpr": """user.studies["RGP"].forms["PREQUAL"].questions["GENERAL_INFO"].answers.hasOption("ENGLISH") &&
                             user.studies["RGP"].forms["PREQUAL"].questions["GENERAL_INFO"].answers.hasOption("RESIDENT") &&
                             user.studies["RGP"].forms["PREQUAL"].questions["GENERAL_INFO"].answers.hasOption("RARE_CONDITION") &&
                             user.studies["RGP"].forms["PREQUAL"].questions["GENERAL_INFO"].answers.hasOption("UNDER_CARE")""",
      "cancelExpr": null,
      "maxOccurrencesPerUser": 1,
      "delaySeconds": null,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ENROLLMENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "FILLER_FIRST_NAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_FIRST_NAME"
            }
          }
        ]
      },
      "preconditionExpr": null,
      "cancelExpr": null,
      "maxOccurrencesPerUser": null,
      "delaySeconds": null,
      "dispatchToHousekeeping": false,
      "order": 1
    },

    # DSM writes "workflows" into ES and generates things like family_id, but this doesn't happen
    # until the participant list page is visited. So we push an "update" message to DSM to force it
    # to generate/write out these values. A good extension point we can hook into will be when they
    # register. We also need to account for migrated users (migrated ones won't have "registered"
    # event triggered). For the RGP study, this "registered" event happens only after user has
    # verified their email and logs in for the first time, which is an ideal time to initiate this.
    {
      "trigger": {
        "type": "USER_REGISTERED"
      },
      "action": {
        "type": "UPDATE_CUSTOM_WORKFLOW",
        "workflow": "ACCEPTANCE_STATUS",
        "status": "PRE_REVIEW"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    }
  ]

}

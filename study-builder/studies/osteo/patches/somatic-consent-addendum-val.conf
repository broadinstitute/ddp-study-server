{
  "activityFilepath": [
    {
      "name": "somatic-consent-addendum.conf",
      "nested": []
    },
    {
      "name": "somatic-consent-addendum-pediatric.conf",
      "nested": []
    }
  ],
  "events": [
    {
      "trigger": {
        "type": "REACHED_AOM"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT"
      },
      "dispatchToHousekeeping": false,
      "maxOccurrencesPerUser": 1,
      "order": 1
    },
    {
      "trigger": {
        "type": "CONSENT_SUSPENDED"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT"
      },
      "dispatchToHousekeeping": false,
      "maxOccurrencesPerUser": 1,
      "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_ADDENDUM"
      },
      "preconditionExpr": """
                    !(
                        user.studies["CMI-OSTEO"].forms["PREQUAL"].questions["SELF_COUNTRY"].answers.hasOption("CA")
                        || user.studies["CMI-OSTEO"].forms["PREQUAL"].questions["SELF_STATE"].answers.hasOption("NY")
                        || user.studies["CMI-OSTEO"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("CA")
                        || user.studies["CMI-OSTEO"].forms["PREQUAL"].questions["CHILD_STATE"].answers.hasOption("NY")
                    )
                    &&
                    user.studies["CMI-OSTEO"].forms["CONSENT"].questions["CONSENT_TISSUE"].answers.hasTrue()
      """
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ASSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC"
      },
      "preconditionExpr": """!(user.studies["CMI-OSTEO"].forms["PREQUAL"].questions["CHILD_COUNTRY"].answers.hasOption("CA") ||
                   user.studies["CMI-OSTEO"].forms["PREQUAL"].questions["CHILD_STATE"].answers.hasOption("NY")) &&
                   user.studies["CMI-OSTEO"].forms["CONSENT_ASSENT"].questions["CONSENT_ASSENT_TISSUE"].answers.hasTrue()"""
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PARENTAL_CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC"
      },
      "preconditionExpr": """!(user.studies["CMI-OSTEO"].forms["PREQUAL"].questions["SELF_COUNTRY"].answers.hasOption("CA")
        || user.studies["CMI-OSTEO"].forms["PREQUAL"].questions["SELF_STATE"].answers.hasOption("NY"))
        && user.studies["CMI-OSTEO"].forms["CONSENT"].questions["CONSENT_TISSUE"].answers.hasTrue()"""
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    }
  ],
  "workflows": [
    {
      "from": {
        "type": "ACTIVITY"
        "activityCode": "CONSENT",
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "CONSENT_ADDENDUM",
          "expression": """user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM"].hasInstance()"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "RELEASE_SELF",
          "expression": """user.studies["CMI-OSTEO"].forms["RELEASE_SELF"].hasInstance()"""
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY"
        "activityCode": "CONSENT_ASSENT",
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "CONSENT_ADDENDUM_PEDIATRIC",
          "expression": """user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM_PEDIATRIC"].hasInstance()"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "RELEASE_MINOR",
          "expression": """user.studies["CMI-OSTEO"].forms["RELEASE_MINOR"].hasInstance()"""
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY"
        "activityCode": "PARENTAL_CONSENT",
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "CONSENT_ADDENDUM_PEDIATRIC",
          "expression": """user.studies["CMI-OSTEO"].forms["CONSENT_ADDENDUM_PEDIATRIC"].hasInstance()"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "RELEASE_MINOR",
          "expression": """user.studies["CMI-OSTEO"].forms["RELEASE_MINOR"].hasInstance()"""
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY"
        "activityCode": "CONSENT_ADDENDUM_PEDIATRIC",
      },
      "to": [
         {
           "type": "ACTIVITY",
           "activityCode": "RELEASE_MINOR",
           "expression": """user.studies["CMI-OSTEO"].forms["RELEASE_MINOR"].isStatus("CREATED", "IN_PROGRESS")"""
         }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY"
        "activityCode": "CONSENT_ADDENDUM",
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "RELEASE_SELF",
          "expression": """user.studies["CMI-OSTEO"].forms["RELEASE_SELF"].isStatus("CREATED", "IN_PROGRESS")"""
        }
      ]
    }
  ]
}

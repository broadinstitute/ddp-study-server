{
  "tenant": {
    "domain": ${auth0.domain},
    "mgmtClientId": ${auth0.mgmtClientId},
    "mgmtSecret": ${auth0.mgmtSecret}
  },

  "umbrella": {
    "name": "CMI",
    "guid": "cmi"
  },

  "study": {
    "name": "Metastatic Breast Cancer Project",
    "guid": "cmi-mbc",
    "studyEmail": "info@mbcproject.org",
    "baseWebUrl": ${baseWebUrl},
    "irbPassword": ${irbPassword},
    "plusCodePrecision": "MEDIUM",
    "shareParticipantLocation": true
  },

  "clients": [
    {
      "id": ${auth0.clientId},
      "secret": ${auth0.clientSecret},
      "passwordRedirectUrl": ${passwordRedirectUrl}
    },
    {
      "id": ${auth0.adminClientId},
      "secret": ${auth0.adminClientSecret},
      "passwordRedirectUrl": null
    }
  ],

  "adminUser": {
    "guid": "CMIPEPPERADMINUSER"
  },

  "studyDetails": [],

  "supportedLanguages": [
    {
      "language": "en",
      "name" : "English",
      "isDefault" : true
    },
    {
      "language": "es",
      "name" : "Espa√±ol",
      "isDefault" : false
    }
  ],

  "settings": {
    "analyticsEnabled": true,
    "analyticsToken": ${analyticsToken}
  },

  "sendgrid": {
    "apiKey": ${sendgridApiKey},
    "fromName": ${sendgridFromName},
    "fromEmail": ${sendgridFromEmail},
    "defaultSalutation": ${sendgridDefaultSalutation}
  },

  include required("sendgrid_emails.conf"),

  "kits": [
    {
      "type": "SALIVA",
      "quantity": 1,
      "rules": [
        {
          "type": "PEX",
          "expression": """
            (user.studies["cmi-mbc"].forms["RELEASE"].hasInstance() && user.studies["cmi-mbc"].forms["RELEASE"].isStatus("COMPLETE"))
            || (user.studies["cmi-mbc"].forms["TISSUERELEASE"].hasInstance() && user.studies["cmi-mbc"].forms["TISSUERELEASE"].isStatus("COMPLETE"))
          """
        },
        {
          "type": "COUNTRY",
          "country": "us"
        },
        {
          "type": "COUNTRY",
          "country": "ca"
        },
        {
          "type": "COUNTRY",
          "country": "pr"     # Puerto Rico
        },
        {
          "type": "COUNTRY",
          "country": "gu"     # Guam
        },
        {
          "type": "COUNTRY",
          "country": "vi"     # U.S. Virgin Islands
        },
        {
          "type": "COUNTRY",
          "country": "mp"     # Northern Mariana Islands
        },
        {
          "type": "COUNTRY",
          "country": "as"     # American Samoa
        }
      ]
    }
  ],

  "activities": [
    {
      "filepath": "prequal.conf",
      "mappings": []
    },
    {
      "filepath": "about-you.conf",
      "mappings": [
        {
          "type": "DATE_OF_DIAGNOSIS",
          "stableId": "DIAGNOSIS_DATE"
        }
      ]
    },
    {
      "filepath": "consent.conf",
      "mappings": [
        {
          "type": "BLOOD",
          "stableId": "CONSENT_BLOOD"
        },
        {
          "type": "TISSUE",
          "stableId": "CONSENT_TISSUE"
        },
        {
          "type": "DATE_OF_BIRTH",
          "stableId": "CONSENT_DOB"
        }
      ]
    },
    {
      "filepath": "tissue-consent.conf",
      "mappings": [
        {
          "type": "TISSUE",
          "stableId": "TISSUECONSENT"
        },
        {
          "type": "DATE_OF_BIRTH",
          "stableId": "TISSUECONSENT_DOB"
        }
      ],
    },
    {
      "filepath": "blood-consent.conf",
      "mappings": [
        {
          "type": "BLOOD",
          "stableId": "BLOODCONSENT"
        },
        {
          "type": "DATE_OF_BIRTH",
          "stableId": "BLOODCONSENT_DOB"
        }
      ],
    },
    {
      "filepath": "release.conf",
      "mappings": [
        {
          "type": "MEDICAL_RELEASE",
          "stableId": null
        }
      ]
    },
    {
      "filepath": "tissue-release.conf",
      "mappings": []
    },
    {
      "filepath": "blood-release.conf",
      "mappings": []
    },
    {
      "filepath": "followup.conf",
      "mappings": []
    }
  ],

  "activityTimestamp": "2015-07-01T00:00:00Z",

  "activityStatusIcons": [
    {
      "filepath": "icons/created.svg",
      "statusType": "CREATED"
    },
    {
      "filepath": "icons/in_progress.svg",
      "statusType": "IN_PROGRESS"
    },
    {
      "filepath": "icons/complete.svg",
      "statusType": "COMPLETE"
    }
  ],

  "pdfs": [
    {
      "name": "mbcproject-consent",
      "filename": "mbcproject-consent",
      "displayName": "MBC consent pdf"
      "mapping": {
        "type": "CONSENT"
      },
      "versions": [
        {
          "tag": "v1",
          "start": "2015-07-01T00:00:00Z",
          "end": null,
          "sources": [
            {
              "type": "ACTIVITY",
              "activityCode": "CONSENT",
              "versionTag": "v1"
            }
          ],
          "files": [
            {
              "filepath": "pdfs/consent.pdf",
              "type": "CUSTOM",
              "substitutions": [
                {
                  "type": "BOOLEAN",
                  "field": "blood_draw_yes",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_BLOOD",
                  "checkIfFalse": false
                },
                {
                  "type": "BOOLEAN",
                  "field": "blood_draw_no",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_BLOOD",
                  "checkIfFalse": true
                },
                {
                  "type": "BOOLEAN",
                  "field": "tissue_sample_yes",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_TISSUE",
                  "checkIfFalse": false
                },
                {
                  "type": "BOOLEAN",
                  "field": "tissue_sample_no",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_TISSUE",
                  "checkIfFalse": true
                },
                {
                  "type": "TEXT",
                  "field": "signature",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_FULLNAME"
                },
                {
                  "type": "DATE",
                  "field": "date_of_birth",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_DOB"
                },
                {
                  "type": "ACTIVITY_DATE",
                  "field": "date",
                  "activityCode": "CONSENT"
                }
              ]
            },

            {
              "filepath": "pdfs/consent_es.pdf",
              "type": "CUSTOM",
              "language": "es",
              "substitutions": [
                {
                  "type": "BOOLEAN",
                  "field": "blood_draw_yes",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_BLOOD",
                  "checkIfFalse": false
                },
                {
                  "type": "BOOLEAN",
                  "field": "blood_draw_no",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_BLOOD",
                  "checkIfFalse": true
                },
                {
                  "type": "BOOLEAN",
                  "field": "tissue_sample_yes",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_TISSUE",
                  "checkIfFalse": false
                },
                {
                  "type": "BOOLEAN",
                  "field": "tissue_sample_no",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_TISSUE",
                  "checkIfFalse": true
                },
                {
                  "type": "TEXT",
                  "field": "signature",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_FULLNAME"
                },
                {
                  "type": "DATE",
                  "field": "date_of_birth",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_DOB"
                },
                {
                  "type": "ACTIVITY_DATE",
                  "field": "date",
                  "activityCode": "CONSENT"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "mbcproject-tissueconsent",
      "filename": "mbcproject-tissueconsent",
      "displayName": "MBC tissue consent pdf"
      "versions": [
        {
          "tag": "v1",
          "start": "2015-07-01T00:00:00Z",
          "end": "2019-05-15T17:00:00Z",
          "sources": [
            {
              "type": "EMAIL"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "TISSUECONSENT",
              "versionTag": "v1"
            }
          ],
          "files": [
            {
              "filepath": "pdfs/tissueconsent_v1.pdf",
              "type": "CUSTOM",
              "substitutions": [
                {
                  "type": "PROFILE",
                  "field": "email",
                  "profileField": "email"
                },
                {
                  "type": "TEXT",
                  "field": "signature",
                  "activityCode": "TISSUECONSENT",
                  "questionStableId": "TISSUECONSENT_FULLNAME"
                },
                {
                  "type": "DATE",
                  "field": "date_of_birth",
                  "activityCode": "TISSUECONSENT",
                  "questionStableId": "TISSUECONSENT_DOB"
                },
                {
                  "type": "ACTIVITY_DATE",
                  "field": "date",
                  "activityCode": "TISSUECONSENT"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "mbcproject-bloodconsent",
      "filename": "mbcproject-bloodconsent",
      "displayName": "MBC blood consent pdf"
      "versions": [
        {
          "tag": "v1",
          "start": "2015-07-01T00:00:00Z",
          "end": "2019-05-15T17:00:00Z",
          "sources": [
            {
              "type": "PARTICIPANT"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "BLOODCONSENT",
              "versionTag": "v1"
            }
          ],
          "files": [
            {
              "filepath": "pdfs/bloodconsent_v1.pdf",
              "type": "CUSTOM",
              "substitutions": [
                {
                  "type": "PROFILE",
                  "field": "first_name",
                  "profileField": "first_name"
                },
                {
                  "type": "PROFILE",
                  "field": "last_name",
                  "profileField": "last_name"
                },
                {
                  "type": "TEXT",
                  "field": "address",
                  "activityCode": "BLOODCONSENT",
                  "questionStableId": "BLOODCONSENT_ADDRESS"
                },
                {
                  "type": "TEXT",
                  "field": "phone",
                  "activityCode": "BLOODCONSENT",
                  "questionStableId": "BLOODCONSENT_PHONE"
                },
                {
                  "type": "TEXT",
                  "field": "treatment_now",
                  "activityCode": "BLOODCONSENT",
                  "questionStableId": "BLOODCONSENT_TREATMENT_NOW"
                },
                {
                  "type": "DATE",
                  "field": "treatment_start",
                  "activityCode": "BLOODCONSENT",
                  "questionStableId": "BLOODCONSENT_TREATMENT_START"
                },
                {
                  "type": "TEXT",
                  "field": "treatment_past",
                  "activityCode": "BLOODCONSENT",
                  "questionStableId": "BLOODCONSENT_TREATMENT_PAST"
                },
                {
                  "type": "TEXT",
                  "field": "signature",
                  "activityCode": "BLOODCONSENT",
                  "questionStableId": "BLOODCONSENT_FULLNAME"
                },
                {
                  "type": "DATE",
                  "field": "date_of_birth",
                  "activityCode": "BLOODCONSENT",
                  "questionStableId": "BLOODCONSENT_DOB"
                },
                {
                  "type": "ACTIVITY_DATE",
                  "field": "date",
                  "activityCode": "BLOODCONSENT"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "mbcproject-release",
      "filename": "mbcproject-release",
      "displayName": "MBC release pdf"
      "mapping": {
        "type": "RELEASE"
      },
      "versions": [
        {
          "tag": "v1",
          "start": "2015-07-01T00:00:00Z",
          "end": null,
          "sources": [
            {
              "type": "PARTICIPANT"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "RELEASE",
              "versionTag": "v1"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "CONSENT",
              "versionTag": "v1"
            }
          ],
          "files": [
            {
              "filepath": "pdfs/release_contact.pdf",
              "type": "MAILING_ADDRESS",
              "fields": {
                "firstName": "first_name",
                "lastName": "last_name",
                "street": "street",
                "city": "city",
                "state": "state",
                "zip": "zip",
                "country": "country",
                "phone": "phone"
              }
            },
            {
              "filepath": "pdfs/release_physician.pdf",
              "type": "PHYSICIAN",
              "fields": {
                "name": "physician_name",
                "institution": "physician_institution",
                "city": "physician_city",
                "state": "physician_state"
              }
            },
            {
              "filepath": "pdfs/release_biopsy.pdf",
              "type": "INITIAL_BIOPSY",
              "fields": {
                "institution": "biopsy_institution",
                "city": "biopsy_city",
                "state": "biopsy_state"
              }
            },
            {
              "filepath": "pdfs/release_institution.pdf",
              "type": "INSTITUTION",
              "fields": {
                "institution": "institution_name",
                "city": "institution_city",
                "state": "institution_state"
              }
            },
            {
              "filepath": "pdfs/release_agreement.pdf",
              "type": "CUSTOM",
              "substitutions": [
                {
                  "type": "TEXT",
                  "field": "signature",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_FULLNAME"
                },
                {
                  "type": "DATE",
                  "field": "date_of_birth",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_DOB"
                },
                {
                  "type": "ACTIVITY_DATE",
                  "field": "date",
                  "activityCode": "RELEASE"
                }
              ]
            },
            {
              "filepath": "pdfs/release_contact_es.pdf",
              "type": "MAILING_ADDRESS",
              "language": "es",
              "fields": {
                "firstName": "first_name",
                "lastName": "last_name",
                "street": "street",
                "city": "city",
                "state": "state",
                "zip": "zip",
                "country": "country",
                "phone": "phone"
              }
            },
            {
              "filepath": "pdfs/release_physician_es.pdf",
              "type": "PHYSICIAN",
              "language": "es",
              "fields": {
                "name": "physician_name",
                "institution": "physician_institution",
                "city": "physician_city",
                "state": "physician_state"
              }
            },
            {
              "filepath": "pdfs/release_biopsy_es.pdf",
              "type": "INITIAL_BIOPSY",
              "language": "es",
              "fields": {
                "institution": "biopsy_institution",
                "city": "biopsy_city",
                "state": "biopsy_state"
              }
            },
            {
              "filepath": "pdfs/release_institution_es.pdf",
              "type": "INSTITUTION",
              "language": "es",
              "fields": {
                "institution": "institution_name",
                "city": "institution_city",
                "state": "institution_state"
              }
            },
            {
              "filepath": "pdfs/release_agreement_es.pdf",
              "type": "CUSTOM",
              "language": "es",
              "substitutions": [
                {
                  "type": "TEXT",
                  "field": "signature",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_FULLNAME"
                },
                {
                  "type": "DATE",
                  "field": "date_of_birth",
                  "activityCode": "CONSENT",
                  "questionStableId": "CONSENT_DOB"
                },
                {
                  "type": "ACTIVITY_DATE",
                  "field": "date",
                  "activityCode": "RELEASE"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "mbcproject-tissuerelease",
      "filename": "mbcproject-tissuerelease",
      "displayName": "MBC tissue release pdf"
      "versions": [
        {
          "tag": "v1",
          "start": "2015-07-01T00:00:00Z",
          "end": null,
          "sources": [
            {
              "type": "PARTICIPANT"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "TISSUERELEASE",
              "versionTag": "v1"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "TISSUECONSENT",
              "versionTag": "v1"
            }
          ],
          "files": [
            {
              "filepath": "pdfs/tissuerelease_contact.pdf",
              "type": "MAILING_ADDRESS",
              "fields": {
                "firstName": "first_name",
                "lastName": "last_name",
                "street": "street",
                "city": "city",
                "state": "state",
                "zip": "zip",
                "country": null,
                "phone": "phone"
              }
            },
            {
              "filepath": "pdfs/tissuerelease_physician.pdf",
              "type": "PHYSICIAN",
              "fields": {
                "name": "physician_name",
                "institution": "physician_institution",
                "street": "physician_street",
                "city": "physician_city",
                "state": "physician_state",
                "zip": "physician_zip",
                "phone": "physician_phone"
              }
            },
            {
              "filepath": "pdfs/tissuerelease_biopsy.pdf",
              "type": "INITIAL_BIOPSY",
              "fields": {
                "institution": "biopsy_institution",
                "city": "biopsy_city",
                "state": "biopsy_state"
              }
            },
            {
              "filepath": "pdfs/tissuerelease_institution.pdf",
              "type": "INSTITUTION",
              "fields": {
                "institution": "institution_name",
                "city": "institution_city",
                "state": "institution_state"
              }
            },
            {
              "filepath": "pdfs/tissuerelease_agreement.pdf",
              "type": "CUSTOM",
              "substitutions": [
                {
                  "type": "TEXT",
                  "field": "signature",
                  "activityCode": "TISSUECONSENT",
                  "questionStableId": "TISSUECONSENT_FULLNAME"
                },
                {
                  "type": "DATE",
                  "field": "date_of_birth",
                  "activityCode": "TISSUECONSENT",
                  "questionStableId": "TISSUECONSENT_DOB"
                },
                {
                  "type": "ACTIVITY_DATE",
                  "field": "date",
                  "activityCode": "TISSUERELEASE"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "mbcproject-bloodrelease",
      "filename": "mbcproject-bloodrelease",
      "displayName": "MBC blood release pdf"
      "versions": [
        {
          "tag": "v1",
          "start": "2015-07-01T00:00:00Z",
          "end": null,
          "sources": [
            {
              "type": "PARTICIPANT"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "BLOODRELEASE",
              "versionTag": "v1"
            },
            {
              "type": "ACTIVITY",
              "activityCode": "BLOODCONSENT",
              "versionTag": "v1"
            }
          ],
          "files": [
            {
              "filepath": "pdfs/bloodrelease_contact.pdf",
              "type": "CUSTOM",
              "substitutions": [
                {
                  "type": "TEXT",
                  "field": "fullname",
                  "activityCode": "BLOODRELEASE",
                  "questionStableId": "BLOODRELEASE_FULLNAME"
                }
              ]
            },
            {
              "filepath": "pdfs/bloodrelease_physician.pdf",
              "type": "PHYSICIAN",
              "fields": {
                "name": "physician_name",
                "institution": "physician_institution",
                "street": "physician_street",
                "city": "physician_city",
                "state": "physician_state",
                "zip": "physician_zip",
                "phone": "physician_phone"
              }
            },
            {
              "filepath": "pdfs/bloodrelease_agreement.pdf",
              "type": "CUSTOM",
              "substitutions": [
                {
                  "type": "TEXT",
                  "field": "signature",
                  "activityCode": "BLOODCONSENT",
                  "questionStableId": "BLOODCONSENT_FULLNAME"
                },
                {
                  "type": "ACTIVITY_DATE",
                  "field": "date",
                  "activityCode": "BLOODRELEASE"
                }
              ]
            }
          ]
        }
      ]
    }
  ],

  "workflowTransitions": [
    # main study workflow
    {
      "from": {
        "type": "START"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "PREQUAL",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "PREQUAL"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "ABOUTYOU",
          "expression": """
            user.studies["cmi-mbc"].forms["PREQUAL"].isStatus("COMPLETE")
            && user.studies["cmi-mbc"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("DIAGNOSED")
          """,
        },
        {
          "type": "MAILING_LIST",
          "expression": """
            user.studies["cmi-mbc"].forms["PREQUAL"].isStatus("COMPLETE")
            && user.studies["cmi-mbc"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("MAILING_LIST")
          """,
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "ABOUTYOU"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "CONSENT",
          "expression": """user.studies["cmi-mbc"].forms["ABOUTYOU"].isStatus("COMPLETE")
            && user.studies["cmi-mbc"].forms["ABOUTYOU"].questions["COUNTRY"].answers.hasAnyOption("US", "CA", "PR", "GU", "VI", "MP", "AS")
            && !user.studies["cmi-mbc"].forms["TISSUECONSENT"].hasInstance()
            && !user.studies["cmi-mbc"].forms["BLOODCONSENT"].hasInstance()
            """,
        },
        {
          "type": "INTERNATIONAL_PATIENTS",
          "expression": """user.studies["cmi-mbc"].forms["ABOUTYOU"].isStatus("COMPLETE")
            && !user.studies["cmi-mbc"].forms["ABOUTYOU"].questions["COUNTRY"].answers.hasAnyOption("US", "CA", "PR", "GU", "VI", "MP", "AS")""",
        },
        {
          "type": "ACTIVITY",
          "activityCode": "TISSUECONSENT",
          "expression": """user.studies["cmi-mbc"].forms["TISSUECONSENT"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "BLOODCONSENT",
          "expression": """user.studies["cmi-mbc"].forms["BLOODCONSENT"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "RELEASE",
          "expression": """user.studies["cmi-mbc"].forms["RELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "TISSUERELEASE",
          "expression": """user.studies["cmi-mbc"].forms["TISSUERELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "BLOODRELEASE",
          "expression": """user.studies["cmi-mbc"].forms["BLOODRELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "FOLLOWUP",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "DASHBOARD",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("COMPLETE")"""
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "CONSENT"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "RELEASE",
          "expression": """user.studies["cmi-mbc"].forms["RELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "FOLLOWUP",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "DASHBOARD",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("COMPLETE")"""
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "RELEASE"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "FOLLOWUP",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "DASHBOARD",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("COMPLETE")"""
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "FOLLOWUP"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "RELEASE",
          "expression": """user.studies["cmi-mbc"].forms["RELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "TISSUERELEASE",
          "expression": """user.studies["cmi-mbc"].forms["TISSUERELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "BLOODRELEASE",
          "expression": """user.studies["cmi-mbc"].forms["BLOODRELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "DASHBOARD",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("COMPLETE")""",
        }
      ]
    },

    # tissue and blood consent flows
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "TISSUECONSENT"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "TISSUERELEASE",
          "expression": """user.studies["cmi-mbc"].forms["TISSUERELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "BLOODCONSENT",
          "expression": """user.studies["cmi-mbc"].forms["BLOODCONSENT"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "BLOODRELEASE",
          "expression": """user.studies["cmi-mbc"].forms["BLOODRELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "FOLLOWUP",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "DASHBOARD",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("COMPLETE")"""
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "TISSUERELEASE"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "BLOODCONSENT",
          "expression": """user.studies["cmi-mbc"].forms["BLOODCONSENT"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "BLOODRELEASE",
          "expression": """user.studies["cmi-mbc"].forms["BLOODRELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "FOLLOWUP",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "DASHBOARD",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("COMPLETE")"""
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "BLOODCONSENT"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "BLOODRELEASE",
          "expression": """user.studies["cmi-mbc"].forms["BLOODRELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "TISSUECONSENT",
          "expression": """user.studies["cmi-mbc"].forms["TISSUECONSENT"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "TISSUERELEASE",
          "expression": """user.studies["cmi-mbc"].forms["TISSUERELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "FOLLOWUP",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "DASHBOARD",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("COMPLETE")"""
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "BLOODRELEASE"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "TISSUECONSENT",
          "expression": """user.studies["cmi-mbc"].forms["TISSUECONSENT"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "TISSUERELEASE",
          "expression": """user.studies["cmi-mbc"].forms["TISSUERELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "FOLLOWUP",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "DASHBOARD",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("COMPLETE")"""
        }
      ]
    },

    # return user workflow
    {
      "from": {
        "type": "RETURN_USER"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "ABOUTYOU",
          "expression": """user.studies["cmi-mbc"].forms["ABOUTYOU"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "CONSENT",
          "expression": """user.studies["cmi-mbc"].forms["CONSENT"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "TISSUECONSENT",
          "expression": """user.studies["cmi-mbc"].forms["TISSUECONSENT"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "BLOODCONSENT",
          "expression": """user.studies["cmi-mbc"].forms["BLOODCONSENT"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "TISSUERELEASE",
          "expression": """user.studies["cmi-mbc"].forms["TISSUERELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "BLOODRELEASE",
          "expression": """user.studies["cmi-mbc"].forms["BLOODRELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "RELEASE",
          "expression": """user.studies["cmi-mbc"].forms["RELEASE"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": "FOLLOWUP",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("CREATED", "IN_PROGRESS")"""
        },
        {
          "type": "DASHBOARD",
          "expression": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("COMPLETE")"""
        }
      ]
    }
  ],
  THANK_YOU-ANNOUNCEMENT_MSG={include required("snippets/thank-you-announcement-msg.conf")}
  "events": [
    # join mailing list event
    {
      "trigger": {
        "type": "JOIN_MAILING_LIST"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.joinMailingList},
            "language": "en"
          },
          {
            "emailTemplate": ${emails.joinMailingListES},
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },

    # populate profile events
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PREQUAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "COPY_ANSWER",
        "copyConfigPairs": [
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "PREQUAL_FIRST_NAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_FIRST_NAME"
            }
          },
          {
            "source": {
              "type": "ANSWER",
              "questionStableId": "PREQUAL_LAST_NAME"
            },
            "target": {
              "type": "PARTICIPANT_PROFILE_LAST_NAME"
            }
          }
        ]
      },
      "dispatchToHousekeeping": false,
      "order": 1
    },

    # activity instance creation events
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PREQUAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUTYOU"
      },
      "cancelExpr": """
        !user.studies["cmi-mbc"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("DIAGNOSED")
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ABOUTYOU",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT"
      },
      "cancelExpr": """
        !user.studies["cmi-mbc"].forms["ABOUTYOU"].questions["COUNTRY"].answers.hasAnyOption("US", "CA", "PR", "GU", "VI", "MP", "AS")
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "RELEASE"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "FOLLOWUP"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "TISSUECONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "TISSUERELEASE"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "TISSUECONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "FOLLOWUP"
      },
      "cancelExpr": """user.studies["cmi-mbc"].forms["FOLLOWUP"].hasInstance()""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "TISSUERELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "BLOODCONSENT"
      },
      "cancelExpr": """
        user.studies["cmi-mbc"].forms["BLOODCONSENT"].hasInstance()
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "TISSUERELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "FOLLOWUP"
      },
      "cancelExpr": """user.studies["cmi-mbc"].forms["FOLLOWUP"].hasInstance()""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "BLOODCONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "BLOODRELEASE"
      },
      "cancelExpr": """user.studies["cmi-mbc"].forms["TISSUERELEASE"].hasInstance()""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "BLOODCONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "FOLLOWUP"
      },
      "cancelExpr": """user.studies["cmi-mbc"].forms["FOLLOWUP"].hasInstance()""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "FOLLOWUP"
      },
      "cancelExpr": """user.studies["cmi-mbc"].forms["FOLLOWUP"].hasInstance()""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "BLOODRELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "TISSUECONSENT"
      },
      "cancelExpr": """
        user.studies["cmi-mbc"].forms["TISSUECONSENT"].hasInstance() || !user.studies["cmi-mbc"].forms["BLOODCONSENT"].hasInstance()
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "BLOODRELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "FOLLOWUP"
      },
      "cancelExpr": """user.studies["cmi-mbc"].forms["FOLLOWUP"].hasInstance()""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },

    # registration event
    {
      "trigger": {
        "type": "USER_REGISTERED",
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.welcome},
            "linkedActivityCode": "ABOUTYOU",
            "language": "en"
          },
          {
            "emailTemplate": ${emails.welcomeES},
            "linkedActivityCode": "ABOUTYOU",
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """
        !user.studies["cmi-mbc"].forms["PREQUAL"].hasInstance()
        || !user.studies["cmi-mbc"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("DIAGNOSED")
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },

    # activity status email events
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.aboutyouCompleted},
            "linkedActivityCode": "CONSENT",
            "language": "en"
          },
          {
            "emailTemplate": ${emails.aboutyouCompletedES},
            "linkedActivityCode": "CONSENT",
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentCompleted},
            "linkedActivityCode": "RELEASE",
            "language": "en"
          },
          {
            "emailTemplate": ${emails.consentCompletedES},
            "linkedActivityCode": "RELEASE",
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": [
          {"pdfName": "mbcproject-consent", "generateIfMissing": true}
        ]
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.releaseCompleted},
            "language": "en"
          },
          {
            "emailTemplate": ${emails.releaseCompletedES},
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "TISSUECONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.tissueconsentCompleted},
        "linkedActivityCode": "TISSUERELEASE",
        "language": "en",
        "pdfAttachments": [
          { "pdfName": "mbcproject-tissueconsent", "generateIfMissing": true }
        ]
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "TISSUERELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.releaseCompleted},
        "language": "en",
        "pdfAttachments": []
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "BLOODCONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.bloodconsentCompleted},
        "language": "en",
        "pdfAttachments": [
          { "pdfName": "mbcproject-bloodconsent", "generateIfMissing": true }
        ]
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "BLOODRELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "emailTemplate": ${emails.bloodreleaseCompleted},
        "language": "en",
        "pdfAttachments": []
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "FOLLOWUP",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.followupCreated},
            "linkedActivityCode": "FOLLOWUP",
            "language": "en"
          },
          {
            "emailTemplate": ${emails.followupCreatedES},
            "linkedActivityCode": "FOLLOWUP",
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "FOLLOWUP",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.followupCompleted},
            "language": "en"
          },
          {
            "emailTemplate": ${emails.followupCompletedES},
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": true,
      "order": 1
    },

    # pdf generation event for release pdfs
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "PDF_GENERATION",
        "pdfName": "mbcproject-release"
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "TISSUERELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "PDF_GENERATION",
        "pdfName": "mbcproject-tissuerelease"
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "BLOODRELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "PDF_GENERATION",
        "pdfName": "mbcproject-bloodrelease"
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },

    # medical update event for release pdfs
    {
      "trigger": {
        "type": "MEDICAL_UPDATE"
      },
      "action": {
        "type": "PDF_GENERATION",
        "pdfName": "mbcproject-release"
      },
      "cancelExpr": """!(user.studies["cmi-mbc"].forms["RELEASE"].hasInstance()
            && user.studies["cmi-mbc"].forms["RELEASE"].isStatus("COMPLETE"))"""
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "MEDICAL_UPDATE"
      },
      "action": {
        "type": "PDF_GENERATION",
        "pdfName": "mbcproject-tissuerelease"
      },
      "cancelExpr": """!(user.studies["cmi-mbc"].forms["TISSUERELEASE"].hasInstance()
            && user.studies["cmi-mbc"].forms["TISSUERELEASE"].isStatus("COMPLETE"))"""
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "MEDICAL_UPDATE"
      },
      "action": {
        "type": "PDF_GENERATION",
        "pdfName": "mbcproject-bloodrelease"
      },
      "cancelExpr": """!(user.studies["cmi-mbc"].forms["BLOODRELEASE"].hasInstance()
            && user.studies["cmi-mbc"].forms["BLOODRELEASE"].isStatus("COMPLETE"))"""
      "dispatchToHousekeeping": true,
      "order": 1
    },

    # reminder email events
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentFirstReminder},
            "linkedActivityCode": "CONSENT",
            "language": "en"
          },
          {
            "emailTemplate": ${emails.consentFirstReminderES},
            "linkedActivityCode": "CONSENT",
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """
        user.studies["cmi-mbc"].forms["CONSENT"].isStatus("COMPLETE")
        || !user.studies["cmi-mbc"].forms["ABOUTYOU"].questions["COUNTRY"].answers.hasAnyOption("US", "CA", "PR", "GU", "VI", "MP", "AS")
      """,
      "delaySeconds": 604800, # one week in seconds
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentSecondReminder},
            "linkedActivityCode": "CONSENT",
            "language": "en"
          },
          {
            "emailTemplate": ${emails.consentSecondReminderES},
            "linkedActivityCode": "CONSENT",
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """
        user.studies["cmi-mbc"].forms["CONSENT"].isStatus("COMPLETE")
        || !user.studies["cmi-mbc"].forms["ABOUTYOU"].questions["COUNTRY"].answers.hasAnyOption("US", "CA", "PR", "GU", "VI", "MP", "AS")
      """,
      "delaySeconds": 1209600, # two weeks in seconds
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.consentThirdReminder},
            "linkedActivityCode": "CONSENT",
            "language": "en"
          },
          {
            "emailTemplate": ${emails.consentThirdReminderES},
            "linkedActivityCode": "CONSENT",
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """
        user.studies["cmi-mbc"].forms["CONSENT"].isStatus("COMPLETE")
        || !user.studies["cmi-mbc"].forms["ABOUTYOU"].questions["COUNTRY"].answers.hasAnyOption("US", "CA", "PR", "GU", "VI", "MP", "AS")
      """,
      "delaySeconds": 1814400, # three weeks in seconds
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.releaseReminder},
            "linkedActivityCode": "RELEASE",
            "language": "en"
          },
          {
            "emailTemplate": ${emails.releaseReminderES},
            "linkedActivityCode": "RELEASE",
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-mbc"].forms["RELEASE"].isStatus("COMPLETE")""",
      "delaySeconds": 604800, # one week in seconds
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.releaseReminder},
            "linkedActivityCode": "RELEASE",
            "language": "en"
          },
          {
            "emailTemplate": ${emails.releaseReminderES},
            "linkedActivityCode": "RELEASE",
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-mbc"].forms["RELEASE"].isStatus("COMPLETE")""",
      "delaySeconds": 1209600, # two weeks in seconds
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "RELEASE",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.releaseReminder},
            "linkedActivityCode": "RELEASE",
            "language": "en"
          },
          {
            "emailTemplate": ${emails.releaseReminderES},
            "linkedActivityCode": "RELEASE",
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-mbc"].forms["RELEASE"].isStatus("COMPLETE")""",
      "delaySeconds": 1814400, # three weeks in seconds
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "FOLLOWUP",
        "statusType": "CREATED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.followupReminder},
            "linkedActivityCode": "FOLLOWUP",
            "language": "en"
          },
          {
            "emailTemplate": ${emails.followupReminderES},
            "linkedActivityCode": "FOLLOWUP",
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": """user.studies["cmi-mbc"].forms["FOLLOWUP"].isStatus("COMPLETE")""",
      "delaySeconds": 1209600, # two weeks in seconds
      "dispatchToHousekeeping": true,
      "order": 1
    },

    # enrollment event
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "USER_ENROLLED"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "TISSUERELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "USER_ENROLLED"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "BLOODRELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "USER_ENROLLED"
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },

    # announcement event
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "RELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ANNOUNCEMENT",
        "msgTemplate": ${_includes.THANK_YOU-ANNOUNCEMENT_MSG}
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "TISSUERELEASE",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ANNOUNCEMENT",
        "msgTemplate": ${_includes.THANK_YOU-ANNOUNCEMENT_MSG}
      },
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },

    # dsm notification email events
    {
      "trigger": {
        "type": "DSM_NOTIFICATION",
        "dsmEvent": "SALIVA_RECEIVED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.salivaReceived},
            "language": "en"
          },
          {
            "emailTemplate": ${emails.salivaReceivedES},
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "DSM_NOTIFICATION",
        "dsmEvent": "BLOOD_RECEIVED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.bloodReceived},
            "language": "en"
          },
          {
            "emailTemplate": ${emails.bloodReceivedES},
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "DSM_NOTIFICATION",
        "dsmEvent": "BLOOD_SENT"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.bloodSent},
            "language": "en"
          },
          {
            "emailTemplate": ${emails.bloodSentES},
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "DSM_NOTIFICATION",
        "dsmEvent": "BLOOD_SENT_4WK"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.bloodSentReminder},
            "language": "en"
          },
          {
            "emailTemplate": ${emails.bloodSentReminderES},
            "language": "es",
            "isDynamic": true
          }
        ],
        "pdfAttachments": []
      },
      "dispatchToHousekeeping": true,
      "order": 1
    },

    # exit request event
    {
      "trigger": {
        "type": "EXIT_REQUEST"
      },
      "action": {
        "type": "STUDY_EMAIL",
        "emailTemplate": ${emails.exitRequest},
        "language": "en",
        "pdfAttachments": []
      },
      "preconditionExpr": null,
      "cancelExpr": null,
      "maxOccurrencesPerUser": null,
      "delaySeconds": null,
      "dispatchToHousekeeping": true,
      "order": 1
    }
  ]
}

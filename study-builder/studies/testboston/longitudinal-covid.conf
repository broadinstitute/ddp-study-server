{
  include required("../snippets/activity-general-form.conf"),
  "studyGuid": ${id.study},
  "activityCode": ${id.act.longitudinal},
  "versionTag": "v1",
  "displayOrder": 2,
  "writeOnce": false,
  "editTimeoutSec": 604800,   # 7 days
  "maxInstancesPerUser": 5,
  "translatedNames": [
    { "language": "en", "text": ${i18n.en.longitudinal.name} },
    { "language": "es", "text": ${i18n.es.longitudinal.name} },
    { "language": "ht", "text": ${i18n.ht.longitudinal.name} }
  ],
  "translatedTitles": [
    { "language": "en", "text": ${i18n.en.longitudinal.title} },
    { "language": "es", "text": ${i18n.es.longitudinal.title} },
    { "language": "ht", "text": ${i18n.ht.longitudinal.title} }
  ],
  "sections": [
    {
      "nameTemplate": null,
      "icons": [],
      "blocks": [
        {
          # NOTE: Using HOCON object concatenation here to override just a few things on the included object,
          # so we can leverage re-use since it's mostly the same questions.
          "control": ${_includes.baseline_covid.covid_been_tested} {
            "stableId": ${id.q.longitudinal_covid_been_tested},
            "promptTemplate": {
              "templateType": "HTML",
              "templateText": "$longitudinal_covid_been_tested_prompt"
              "variables": [
                {
                  "name": "longitudinal_covid_been_tested_prompt",
                  "translations": [
                    { "language": "en", "text": ${i18n.en.longitudinal_covid_been_tested_prompt} },
                    { "language": "es", "text": ${i18n.es.longitudinal_covid_been_tested_prompt} },
                    { "language": "ht", "text": ${i18n.ht.longitudinal_covid_been_tested_prompt} }
                  ]
                }
              ]
            }
          },
          "nested": [
            {
              "question": ${_includes.baseline_covid.covid_test_kind} {
                "stableId": ${id.q.longitudinal_covid_test_kind}
              },
              "blockType": "QUESTION",
              "shownExpr": """user.studies["testboston"].forms["LONGITUDINAL_COVID"].instances[specific].questions["LONGITUDINAL_COVID_BEEN_TESTED"].answers.hasOption("YES")"""
            },
            {
              "question": ${_includes.baseline_covid.covid_test_date} {
                "stableId": ${id.q.longitudinal_covid_test_date}
              },
              "blockType": "QUESTION",
              "shownExpr": """
                user.studies["testboston"].forms["LONGITUDINAL_COVID"].instances[specific].questions["LONGITUDINAL_COVID_BEEN_TESTED"].answers.hasOption("YES")
                && user.studies["testboston"].forms["LONGITUDINAL_COVID"].instances[specific].questions["LONGITUDINAL_COVID_TEST_KIND"].answers.hasOption("NOT_SURE")
              """
            },
            {
              "question": ${_includes.baseline_covid.covid_test_result} {
                "stableId": ${id.q.longitudinal_covid_test_result}
              },
              "blockType": "QUESTION",
              "shownExpr": """
                user.studies["testboston"].forms["LONGITUDINAL_COVID"].instances[specific].questions["LONGITUDINAL_COVID_BEEN_TESTED"].answers.hasOption("YES")
                && user.studies["testboston"].forms["LONGITUDINAL_COVID"].instances[specific].questions["LONGITUDINAL_COVID_TEST_KIND"].answers.hasOption("NOT_SURE")
              """
            },
            {
              "question": ${_includes.baseline_covid.viral_test_list} {
                "stableId": ${id.q.longitudinal_viral_test_list},
                "children": [
                  ${_includes.baseline_covid.viral_test_result} {
                    "stableId": ${id.q.longitudinal_viral_test_result}
                  },
                  ${_includes.baseline_covid.viral_test_date} {
                    "stableId": ${id.q.longitudinal_viral_test_date}
                  }
                ]
              },
              "blockType": "QUESTION",
              "shownExpr": """
                user.studies["testboston"].forms["LONGITUDINAL_COVID"].instances[specific].questions["LONGITUDINAL_COVID_BEEN_TESTED"].answers.hasOption("YES")
                && user.studies["testboston"].forms["LONGITUDINAL_COVID"].instances[specific].questions["LONGITUDINAL_COVID_TEST_KIND"].answers.hasOption("VIRAL_TEST")
              """
            },
            {
              "question": ${_includes.baseline_covid.blood_test_list} {
                "stableId": ${id.q.longitudinal_blood_test_list},
                "children": [
                  ${_includes.baseline_covid.blood_test_result} {
                    "stableId": ${id.q.longitudinal_blood_test_result}
                  },
                  ${_includes.baseline_covid.blood_test_date} {
                    "stableId": ${id.q.longitudinal_blood_test_date}
                  }
                ]
              },
              "blockType": "QUESTION",
              "shownExpr": """
                user.studies["testboston"].forms["LONGITUDINAL_COVID"].instances[specific].questions["LONGITUDINAL_COVID_BEEN_TESTED"].answers.hasOption("YES")
                && user.studies["testboston"].forms["LONGITUDINAL_COVID"].instances[specific].questions["LONGITUDINAL_COVID_TEST_KIND"].answers.hasOption("BLOOD_TEST")
              """
            }
          ],
          "blockType": "CONDITIONAL",
          "shownExpr": null
        },
        {
          "question": ${_includes.baseline_covid.current_symptoms} {
            "stableId": ${id.q.longitudinal_current_symptoms}
          },
          "blockType": "QUESTION",
          "shownExpr": null
        },
        {
          "question": ${_includes.baseline_covid.past_symptoms} {
            "stableId": ${id.q.longitudinal_past_symptoms}
          },
          "blockType": "QUESTION",
          "shownExpr": null
        },
        {
          "question": ${_includes.baseline_covid.household_diagnosed} {
            "stableId": ${id.q.longitudinal_household_diagnosed},
            "promptTemplate": {
              "templateType": "HTML",
              "templateText": "$longitudinal_household_diagnosed_prompt"
              "variables": [
                {
                  "name": "longitudinal_household_diagnosed_prompt",
                  "translations": [
                    { "language": "en", "text": ${i18n.en.longitudinal_household_diagnosed_prompt} },
                    { "language": "es", "text": ${i18n.es.longitudinal_household_diagnosed_prompt} },
                    { "language": "ht", "text": ${i18n.ht.longitudinal_household_diagnosed_prompt} }
                  ]
                }
              ]
            }
          },
          "blockType": "QUESTION",
          "shownExpr": null
        },
        {
          "question": ${_includes.baseline_covid.contact_diagnosed} {
            "stableId": ${id.q.longitudinal_contact_diagnosed}
          },
          "blockType": "QUESTION",
          "shownExpr": null
        },
        {
          "question": ${_includes.longitudinal.flu_shot},
          "blockType": "QUESTION",
          "shownExpr": null
        },
        {
          "question": ${_includes.baseline_symptom.sample_collect_date} {
            "stableId": ${id.q.longitudinal_sample_collect_date}
          }
          "blockType": "QUESTION",
          "shownExpr": null
        },
        {
          "question": ${_includes.longitudinal.sample_collect_time}
          "blockType": "QUESTION",
          "shownExpr": null
        }
      ]
    }
  ]
}

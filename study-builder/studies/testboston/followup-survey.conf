{
  include required("../snippets/activity-general-form.conf"),
  "studyGuid": ${id.study},
  "activityCode": ${id.act.followup},
  "versionTag": "v1",
  "displayOrder": 5,
  "writeOnce": false,
  "editTimeoutSec": 1209600,   # 14 days
  "maxInstancesPerUser": 5,
  "translatedNames": [
    { "language": "en", "text": ${i18n.en.followup.name} },
    { "language": "es", "text": ${i18n.es.followup.name} },
    { "language": "ht", "text": ${i18n.ht.followup.name} }
  ],
  "translatedTitles": [
    { "language": "en", "text": ${i18n.en.followup.title} },
    { "language": "es", "text": ${i18n.es.followup.title} },
    { "language": "ht", "text": ${i18n.ht.followup.title} }
  ],
  "sections": [
    {
      "nameTemplate": null,
      "icons": [],
      "blocks": [
        {
          # NOTE: Using HOCON object concatenation here to override just a few things on the included object,
          # so we can leverage re-use since it's mostly the same questions.
          "control": ${_includes.covid_survey.covid_been_tested} {
            "stableId": ${id.q.followup_covid_been_tested},
            "promptTemplate": {
              "templateType": "HTML",
              "templateText": "$followup_covid_been_tested_prompt"
              "variables": [
                {
                  "name": "followup_covid_been_tested_prompt",
                  "translations": [
                    { "language": "en", "text": ${i18n.en.followup_covid_been_tested_prompt} },
                    { "language": "es", "text": ${i18n.es.followup_covid_been_tested_prompt} },
                    { "language": "ht", "text": ${i18n.ht.followup_covid_been_tested_prompt} }
                  ]
                }
              ]
            }
          },
          "nested": [
            {
              "question": ${_includes.covid_survey.covid_test_kind} {
                "stableId": ${id.q.followup_covid_test_kind}
              },
              "blockType": "QUESTION",
              "shownExpr": """user.studies["testboston"].forms["FOLLOWUP_SURVEY"].instances[specific].questions["FOLLOWUP_COVID_BEEN_TESTED"].answers.hasOption("YES")"""
            },
            {
              "question": ${_includes.covid_survey.covid_test_date} {
                "stableId": ${id.q.followup_covid_test_date}
              },
              "blockType": "QUESTION",
              "shownExpr": """
                user.studies["testboston"].forms["FOLLOWUP_SURVEY"].instances[specific].questions["FOLLOWUP_COVID_BEEN_TESTED"].answers.hasOption("YES")
                && user.studies["testboston"].forms["FOLLOWUP_SURVEY"].instances[specific].questions["FOLLOWUP_COVID_TEST_KIND"].answers.hasOption("NOT_SURE")
              """
            },
            {
              "question": ${_includes.covid_survey.covid_test_result} {
                "stableId": ${id.q.followup_covid_test_result}
              },
              "blockType": "QUESTION",
              "shownExpr": """
                user.studies["testboston"].forms["FOLLOWUP_SURVEY"].instances[specific].questions["FOLLOWUP_COVID_BEEN_TESTED"].answers.hasOption("YES")
                && user.studies["testboston"].forms["FOLLOWUP_SURVEY"].instances[specific].questions["FOLLOWUP_COVID_TEST_KIND"].answers.hasOption("NOT_SURE")
              """
            },
            {
              "question": ${_includes.covid_survey.viral_test_list} {
                "stableId": ${id.q.followup_viral_test_list},
                "children": [
                  ${_includes.covid_survey.viral_test_result} {
                    "stableId": ${id.q.followup_viral_test_result}
                  },
                  ${_includes.covid_survey.viral_test_date} {
                    "stableId": ${id.q.followup_viral_test_date}
                  }
                ]
              },
              "blockType": "QUESTION",
              "shownExpr": """
                user.studies["testboston"].forms["FOLLOWUP_SURVEY"].instances[specific].questions["FOLLOWUP_COVID_BEEN_TESTED"].answers.hasOption("YES")
                && user.studies["testboston"].forms["FOLLOWUP_SURVEY"].instances[specific].questions["FOLLOWUP_COVID_TEST_KIND"].answers.hasOption("VIRAL_TEST")
              """
            },
            {
              "question": ${_includes.covid_survey.blood_test_list} {
                "stableId": ${id.q.followup_blood_test_list},
                "children": [
                  ${_includes.covid_survey.blood_test_result} {
                    "stableId": ${id.q.followup_blood_test_result}
                  },
                  ${_includes.covid_survey.blood_test_date} {
                    "stableId": ${id.q.followup_blood_test_date}
                  }
                ]
              },
              "blockType": "QUESTION",
              "shownExpr": """
                user.studies["testboston"].forms["FOLLOWUP_SURVEY"].instances[specific].questions["FOLLOWUP_COVID_BEEN_TESTED"].answers.hasOption("YES")
                && user.studies["testboston"].forms["FOLLOWUP_SURVEY"].instances[specific].questions["FOLLOWUP_COVID_TEST_KIND"].answers.hasOption("BLOOD_TEST")
              """
            }
          ],
          "blockType": "CONDITIONAL",
          "shownExpr": null
        },
        {
          "question": ${_includes.covid_survey.current_symptoms} {
            "stableId": ${id.q.followup_current_symptoms}
          },
          "blockType": "QUESTION",
          "shownExpr": null
        },
        {
          "question": ${_includes.covid_survey.past_symptoms} {
            "stableId": ${id.q.followup_past_symptoms}
          },
          "blockType": "QUESTION",
          "shownExpr": null
        },
        {
          "question": ${_includes.covid_survey.household_diagnosed} {
            "stableId": ${id.q.followup_household_diagnosed},
            "promptTemplate": {
              "templateType": "HTML",
              "templateText": "$followup_household_diagnosed_prompt"
              "variables": [
                {
                  "name": "followup_household_diagnosed_prompt",
                  "translations": [
                    { "language": "en", "text": ${i18n.en.followup_household_diagnosed_prompt} },
                    { "language": "es", "text": ${i18n.es.followup_household_diagnosed_prompt} },
                    { "language": "ht", "text": ${i18n.ht.followup_household_diagnosed_prompt} }
                  ]
                }
              ]
            }
          },
          "blockType": "QUESTION",
          "shownExpr": null
        },
        {
          "question": ${_includes.covid_survey.contact_diagnosed} {
            "stableId": ${id.q.followup_contact_diagnosed}
          },
          "blockType": "QUESTION",
          "shownExpr": null
        }
      ]
    }
  ]
}

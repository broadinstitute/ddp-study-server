{
  "workflowTransitions": [
    # main study workflow
    {
      "from": {
        "type": "START"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.prequal},
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": ${id.act.prequal}
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.prequal},
          "expression": """!user.studies["cmi-pancan"].forms["PREQUAL"].isStatus("COMPLETE")"""
        },
        {
          "type": "STUDY_REDIRECT",
          "studyGuid": "cmi-mbc",
          "redirectUrl": ${mbcRedirectUrl},
          ## TODO update PEX to add && user.studies["cmi-pancan"].forms["PREQUAL"].questions["DIAGNOSED_PRIMARY_CANCER_LIST"].answers.numSelectedOptions() == 1
          ## and user.profile.language() == "en"
          ## and another to entry for user language == "es"
          "expression": """
              user.studies["cmi-pancan"].forms["PREQUAL"].isStatus("COMPLETE")
               && user.studies["cmi-pancan"].forms["PREQUAL"].questions["DIAGNOSED_PRIMARY_CANCER_LIST"].children["DIAGNOSED_PRIMARY_CANCER"].answers.hasOption("BREAST")
               && user.studies["cmi-pancan"].forms["PREQUAL"].questions["DIAGNOSED_PRIMARY_CANCER_BREAST_ADVANCED"].answers.hasOption("YES")
          """,
        },

## MBC spanish site redirect
##        {
##          "type": "STUDY_REDIRECT",
##          "studyGuid": "cmi-mbc",
##          "redirectUrl": ${mbcRedirectUrlES},
##          "expression": """
##              user.studies["cmi-pancan"].forms["PREQUAL"].isStatus("COMPLETE")
##               && user.studies["cmi-pancan"].forms["PREQUAL"].questions["DIAGNOSED_PRIMARY_CANCER_LIST"].children["DIAGNOSED_PRIMARY_CANCER"].answers.hasOption("BREAST")
##                              && user.studies["cmi-pancan"].forms["PREQUAL"].questions["DIAGNOSED_PRIMARY_CANCER_BREAST_ADVANCED"].answers.hasOption("YES")
        ##               && user.studies["cmi-pancan"].forms["PREQUAL"].questions["DIAGNOSED_PRIMARY_CANCER_LIST"].answers.numSelectedOptions() == 1
##               && user.profile.language() == "es"
##          """,
##        },

        {
          "type": "STUDY_REDIRECT",
          "studyGuid": "cmi-mpc",
          "redirectUrl": ${mpcRedirectUrl},
          ## TODO update PEX
          "expression": """
              user.studies["cmi-pancan"].forms["PREQUAL"].isStatus("COMPLETE")
               && user.studies["cmi-pancan"].forms["PREQUAL"].questions["DIAGNOSED_PRIMARY_CANCER_LIST"].children["DIAGNOSED_PRIMARY_CANCER"].answers.hasOption("PROSTATE")
               && user.studies["cmi-pancan"].forms["PREQUAL"].questions["DIAGNOSED_PRIMARY_CANCER_PROSTATE_ADVANCED"].answers.hasOption("YES")
          """,
        },
        {
          "type": "STUDY_REDIRECT",
          "studyGuid": "cmi-brain",
          "redirectUrl": ${brainRedirectUrl},
          ## TODO update PEX
          "expression": """
              user.studies["cmi-pancan"].forms["PREQUAL"].isStatus("COMPLETE")
               && user.studies["cmi-pancan"].forms["PREQUAL"].questions["DIAGNOSED_PRIMARY_CANCER_LIST"].children["DIAGNOSED_PRIMARY_CANCER"].answers.hasOption("BRAIN_TUMOR")
          """,
        },
        {
          "type": "STUDY_REDIRECT",
          "studyGuid": "ANGIO",
          "redirectUrl": ${angioRedirectUrl},
          ## TODO update PEX
          "expression": """
              user.studies["cmi-pancan"].forms["PREQUAL"].isStatus("COMPLETE")
               && user.studies["cmi-pancan"].forms["PREQUAL"].questions["DIAGNOSED_PRIMARY_CANCER_LIST"].children["DIAGNOSED_PRIMARY_CANCER"].answers.hasOption("ANGIOSARCOMA")
          """,
        },
        {
          "type": "STUDY_REDIRECT",
          "studyGuid": "CMI-OSTEO",
          "redirectUrl": ${osteoRedirectUrl},
          ## TODO update PEX
          "expression": """
              user.studies["cmi-pancan"].forms["PREQUAL"].isStatus("COMPLETE")
               && user.studies["cmi-pancan"].forms["PREQUAL"].questions["DIAGNOSED_PRIMARY_CANCER_LIST"].children["DIAGNOSED_PRIMARY_CANCER"].answers.hasOption("OSTEOSARCOMA")
          """,
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.consent},
          "expression": """user.studies["cmi-pancan"].forms["PREQUAL"].isStatus("COMPLETE")
            && user.studies["cmi-pancan"].forms["CONSENT"].hasInstance()
          """,
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.parental},
          "expression": """user.studies["cmi-pancan"].forms["PREQUAL"].isStatus("COMPLETE")
            && user.studies["cmi-pancan"].forms["CONSENT_PARENTAL"].hasInstance()
          """,
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.assent},
          "expression": """user.studies["cmi-pancan"].forms["PREQUAL"].isStatus("COMPLETE")
            && user.studies["cmi-pancan"].forms["CONSENT_ASSENT"].hasInstance()
          """,
        },
        {
          "type": "MAILING_LIST",
          "expression": """user.studies["cmi-pancan"].forms["PREQUAL"].isStatus("COMPLETE")
            && user.studies["cmi-pancan"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("MAILING_LIST")
          """,
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": ${id.act.consent}
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.consent},
          "expression": """!user.studies["cmi-pancan"].forms["CONSENT"].isStatus("COMPLETE")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.release},
          "expression": """!user.studies["cmi-pancan"].forms["RELEASE"].isStatus("COMPLETE")""",
        },
        {
          "type": "DASHBOARD",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": ${id.act.parental}
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.parental},
          "expression": """!user.studies["cmi-pancan"].forms["CONSENT_PARENTAL"].isStatus("COMPLETE")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.release_minor},
          "expression": """!user.studies["cmi-pancan"].forms["RELEASE_MINOR"].isStatus("COMPLETE")"""
        },
        {
          "type": "DASHBOARD",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": ${id.act.assent}
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.assent},
          "expression": """!user.studies["cmi-pancan"].forms["CONSENT_ASSENT"].isStatus("COMPLETE")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.release_minor},
          "expression": """!user.studies["cmi-pancan"].forms["RELEASE_MINOR"].isStatus("COMPLETE")"""
        },
        {
          "type": "DASHBOARD",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": ${id.act.release}
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.release},
          "expression": """!user.studies["cmi-pancan"].forms["RELEASE"].isStatus("COMPLETE")""",
        },
        # todo: go to the first instance of about-cancer
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.about_cancer},
          "expression": """!user.studies["cmi-pancan"].forms["ABOUT_CANCER"].isStatus("COMPLETE")""",
        },
        {
          "type": "DASHBOARD",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": ${id.act.release_minor}
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.release_minor},
          "expression": """!user.studies["cmi-pancan"].forms["RELEASE_MINOR"].isStatus("COMPLETE")"""
        },
        # todo: go to the first instance of about-cancer
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.about_cancer},
          "expression": """!user.studies["cmi-pancan"].forms["ABOUT_CANCER"].isStatus("COMPLETE")""",
        },
        {
          "type": "DASHBOARD",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": ${id.act.about_cancer}
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.about_cancer},
          "expression": """!user.studies["cmi-pancan"].forms["ABOUT_CANCER"].isStatus("COMPLETE")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.about_you},
          "expression": """!user.studies["cmi-pancan"].forms["ABOUT_YOU"].isStatus("COMPLETE")""",
        },
        {
          "type": "DASHBOARD",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "RETURN_USER"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.consent},
          "expression": """user.studies["cmi-pancan"].forms["CONSENT"].hasInstance()
            && !user.studies["cmi-pancan"].forms["CONSENT"].isStatus("COMPLETE")
          """
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.parental},
          "expression": """user.studies["cmi-pancan"].forms["CONSENT_PARENTAL"].hasInstance()
            && !user.studies["cmi-pancan"].forms["CONSENT_PARENTAL"].isStatus("COMPLETE")
          """
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.assent},
          "expression": """user.studies["cmi-pancan"].forms["CONSENT_ASSENT"].hasInstance()
            && !user.studies["cmi-pancan"].forms["CONSENT_ASSENT"].isStatus("COMPLETE")
          """
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.release},
          "expression": """user.studies["cmi-pancan"].forms["RELEASE"].hasInstance()
            && !user.studies["cmi-pancan"].forms["RELEASE"].isStatus("COMPLETE")
          """
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.release_minor},
          "expression": """user.studies["cmi-pancan"].forms["RELEASE_MINOR"].hasInstance()
            && !user.studies["cmi-pancan"].forms["RELEASE_MINOR"].isStatus("COMPLETE")
          """
        },
        # todo: go to earliest instance that's not completed
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.about_cancer},
          "expression": """user.studies["cmi-pancan"].forms["ABOUT_CANCER"].hasInstance()
            && !user.studies["cmi-pancan"].forms["ABOUT_CANCER"].isStatus("COMPLETE")"""
        },
        {
          "type": "ACTIVITY",
          "activityCode": ${id.act.about_you},
          "expression": """user.studies["cmi-pancan"].forms["ABOUT_YOU"].hasInstance()
            && !user.studies["cmi-pancan"].forms["ABOUT_YOU"].isStatus("COMPLETE")"""
        },
        {
          "type": "DASHBOARD",
          "expression": "true"
        }
      ]
    }
  ]
}

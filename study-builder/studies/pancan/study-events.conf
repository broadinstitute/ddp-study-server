{
  "events": [
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": ${id.act.prequal},
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": ${id.act.consent}
      },
      "cancelExpr": """
        !user.studies["cmi-pancan"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("DIAGNOSED")
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },

//    # join mailing list event
//    {
//      "trigger": {
//        "type": "JOIN_MAILING_LIST"
//      },
//      "action": {
//        "type": "SENDGRID_EMAIL",
//        "templates": [
//          {
//            "emailTemplate": ${emails.joinMailingList},
//            "language": "en",
//            "isDynamic": true
//          }
//        ],
//        "pdfAttachments": []
//      },
//      "dispatchToHousekeeping": true,
//      "order": 1
//    },
//
//    # populate profile events
//    {
//      "trigger": {
//        "type": "ACTIVITY_STATUS",
//        "activityCode": "PREQUAL",
//        "statusType": "COMPLETE"
//      },
//      "action": {
//        "type": "COPY_ANSWER",
//        "copyConfigPairs": [
//          {
//            "source": {
//              "type": "ANSWER",
//              "questionStableId": "PREQUAL_FIRST_NAME"
//            },
//            "target": {
//              "type": "PARTICIPANT_PROFILE_FIRST_NAME"
//            }
//          },
//          {
//            "source": {
//              "type": "ANSWER",
//              "questionStableId": "PREQUAL_LAST_NAME"
//            },
//            "target": {
//              "type": "PARTICIPANT_PROFILE_LAST_NAME"
//            }
//          }
//        ]
//      },
//      "dispatchToHousekeeping": false,
//      "order": 1
//    },
//
//    # activity instance creation events
//    {
//      "trigger": {
//        "type": "ACTIVITY_STATUS",
//        "activityCode": "PREQUAL",
//        "statusType": "COMPLETE"
//      },
//      "action": {
//        "type": "ACTIVITY_INSTANCE_CREATION",
//        "activityCode": "ABOUTYOU"
//      },
//      "cancelExpr": """
//        !user.studies["cmi-pancan"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("DIAGNOSED")
//      """,
//      "maxOccurrencesPerUser": 1,
//      "dispatchToHousekeeping": false,
//      "order": 1
//    }
//
//    # registration event
//    {
//      "trigger": {
//        "type": "USER_REGISTERED",
//      },
//      "action": {
//        "type": "SENDGRID_EMAIL",
//        "templates": [
//          {
//            "emailTemplate": ${emails.welcome},
//            "language": "en",
//            "isDynamic": true
//          }
//        ],
//        "linkedActivityCode": "ABOUTYOU",
//        "pdfAttachments": []
//      },
//      "cancelExpr": """
//        !user.studies["cmi-pancan"].forms["PREQUAL"].hasInstance()
//        || !user.studies["cmi-pancan"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("DIAGNOSED")
//      """,
//      "maxOccurrencesPerUser": 1,
//      "dispatchToHousekeeping": true,
//      "order": 1
//    },
//
//    # activity status email events
//    {
//      "trigger": {
//        "type": "ACTIVITY_STATUS",
//        "activityCode": "CONSENT",
//        "statusType": "CREATED"
//      },
//      "action": {
//        "type": "SENDGRID_EMAIL",
//        "templates": [
//          {
//            "emailTemplate": ${emails.aboutyouCompleted},
//            "language": "en",
//            "isDynamic": true
//          }
//        ],
//        "linkedActivityCode": "CONSENT",
//        "pdfAttachments": []
//      },
//      "maxOccurrencesPerUser": 1,
//      "dispatchToHousekeeping": true,
//      "order": 1
//    },
//
//    # pdf generation event for release pdfs
//    {
//      "trigger": {
//        "type": "ACTIVITY_STATUS",
//        "activityCode": "RELEASE",
//        "statusType": "COMPLETE"
//      },
//      "action": {
//        "type": "PDF_GENERATION",
//        "pdfName": "pancanproject-release"
//      },
//      "dispatchToHousekeeping": true,
//      "order": 1
//    },
//
//    # medical update event for release pdfs
//    {
//      "trigger": {
//        "type": "MEDICAL_UPDATE"
//      },
//      "action": {
//        "type": "PDF_GENERATION",
//        "pdfName": "pancanproject-release"
//      },
//      "cancelExpr": """!(user.studies["cmi-pancan"].forms["RELEASE"].hasInstance()
//            && user.studies["cmi-pancan"].forms["RELEASE"].isStatus("COMPLETE"))"""
//      "dispatchToHousekeeping": true,
//      "order": 1
//    },
//
//    # reminder email events
//    {
//      "trigger": {
//        "type": "ACTIVITY_STATUS",
//        "activityCode": "CONSENT",
//        "statusType": "CREATED"
//      },
//      "action": {
//        "type": "SENDGRID_EMAIL",
//        "templates": [
//          {
//            "emailTemplate": ${emails.consentFirstReminder},
//            "language": "en",
//            "isDynamic": true
//          }
//        ],
//        "linkedActivityCode": "CONSENT",
//        "pdfAttachments": []
//      },
//      "cancelExpr": """
//        user.studies["cmi-pancan"].forms["CONSENT"].isStatus("COMPLETE")
//        || !user.studies["cmi-pancan"].forms["ABOUTYOU"].questions["COUNTRY"].answers.hasAnyOption("US", "CA", "PR", "GU", "VI", "MP", "AS")
//      """,
//      "delaySeconds": 604800, # one week in seconds
//      "dispatchToHousekeeping": true,
//      "order": 1
//    },
//
//    # enrollment event
//
//    # announcement event
//
//    # dsm notification email events
//    {
//      "trigger": {
//        "type": "DSM_NOTIFICATION",
//        "dsmEvent": "BLOOD_RECEIVED"
//      },
//      "action": {
//        "type": "SENDGRID_EMAIL",
//        "templates": [
//          {
//            "emailTemplate": ${emails.bloodReceived},
//            "language": "en",
//            "isDynamic": true
//          }
//        ],
//        "pdfAttachments": []
//      },
//      "dispatchToHousekeeping": true,
//      "order": 1
//    },
//
//    # exit request event
  ]
}

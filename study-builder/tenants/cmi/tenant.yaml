rules:
  - name: Register User in Pepper
    script: ../register-user-in-pepper.js
    stage: login_success
    enabled: true
    order: 1

pages:
  - name: login
    html: ./pages/login.html
    enabled: true
  - name: password_reset
    html: ./pages/password_reset.html
    enabled: true

emailTemplates:
  - template: reset_email
    body: ./emails/change_password.html
    from: Count Me In <info@joincountmein.org>
    resultUrl: '##SERVER_BASE_URL##/pepper/v1/post-password-reset?clientId={{ application.clientID }}'
    subject: >-
      {% if client.client_metadata.study == "ANGIO" %} Angiosarcoma Project
      {% elsif client.client_metadata.study == "cmi-brain" %} Brain Cancer Project
      {% elsif client.client_metadata.study == "cmi-mbc" %} Metastatic Breast Cancer Project
      {% elsif client.client_metadata.study == "CMI-OSTEO" %} Osteosarcoma Project
      {% elsif client.client_metadata.study == "cmi-mpc" %} Metastatic Prostate Cancer Project
      {% endif %} Password Reset
    urlLifetimeInSeconds: 432000
    syntax: liquid
    enabled: true

# NOTE: client names must match what's in Auth0's dashboard, otherwise deploy
# will create new clients. Everytime deploy happens, client configurations here
# will overwrite what's in Auth0. If there are additional urls not in here then
# those need to be added back manually. Other settings not configured here will
# also need to be configured manually.
clients:
  - name: angio-angular-client
    app_type: spa
    callbacks:
      - '##ANGIO_BASE_URL##/login-landing'
      ##LOCALHOST_CALLBACKS##
    allowed_logout_urls:
      - '##ANGIO_BASE_URL##'
      - '##ANGIO_BASE_URL##/session-expired'
      ##LOCALHOST_LOGOUTS##
    web_origins:
      - '##ANGIO_BASE_URL##'
      ##LOCALHOST_ORIGINS##
    client_metadata:
      study: ANGIO

  - name: brain-angular-client
    app_type: spa
    callbacks:
      - '##BRAIN_BASE_URL##/login-landing'
      ##LOCALHOST_CALLBACKS##
    allowed_logout_urls:
      - '##BRAIN_BASE_URL##'
      - '##BRAIN_BASE_URL##/session-expired'
      ##LOCALHOST_LOGOUTS##
    web_origins:
      - '##BRAIN_BASE_URL##'
      ##LOCALHOST_ORIGINS##
    client_metadata:
      study: cmi-brain

  - name: mbc-angular-client
    app_type: spa
    callbacks:
      - '##MBC_BASE_URL##/login-landing'
      ##LOCALHOST_CALLBACKS##
    allowed_logout_urls:
      - '##MBC_BASE_URL##'
      - '##MBC_BASE_URL##/session-expired'
      ##LOCALHOST_LOGOUTS##
    web_origins:
      - '##MBC_BASE_URL##'
      ##LOCALHOST_ORIGINS##
    client_metadata:
      study: cmi-mbc

  - name: osteo-angular-client
    app_type: spa
    callbacks:
      - '##OSTEO_BASE_URL##/login-landing'
      ##LOCALHOST_CALLBACKS##
    allowed_logout_urls:
      - '##OSTEO_BASE_URL##'
      - '##OSTEO_BASE_URL##/session-expired'
      ##LOCALHOST_LOGOUTS##
    web_origins:
      - '##OSTEO_BASE_URL##'
      ##LOCALHOST_ORIGINS##
    client_metadata:
      study: CMI-OSTEO

  - name: mpc-angular-client
    app_type: spa
    callbacks:
      - '##MPC_BASE_URL##/login-landing'
      ##LOCALHOST_CALLBACKS##
    allowed_logout_urls:
      - '##MPC_BASE_URL##'
      - '##MPC_BASE_URL##/session-expired'
      ##LOCALHOST_LOGOUTS##
    web_origins:
      - '##MPC_BASE_URL##'
      ##LOCALHOST_ORIGINS##
    client_metadata:
      study: cmi-mpc

  - name:esc-angular-client
    app_type: spa
    callbacks:
      - '##ESC_BASE_URL##/login-landing'
      ##LOCALHOST_CALLBACKS##
    allowed_logout_urls:
      - '##ESC_BASE_URL##'
      - '##ESC_BASE_URL##/session-expired'
      ##LOCALHOST_LOGOUTS##
    web_origins:
      - '##ESC_BASE_URL##'
      ##LOCALHOST_ORIGINS##
    client_metadata:
      study: cmi-esc
